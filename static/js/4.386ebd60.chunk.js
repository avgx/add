(this["webpackJsonpmy-app-ts"]=this["webpackJsonpmy-app-ts"]||[]).push([[4],{818:function(e){e.exports=JSON.parse('[{"id":"7DFA3E61-2410-4D7F-9FA9-286AEC176457","title":"Visitors","raw":[{"id":"3B0CDEA8-8636-4457-8983-A8931DE80596","title":"Visitors by server","visualizeType":"Chart","groupBy":["event.detector.People.state","event.detector.People.phase","source.server"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.People.phase","type":"set","op":"eq","value":"happened"}],"chart":{"type":"Bar","x":"source.server","y":"event.detector.People.phase","op":"count","series":"event.detector.People.state"},"description":"for all servers as bar chart"},{"id":"268B9D0D-1BCD-4AEC-A3F3-A7AE6A752617","title":"Visitors by time","visualizeType":"Chart","groupBy":["event.detector.People.phase","event.detector.People.state","time.min_of_day_x30","time.hour_x2","time.min_of_day_x15"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.People.phase","type":"set","op":"eq","value":"happened"}],"chart":{"type":"Area","x":"time.min_of_day_x15","y":"event.detector.People.phase","op":"count","series":"event.detector.People.state"},"description":"in 15m intervals"},{"id":"35FE34EA-F005-4CEB-B5B7-59A69D0AA077","title":"Visitors by time","visualizeType":"Chart","groupBy":["event.detector.People.phase","event.detector.People.state","time.min_of_day_x30","time.hour_x2","time.min_of_day_x15"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.People.phase","type":"set","op":"eq","value":"happened"}],"chart":{"type":"Area","x":"time.hour_x2","y":"event.detector.People.phase","op":"count","series":"event.detector.People.state"},"description":"in 2h intervals"},{"id":"1BCE883B-ED71-4510-879B-C55A23C53E25","title":"Visitors by time Entered at server TIMUR","visualizeType":"Chart","groupBy":["event.detector.People.phase","event.detector.People.state","time.min_of_day_x30","time.hour_x2","time.min_of_day_x15"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.People.phase","type":"set","op":"eq","value":"happened"},{"field":"source.server","type":"dictionary","op":"eq","value":"TIMUR-SHUGUSHEV"},{"field":"event.detector.People.state","type":"set","op":"eq","value":"in"}],"chart":{"type":"Line","x":"time.min_of_day_x30","y":"event.detector.People.phase","op":"count","series":"event.detector.People.state"},"description":"in 30m intervals"},{"id":"C4563579-6778-439D-9077-9909E986C503","title":"Sample title","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"![](https://www.axxonsoft.com/local/templates/axxonsoft-2019/img/logo.svg)\\n\\n# This is Visitors dashboard\\n\\n#### here is some description\\n\\n[Markdown](http://daringfireball.net/projects/markdown/) lets you write content in a really natural way.\\n\\n  * You can have lists, like this one\\n  * Make things **bold** or *italic*\\n  * Embed snippets of `code`\\n"},{"id":"D8120B30-A644-4C30-B21E-1EEECAF60670","title":"some other title","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"### About layout\\n\\n* The grid layout for dashboard is fixed for 2 items per row.\\n* Widgets are ordered by type.\\n* Order: [ Markdown, Counter, Chart, Pie, Table] \\n* This will be fixed in future"}]},{"id":"580AB752-4F07-4466-A7AD-3B631FA72E89","title":"Gender/Age","raw":[{"id":"F69B7338-B0B8-4563-B10C-C85FBBE6DE37","title":"Average age by server","visualizeType":"Chart","groupBy":["event.detector.faceAppeared.age","event.detector.faceAppeared.gender2","event.detector.faceAppeared.phase","time.hour_x2","source.server","source.video"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.faceAppeared.phase","type":"set","op":"eq","value":"happened"},{"field":"event.detector.faceAppeared.age","type":"number","op":"gt","value":"0"}],"chart":{"type":"Bar","x":"event.detector.faceAppeared.gender2","y":"event.detector.faceAppeared.age","op":"avg","series":"source.server"}},{"id":"F1F30966-8A87-483C-8F1B-44202CE2A56D","title":"Male","visualizeType":"Counter","groupBy":["event.detector.faceAppeared.age","event.detector.faceAppeared.gender2","event.detector.faceAppeared.phase","time.hour_x2","source.server","source.video"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.faceAppeared.phase","type":"set","op":"eq","value":"happened"},{"field":"event.detector.faceAppeared.gender2","type":"set","op":"eq","value":"male"}],"chart":{"type":"Bar","x":"event.detector.faceAppeared.gender2","y":"event.detector.faceAppeared.age","op":"avg","series":"source.server"},"counter":{"field":"event.detector.faceAppeared.phase","op":"count"}},{"id":"7FF86C62-430C-46AF-BB3D-EFC00061B812","title":"Female","visualizeType":"Counter","groupBy":["event.detector.faceAppeared.age","event.detector.faceAppeared.gender2","event.detector.faceAppeared.phase","time.hour_x2","source.server","source.video"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.faceAppeared.phase","type":"set","op":"eq","value":"happened"},{"field":"event.detector.faceAppeared.gender2","type":"set","op":"eq","value":"female"}],"chart":{"type":"Bar","x":"event.detector.faceAppeared.gender2","y":"event.detector.faceAppeared.age","op":"avg","series":"source.server"},"counter":{"field":"event.detector.faceAppeared.phase","op":"count"}},{"id":"51DCD0D2-F304-45B7-8A72-C2CE6FF3625C","title":"Genders by server","visualizeType":"Pie","groupBy":["event.detector.faceAppeared.age","event.detector.faceAppeared.gender2","event.detector.faceAppeared.phase","time.hour_x2","source.server","source.video"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.faceAppeared.phase","type":"set","op":"eq","value":"happened"},{"field":"event.detector.faceAppeared.age","type":"number","op":"gt","value":"0"},{"field":"source.server","type":"dictionary","op":"neq","value":"QA-T31"}],"chart":{"type":"Bar","x":"event.detector.faceAppeared.gender2","y":"event.detector.faceAppeared.phase","op":"count","series":"source.server"},"counter":{"field":"event.detector.faceAppeared.phase","op":"count"},"description":"excluding QA-T31"},{"id":"E29DD14B-788A-4D3E-B75B-1BE430687303","title":"some other title","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"### About layout\\n\\n* The grid layout for dashboard is fixed for 2 items per row.\\n* Widgets are ordered by type.\\n* Order: [ Markdown, Counter, Chart, Pie, Table] \\n* This will be fixed in future"},{"id":"929ED66E-BFFC-4133-AB42-9032A739EA01","title":"Sample title","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"![](https://www.axxonsoft.com/local/templates/axxonsoft-2019/img/logo.svg)\\n"}]},{"id":"42D77AE2-1E41-4D05-9924-DD65E7C53A1E","title":"Evasion detection","raw":[{"id":"EA82B93D-93F7-4CBC-BDD3-08A221B89DED","title":"Evasion detected","visualizeType":"Chart","groupBy":["event.detector.type","source.video","source.server","time.hour"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.type","type":"dictionary","op":"eq","value":"EvasionDetected"}],"chart":{"type":"Line","x":"time.hour","y":"event.detector.type","op":"count","series":"source.server"},"description":"by hour by all cameras of server"},{"id":"4B5707C1-D502-4C9C-8FBB-FDEDB5096A6A","title":"Evasion detected","visualizeType":"Chart","groupBy":["event.detector.type","source.video","source.server","time.hour"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.type","type":"dictionary","op":"eq","value":"EvasionDetected"}],"chart":{"type":"Line","x":"time.hour","y":"event.detector.type","op":"count","series":"source.video"},"description":"by hour by cameras"},{"id":"0D40CAC6-5A77-4B05-9FEE-6900F784EE64","title":"Evasion text","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"![](https://www.axxonsoft.com/local/templates/axxonsoft-2019/img/logo.svg)\\n\\n# Evasion detection dashboard\\n\\n### demo\\n"},{"id":"1439ADA3-6FC0-4E71-A855-E91F7AE3F2F9","title":"description text","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"# How it works\\n\\n* The data is taken from events with detectorType=EvasionDetected"},{"id":"428EC59A-4DBE-4983-B676-8AD948142640","title":"Evasion by 15m intervals","visualizeType":"Chart","groupBy":["event.detector.type","source.video","source.server","time.min_of_day_x15"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.type","type":"dictionary","op":"eq","value":"EvasionDetected"}],"chart":{"type":"Area","x":"time.min_of_day_x15","y":"event.detector.type","op":"count","series":"source.server"},"description":"by 15m by all cameras of server"},{"id":"A3C5649F-9E1C-4347-A9EF-A220318AE866","title":"Evasion by 15m intervals","visualizeType":"Chart","groupBy":["event.detector.type","source.video","source.server","time.min_of_day_x15"],"period":{"type":"forever"},"filterItems":[{"field":"event.detector.type","type":"dictionary","op":"eq","value":"EvasionDetected"}],"chart":{"type":"Area","x":"time.min_of_day_x15","y":"event.detector.type","op":"count","series":"source.video"},"description":"by 15m by cameras"}]},{"id":"A906943C-CC39-4C38-AAEF-82D4CF25625A","title":"LPR events (list)","raw":[{"id":"4b4e1346-2653-43cc-a647-6c5365286d57","title":"LPR events","visualizeType":"Events","groupBy":[],"filterItems":[{"field":"event.detector.type","type":"dictionary","op":"eq","value":"plateRecognized"}],"period":{"type":"forever"},"description":"show lpr event with plate recognized"}]},{"id":"C9E18F8B-D2DE-42A0-BFF2-F4A542E69A3B","title":"Faces events (list)","raw":[{"id":"0854b7c4-f7b2-4473-81a1-23769b94118d","title":"Faces","visualizeType":"Events","groupBy":[],"filterItems":[{"field":"event.detector.faceAppeared.phase","type":"set","op":"eq","value":"happened"}],"period":{"type":"forever"},"description":"all events with face appeared"}]},{"id":"5A01EE61-79A7-4C59-A6DC-E048EC432B80","title":"Pivot demo","raw":[{"id":"159483b2-ef82-48e3-9a3f-dd45e44ec6c2","title":"Weekdays distribution","visualizeType":"PivotTable","groupBy":["source.detector","event.detector.type","type","source.video","source.server","time.hour","time.min_of_day_x30","event.detector.faceAppeared.gender2","time.weekday"],"filterItems":[{"field":"type","type":"set","op":"eq","value":"detector"},{"field":"event.detector.faceAppeared.phase","type":"set","op":"eq","value":"happened"}],"period":{"type":"forever"},"pivot":{"rows":"event.detector.faceAppeared.gender2","columns":"time.weekday","values":"type","op":"count"},"description":"male / female by weekdays"},{"id":"159483b2-ef82-48e3-9a3f-dd45e44ec6c2","title":"Detector to video pivot","visualizeType":"PivotTable","groupBy":["source.detector","event.detector.type","type","source.video","source.server"],"filterItems":[{"field":"type","type":"set","op":"eq","value":"detector"}],"period":{"type":"forever"},"pivot":{"rows":"source.detector","columns":"source.video","values":"type","op":"count"},"description":"events count"},{"id":"859483b2-ef82-48e3-9a3f-dd45e44ec6c2","title":"Pivot table sample","visualizeType":"PivotTable","groupBy":["source.detector","event.detector.type","type","source.video","source.server","time.hour","time.min_of_day_x30"],"filterItems":[{"field":"type","type":"set","op":"eq","value":"detector"}],"period":{"type":"forever"},"pivot":{"rows":"time.min_of_day_x30","columns":"source.video","values":"type","op":"count"}}]}]')},819:function(e){e.exports=JSON.parse('[{"id":"11111111-1111-1111-1111-111111111111","title":"Tutorial","raw":[{"id":"C4563479-6778-439D-9077-9909E986C503","title":"Sample title","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"![](https://www.axxonsoft.com/local/templates/axxonsoft-2019/img/logo.svg)\\n\\n# This is dashboard tutorial"},{"id":"D3120B30-A644-4C30-B21E-1EEECAF60670","title":"some other title","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"### To be continued\\n\\n[next link](#/dashboard/11111111-1111-1111-1111-111111111112)"}]},{"id":"11111111-1111-1111-1111-111111111112","title":"Tutorial","raw":[{"id":"18120B30-A644-4C30-B21E-1EEECAF60670","title":"some other title","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"### To be continued"}]}]')},860:function(e,t,a){"use strict";a.r(t);var n=a(123),r=a(164),i=a(0),l=a.n(i),o=a(113),s=a(855),c=a(477),u=a(478),d=a(104),p=a(105),m=a(107),v=a(106),h=a(108),f=a(864),g=a(377),y=a(376),E=a(824);var b=function(e){return i.createElement(y.a,{variant:"elevation",elevation:0},i.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},i.createElement(E.a,{item:!0,spacing:2},i.createElement("div",null,i.createElement(g.a,{id:"title-text",size:"small",label:"Title",value:e.title,onChange:function(t){var a=t.target.value&&""!==t.target.value?t.target.value:"";console.log("newTitleValue "+a),e.onChangeTitle(a)},fullWidth:!0,InputLabelProps:{shrink:!0},variant:"outlined"}))),i.createElement(E.a,{item:!0,spacing:2},i.createElement(g.a,{id:"description-text",size:"small",label:"Description",value:e.description,onChange:function(t){var a=t.target.value&&""!==t.target.value?t.target.value:"";console.log("newDescriptionValue "+a),e.onChangeDescription(a)},fullWidth:!0,multiline:!0,variant:"outlined"}))))},C=a(835),k=a(385),S=a(40),O=a.n(S),w=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={err:void 0},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.api+"/api/v1/ad-dictionary/events/fields?lang="+this.props.lang,a={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.props.token}};fetch(t,a).then((function(e){return e.json()})).then((function(t){e.props.onChangeEventFields(t)})).catch((function(t){e.setState({err:t.message})}))}},{key:"render",value:function(){return this.state.err?i.createElement("div",null,i.createElement(E.a,{container:!0,direction:"row",justify:"center",alignItems:"center",style:{height:"90vh",margin:0,padding:0}},i.createElement(E.a,{item:!0},i.createElement(C.a,null,i.createElement(k.a,null,"Error: ",this.state.err))))):i.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},i.createElement(O.a,null),"\xa0\xa0Loading event fields...")}}]),t}(i.Component),A=a(270),B=a.n(A),F=a(386),x=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).fetchField1=function(){var e=Object(F.a)(B.a.mark((function e(t){var n,r,i,l;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptor.type,r=t.name,console.log("fetch "+n+" "+r),i=a.props.api+"/api/v2/ad-query/field/"+n+"/"+r,l={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token}},e.abrupt("return",fetch(i,l).catch((function(e){console.log("Error: "+i,e)})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=Object(F.a)(B.a.mark((function e(){var t,a,n,r,i,l,s,c=this;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("WidgetEditorLoadingPossibleValues componentDidMount"),t=this.props.eventFields.filter((function(e){return"set"===e.descriptor.type})),a=this.props.eventFields.filter((function(e){return"dictionary"===e.descriptor.type})),n=new Map,r=new Map,i=Promise.all(t.map(function(){var e=Object(F.a)(B.a.mark((function e(t){var a,r;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.fetchField1(t);case 2:if(!(a=e.sent)||!a.ok){e.next=10;break}return e.next=6,a.json();case 6:r=e.sent,n.set(t.name,r.result),e.next=11;break;case 10:n.set(t.name,[]);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),l=Promise.all(a.map(function(){var e=Object(F.a)(B.a.mark((function e(t){var a,n;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.fetchField1(t);case 2:if(!(a=e.sent)||!a.ok){e.next=10;break}return e.next=6,a.json();case 6:n=e.sent,r.set(t.name,n.result),e.next=11;break;case 10:r.set(t.name,[]);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),console.log("before Promise.all"),e.next=10,Promise.all([i,l]);case 10:console.log("after Promise.all"),console.log("setValues="+JSON.stringify(n)),console.log("dictionaryValues="+JSON.stringify(r)),s={set:o.b(n),dictionary:o.b(r)},this.props.onChangePossibleValues(s);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return i.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},i.createElement(O.a,null),"\xa0\xa0Loading possible values...")}}]),t}(i.Component),j=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={err:void 0},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.api+"/api/v1/ad-dictionary/timeperiods?lang="+this.props.lang,a={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.props.token}};fetch(t,a).then((function(e){return e.json()})).then((function(t){e.props.onLoadPossiblePeriods(t)})).catch((function(t){e.setState({err:t.message})}))}},{key:"render",value:function(){return this.state.err?i.createElement("div",null,i.createElement(E.a,{container:!0,direction:"row",justify:"center",alignItems:"center",style:{height:"90vh",margin:0,padding:0}},i.createElement(E.a,{item:!0},i.createElement(C.a,null,i.createElement(k.a,null,"Error: ",this.state.err))))):i.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},i.createElement(O.a,null),"\xa0\xa0Loading timeperiods...")}}]),t}(i.Component),D=a(499),T=a(387),I=a(268),P=a(388),W=a(271),N=a.n(W);var z=function(e){var t=i.useState(null),a=Object(r.a)(t,2),n=a[0],l=a[1],s=function(t){return function(){e.onRemoveField(t)}},c=function(t){return function(){e.onAddField(t),l(null)}},u=e.groupBy,d=e.groupByAvailable.filter((function(e){return!u.find((function(t){return t===e.name}))&&"complex"!==e.descriptor.type}));return i.createElement(y.a,{variant:"elevation",elevation:0,title:"Select fields that will be used in the result dataset"},i.createElement(k.a,{variant:"h6"},"Select",i.createElement(T.a,{edge:"end","aria-label":"filter",onClick:function(e){l(e.currentTarget)},title:"Add field"},i.createElement(N.a,null))),o.a(e.groupBy).map((function(t){return a=t,e.groupByAvailable.find((function(e){return e.name===a}));var a})).filter((function(e){return!!e})).map((function(e){return e})).map((function(e){return i.createElement(D.a,{key:e.name,variant:"outlined",size:"small",onDelete:s(e),label:e.translation})})),i.createElement(I.a,{id:"simple-menu",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:function(){l(null)}},d.map((function(e){return i.createElement(P.a,{key:e.name,onClick:c(e)},e.translation)}))))},V=a(389),M=a(527),J=a.n(M),L=a(841),R=a(842),_=a(843),q=a(838);var G=function(e){var t,a=i.useState(!1),n=Object(r.a)(a,2),l=n[0],s=n[1],c=[{value:"eq",label:"=="},{value:"neq",label:"!="}],u=[{value:"contains",label:"contains"},{value:"notcontains",label:"notcontains"}],d=[{value:"gt",label:">"},{value:"lt",label:"<"},{value:"gte",label:">="},{value:"lte",label:"<="},{value:"eq",label:"=="},{value:"neq",label:"!="}],p=i.useState(""),m=Object(r.a)(p,2),v=m[0],h=m[1],f=i.useState(""),b=Object(r.a)(f,2),C=b[0],S=b[1],O=i.useState(""),w=Object(r.a)(O,2),A=w[0],B=w[1],F=function(t){return function(){console.log("handleDelete "+JSON.stringify(t)),e.onRemoveFilterItem(t)}},x=function(e){console.log("handleSelectValue "+e.target.value);var t=e.target.value&&""!==e.target.value?e.target.value:"";console.log("newValue "+t),B(t)},j=function(){var t;s(!1);var a=null!==(t=o.a(e.groupByAvailable).filter((function(e){return e.name===v})).map((function(e){return e.descriptor.type})).first())&&void 0!==t?t:"",n={field:v,type:a,op:C,value:A};e.onAddFilterItem(n),B(""),S(""),h("")},I=o.a(e.groupByAvailable),W=null!==(t=I.filter((function(e){return e.name===v})).map((function(e){return e.descriptor.type})).first())&&void 0!==t?t:"",N="set"===W&&e.possibleValues.set.has(v)?e.possibleValues.set.get(v):[],z="dictionary"===W&&e.possibleValues.dictionary.has(v)?e.possibleValues.dictionary.get(v):[],M=""!==v&&""!==C&&""!==A,G=o.a(e.filterItems);return console.log(G),i.createElement(y.a,{variant:"elevation",elevation:0,title:"Filter the result dataset"},i.createElement(k.a,{variant:"h6"},"Filter",i.createElement(T.a,{edge:"end","aria-label":"filter",onClick:function(){s(!0)},title:"Add filter"},i.createElement(J.a,null))),G.map((function(t,a){var n,r,l,s,p,m,v=t.field+"."+t.op+"."+t.value,h=null!==(n=I.filter((function(e){return e.name===t.field})).map((function(e){return e.translation})).first())&&void 0!==n?n:t.field,f=null!==(r=I.filter((function(e){return e.name===t.field})).map((function(e){return e.descriptor.type})).first())&&void 0!==r?r:"",g="number"===f?null!==(l=o.a(d).filter((function(e){return e.value===t.op})).map((function(e){return e.label})).first())&&void 0!==l?l:t.op:"set"===f||"dictionary"===f?null!==(s=o.a(c).filter((function(e){return e.value===t.op})).map((function(e){return e.label})).first())&&void 0!==s?s:t.op:"string"===f&&null!==(p=o.a(u).filter((function(e){return e.value===t.op})).map((function(e){return e.label})).first())&&void 0!==p?p:t.op,y=e.possibleValues.dictionary.has(t.field)?e.possibleValues.dictionary.get(t.field):[],E=h+" "+g+" "+("dictionary"===f&&null!==(m=o.a(y).filter((function(e){return e.key===t.value})).map((function(e){return e.value})).first())&&void 0!==m?m:t.value);return i.createElement(D.a,{key:v,variant:"outlined",size:"small",onDelete:F(t),label:E})})),i.createElement(q.a,{disableBackdropClick:!0,disableEscapeKeyDown:!0,maxWidth:"xs",fullWidth:!0,"aria-labelledby":"confirmation-dialog-title",open:l},i.createElement(L.a,{id:"confirmation-dialog-title"},"Filter by"),i.createElement(R.a,{dividers:!0},i.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"field-textfield",label:""!==W?"Field / "+W:"Field",size:"small",select:!0,fullWidth:!0,value:v,onChange:function(t){console.log("handleSelectField "+t.target.value);var a=e.groupByAvailable.find((function(e){return e.name===t.target.value}));console.log("handleSelectField item "+(null===a||void 0===a?void 0:a.name));var n=t.target.value&&""!==t.target.value?t.target.value:"";console.log("handleSelectField "+n),h(n)},variant:"outlined"},e.groupByAvailable.map((function(e,t){return null!=e.descriptor.childs?null:i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},"number"===W||"string"===W||"set"===W||"dictionary"===W?i.createElement(g.a,{id:"op-value-textfield",label:"op",size:"small",select:!0,fullWidth:!0,value:C,onChange:function(e){console.log("handleSelectOp "+e.target.value);var t=e.target.value&&""!==e.target.value?e.target.value:"";console.log("newOp "+t),S(t)},variant:"outlined"},"number"===W?d.map((function(e,t){return i.createElement(P.a,{key:e.value,value:e.value},e.label)})):null,"set"===W||"dictionary"===W?c.map((function(e,t){return i.createElement(P.a,{key:e.value,value:e.value},e.label)})):null,"string"===W?u.map((function(e,t){return i.createElement(P.a,{key:e.value,value:e.value},e.label)})):null):null),i.createElement(E.a,{item:!0},"number"===W||"string"===W?i.createElement(g.a,{id:"value-textfield",label:"Value",size:"small",fullWidth:!0,value:A,onChange:x,variant:"outlined"}):null,"set"===W?i.createElement(g.a,{id:"value-textfield",label:"Value",size:"small",fullWidth:!0,select:!0,value:A,onChange:x,variant:"outlined"},i.createElement(P.a,{key:"",value:""},"[No value]"),N.map((function(e){return i.createElement(P.a,{key:e,value:e},e)}))):null,"dictionary"===W?i.createElement(g.a,{id:"value-textfield",label:"Value",size:"small",fullWidth:!0,select:!0,value:A,onChange:x,variant:"outlined"},i.createElement(P.a,{key:"",value:""},"[No value]"),z.map((function(e){var t=e.key,a=e.value;return i.createElement(P.a,{key:t,value:t},a)}))):null))),i.createElement(_.a,null,i.createElement(V.a,{autoFocus:!0,onClick:function(){s(!1)},color:"primary"},"Cancel"),M?i.createElement(V.a,{onClick:j,color:"primary"},"Ok"):i.createElement(V.a,{onClick:j,disabled:!0,color:"primary"},"Ok"))))};var Y=function(e){var t=e.possiblePeriods;return i.createElement("div",{className:"QueryEditorTimeperiod"},i.createElement(g.a,{id:"outlined-select-timeperiod",size:"small",select:!0,label:"Timeperiod",variant:"outlined",onChange:function(a){var n;console.log("handleTimeperiod "+a.target.value);var r=null!==(n=t.find((function(e){return e.type===a.target.value})))&&void 0!==n?n:t[0];console.log("handleSelectSerie item "+(null===r||void 0===r?void 0:r.type)),e.onTimeperiod(r)},value:e.period.type},e.possiblePeriods.map((function(e,t){return i.createElement(P.a,{key:e.type,value:e.type},e.translation)}))))};var U=function(e){return i.createElement(y.a,{variant:"elevation",elevation:0,title:"Create query by selecting fields of the result dataset in 'Select' section and filter the result dataset by filters from 'Filter' section"},i.createElement(k.a,{variant:"h5"},"Query"),i.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},i.createElement(E.a,{item:!0},i.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},i.createElement(E.a,{item:!0},i.createElement(z,{groupBy:e.groupBy,groupByAvailable:e.groupByAvailable,onAddField:e.onAddField,onRemoveField:e.onRemoveField})),i.createElement(E.a,{item:!0},i.createElement(G,{filterItems:e.filterItems,possibleValues:e.possibleValues,groupByAvailable:e.groupByAvailable,onAddFilterItem:e.onAddFilterItem,onRemoveFilterItem:e.onRemoveFilterItem})),i.createElement(E.a,{item:!0},i.createElement(Y,{period:e.period,possiblePeriods:e.possiblePeriods,onTimeperiod:e.onTimeperiod}))))))};var X=function(e){return i.createElement(y.a,{variant:"elevation",elevation:0,title:"Choose vizualization (widget) type"},i.createElement(g.a,{id:"outlined-select-currency",size:"small",select:!0,fullWidth:!0,label:"VisualizeType",variant:"outlined",onChange:e.onChange,value:e.value},i.createElement(P.a,{key:"Events",value:"Events"},"Events"),i.createElement(P.a,{key:"Table",value:"Table"},"Aggregation"),i.createElement(P.a,{key:"PivotTable",value:"PivotTable"},"Pivot"),i.createElement(P.a,{key:"Chart",value:"Chart"},"Chart"),i.createElement(P.a,{key:"Pie",value:"Pie"},"Pie"),i.createElement(P.a,{key:"Counter",value:"Counter"},"Counter"),i.createElement(P.a,{key:"Markdown",value:"Markdown"},"Markdown")))},Q=a(390),H=a(844);var K=function(e){var t,a,r,l,s,c,u,d,p,m,v,h,f,b=function(t){return e.groupByAvailable.find((function(e){return e.name===t}))},C=e.groupBy.map((function(e){return b(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.y)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.series))})),S=e.groupBy.map((function(e){return b(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.series))})),O=e.groupBy.map((function(e){return b(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.y))})),w=o.a(e.groupBy).map((function(e){return b(e)})).filter((function(e){return!!e})).map((function(e){return e})),A=null!==(t=w.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)})).map((function(e){return e.descriptor.type})).first())&&void 0!==t?t:"",B=null!==(a=w.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.y)})).map((function(e){return e.descriptor.type})).first())&&void 0!==a?a:"",F=null!==(r=w.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.series)})).map((function(e){return e.descriptor.type})).first())&&void 0!==r?r:"",x="number"!==B?["count"]:["count","avg","sum","min","max"];return i.createElement(y.a,{variant:"elevation",elevation:0,title:"Widget type: Chart. To build chart it is required to select which field be at axis x, which field be at axis y and how it must be aggregated, which field will form series"},i.createElement(k.a,{variant:"h6"},"Chart"),i.createElement(k.a,{variant:"subtitle2"},"\xa0"),i.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"type-outlined-text",label:"Type",size:"small",select:!0,fullWidth:!0,value:null===(l=e.chart)||void 0===l?void 0:l.type,onChange:function(t){console.log("handleSelectType "+t.target.value);var a=Object(n.a)({},e.chart,{type:t.target.value});e.onChartChange(a)},variant:"outlined"},["Line","Bar","Area"].map((function(e){return i.createElement(P.a,{key:e,value:e},e)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"x-outlined-text",label:""!==A?"X Field / "+A:"X Field",size:"small",select:!0,fullWidth:!0,value:null!==(s=null===(c=e.chart)||void 0===c?void 0:c.x)&&void 0!==s?s:"",onChange:function(t){console.log("handleSelectX "+t.target.value);var a=e.groupBy.map((function(e){return b(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectX item "+(null===a||void 0===a?void 0:a.name));var r=t.target.value&&""!==t.target.value?t.target.value:void 0,i=Object(n.a)({},e.chart,{x:r});e.onChartChange(i)},variant:"outlined"},i.createElement(P.a,{key:"[no value]",value:""},"[ No value ]"),C.map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"y-outlined-text",label:""!==B?"Y Field / "+B:"Y Field",size:"small",select:!0,fullWidth:!0,value:null!==(u=null===(d=e.chart)||void 0===d?void 0:d.y)&&void 0!==u?u:"",onChange:function(t){var a;console.log("handleSelectY "+t.target.value);var r=e.groupBy.map((function(e){return b(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectY item "+(null===r||void 0===r?void 0:r.name));var i=t.target.value&&""!==t.target.value?t.target.value:void 0,l="number"!==(null===r||void 0===r?void 0:r.descriptor.type)?"count":null===(a=e.chart)||void 0===a?void 0:a.op,o=Object(n.a)({},e.chart,{y:i,op:l});e.onChartChange(o)},variant:"outlined"},i.createElement(P.a,{key:"[no value]",value:""},"[ No value ]"),S.map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"value-outlined-text",label:"Value op",size:"small",select:!0,fullWidth:!0,value:null===(p=e.chart)||void 0===p?void 0:p.op,onChange:function(t){console.log("handleSelectYOp "+t.target.value);var a=Object(n.a)({},e.chart,{op:t.target.value});e.onChartChange(a)},variant:"outlined"},x.map((function(e){return i.createElement(P.a,{key:e,value:e},e)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"series-outlined-text",label:""!==F?"Series Field / "+F:"Series Field",size:"small",select:!0,fullWidth:!0,value:null!==(m=null===(v=e.chart)||void 0===v?void 0:v.series)&&void 0!==m?m:"",onChange:function(t){console.log("handleSelectSerie "+t.target.value);var a=e.groupBy.map((function(e){return b(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectSerie item "+(null===a||void 0===a?void 0:a.name));var r=t.target.value&&""!==t.target.value?t.target.value:void 0,i=Object(n.a)({},e.chart,{series:r});e.onChartChange(i)},variant:"outlined"},i.createElement(P.a,{key:"[no value]",value:""},"[ No value ]"),O.map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},i.createElement(Q.a,{control:i.createElement(H.a,{checked:null!==(h=null===(f=e.chart)||void 0===f?void 0:f.brush)&&void 0!==h&&h,onChange:function(t){console.log("handleBrush "+t.target.value);var a=t.target.checked,r=Object(n.a)({},e.chart,{brush:a});e.onChartChange(r)},size:"small"}),label:"Brush"}))))};var Z=function(e){var t,a,r,l,s,c,u,d,p,m,v=function(t){return e.groupByAvailable.find((function(e){return e.name===t}))},h=e.groupBy.map((function(e){return v(e)})).filter((function(e){return null!=e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.y)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.series))})),f=e.groupBy.map((function(e){return v(e)})).filter((function(e){return null!=e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.series))})),y=e.groupBy.map((function(e){return v(e)})).filter((function(e){return null!=e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.y))})),b=o.a(e.groupBy).map((function(e){return v(e)})).filter((function(e){return!!e})).map((function(e){return e})),C=null!==(t=b.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)})).map((function(e){return e.descriptor.type})).first())&&void 0!==t?t:"",S=null!==(a=b.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.y)})).map((function(e){return e.descriptor.type})).first())&&void 0!==a?a:"",O=null!==(r=b.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.series)})).map((function(e){return e.descriptor.type})).first())&&void 0!==r?r:"",w="number"!==S?["count"]:["count","avg","sum","min","max"];return i.createElement("div",{title:"VisualizeType"},i.createElement(k.a,{variant:"h6"},"Pie"),i.createElement(k.a,{variant:"subtitle2"},"\xa0"),i.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"x-outlined-text",label:""!==C?"Name Field / "+C:"Name Field",size:"small",select:!0,fullWidth:!0,value:null!==(l=null===(s=e.chart)||void 0===s?void 0:s.x)&&void 0!==l?l:"",onChange:function(t){console.log("handleSelectX "+t.target.value);var a=e.groupBy.map((function(e){return v(e)})).filter((function(e){return null!=e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectX item "+(null===a||void 0===a?void 0:a.name));var r=t.target.value&&""!==t.target.value?t.target.value:void 0,i=Object(n.a)({},e.chart,{x:r});e.onChartChange(i)},variant:"outlined"},i.createElement(P.a,{key:"[no value]",value:""},"[ No value ]"),h.map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"y-outlined-text",label:""!==S?"Value Field / "+S:"Value Field",size:"small",select:!0,fullWidth:!0,value:null!==(c=null===(u=e.chart)||void 0===u?void 0:u.y)&&void 0!==c?c:"",onChange:function(t){var a;console.log("handleSelectY "+t.target.value);var r=e.groupBy.map((function(e){return v(e)})).filter((function(e){return null!=e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectY item "+(null===r||void 0===r?void 0:r.name));var i=t.target.value&&""!==t.target.value?t.target.value:void 0,l="number"!==(null===r||void 0===r?void 0:r.descriptor.type)?"count":null===(a=e.chart)||void 0===a?void 0:a.op,o=Object(n.a)({},e.chart,{y:i,op:l});e.onChartChange(o)},variant:"outlined"},i.createElement(P.a,{key:"[no value]",value:""},"[ No value ]"),f.map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"value-outlined-text",label:"Value op",size:"small",select:!0,fullWidth:!0,value:null===(d=e.chart)||void 0===d?void 0:d.op,onChange:function(t){console.log("handleSelectYOp "+t.target.value);var a=Object(n.a)({},e.chart,{op:t.target.value});e.onChartChange(a)},variant:"outlined"},w.map((function(e){return i.createElement(P.a,{key:e,value:e},e)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"series-outlined-text",label:""!==O?"Series Field / "+O:"Series Field",size:"small",select:!0,fullWidth:!0,value:null!==(p=null===(m=e.chart)||void 0===m?void 0:m.series)&&void 0!==p?p:"",onChange:function(t){console.log("handleSelectSerie "+t.target.value);var a=e.groupBy.map((function(e){return v(e)})).filter((function(e){return null!=e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectSerie item "+(null===a||void 0===a?void 0:a.name));var r=t.target.value&&""!==t.target.value?t.target.value:void 0,i=Object(n.a)({},e.chart,{series:r});e.onChartChange(i)},variant:"outlined"},i.createElement(P.a,{key:"[no value]",value:""},"[ No value ]"),y.map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)}))))))},$=["count","avg","sum","min","max"],ee=function(e){function t(){var e,a;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).handleSelectField=function(e){var t,r;console.log("handleSelectField "+e.target.value);var i=Object(n.a)({},a.props.counter,{field:e.target.value,op:null!==(t=null===(r=a.props.counter)||void 0===r?void 0:r.op)&&void 0!==t?t:"count"});a.props.onCounterChange(i)},a.handleSelectFieldGroupBy=function(e){var t,r;console.log("handleSelectFieldGroupBy "+e.target.value);var i=Object(n.a)({},a.props.counter,{fieldGroupBy:e.target.value,op:null!==(t=null===(r=a.props.counter)||void 0===r?void 0:r.op)&&void 0!==t?t:"count"});a.props.onCounterChange(i)},a.handleSelectOp=function(e){console.log("handleSelectYOp "+e.target.value);var t=Object(n.a)({},a.props.counter,{op:e.target.value});a.props.onCounterChange(t)},a.handleWithReferenceValue=function(e){var t,r;console.log("handleWithReferenceValue "+e.target.value);var i=e.target.checked,l=Object(n.a)({},a.props.counter,{referenceValue:i?0:void 0,referenceOp:i?null!==(t=null===(r=a.props.counter)||void 0===r?void 0:r.referenceOp)&&void 0!==t?t:"eq":void 0});a.props.onCounterChange(l)},a.handleReferenceValue=function(e){console.log("handleReferenceValue "+e.target.value);var t=Object(n.a)({},a.props.counter,{referenceValue:Number(e.target.value)});a.props.onCounterChange(t)},a.handleReferenceOp=function(e){console.log("handleSelectYOp "+e.target.value);var t=Object(n.a)({},a.props.counter,{referenceOp:e.target.value});a.props.onCounterChange(t)},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e,t,a,n,r,l,s,c=this,u=function(e){return c.props.groupByAvailable.find((function(t){return t.name===e}))},d=null!==(e=o.a(this.props.groupBy).map((function(e){return u(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(e){var t;return e.name===(null===(t=c.props.counter)||void 0===t?void 0:t.field)})).map((function(e){return e.descriptor.type})).first())&&void 0!==e?e:"",p="number"!==d?["count"]:$,m="number"===d,v=void 0!==(null===(t=this.props.counter)||void 0===t?void 0:t.referenceValue);return i.createElement("div",null,i.createElement(k.a,{variant:"h6"},"Counter"),i.createElement(k.a,{variant:"subtitle2"},"Note: result must contain only 1 item. This can be achived via filters."),i.createElement(k.a,{variant:"subtitle2"},"\xa0"),i.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"value-outlined-text",label:""!==d?"Field / "+d:"Field",size:"small",select:!0,fullWidth:!0,value:null===(a=this.props.counter)||void 0===a?void 0:a.field,onChange:this.handleSelectField,variant:"outlined"},this.props.groupBy.map((function(e){return u(e)})).filter((function(e){return!!e})).map((function(e){return e})).map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"value-outlined-text",label:"Value op",size:"small",select:!0,fullWidth:!0,value:null===(n=this.props.counter)||void 0===n?void 0:n.op,onChange:this.handleSelectOp,variant:"outlined"},p.map((function(e){return i.createElement(P.a,{key:e,value:e},e)})))),m?i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"value-outlined-text",label:"Group by",size:"small",select:!0,fullWidth:!0,value:null===(r=this.props.counter)||void 0===r?void 0:r.fieldGroupBy,onChange:this.handleSelectFieldGroupBy,variant:"outlined"},this.props.groupBy.map((function(e){return u(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(e){return"set"===e.descriptor.type||"dictionary"===e.descriptor.type})).map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))):null,i.createElement(E.a,{item:!0},i.createElement(Q.a,{control:i.createElement(H.a,{checked:v,onChange:this.handleWithReferenceValue,size:"small"}),label:"compare and alert if"})),v?i.createElement(E.a,{item:!0},i.createElement(E.a,{container:!0,spacing:2,direction:"row",alignItems:"stretch"},i.createElement(E.a,{item:!0,xs:3,sm:3},i.createElement(g.a,{label:"Counter",size:"small",fullWidth:!0,disabled:!0,variant:"outlined"})),i.createElement(E.a,{item:!0,xs:3,sm:3},i.createElement(g.a,{id:"op-value-textfield",label:"compare operation",size:"small",select:!0,fullWidth:!0,value:null===(l=this.props.counter)||void 0===l?void 0:l.referenceOp,onChange:this.handleReferenceOp,variant:"outlined"},[{value:"gt",label:">"},{value:"lt",label:"<"},{value:"gte",label:">="},{value:"lte",label:"<="},{value:"eq",label:"=="},{value:"neq",label:"!="}].map((function(e,t){return i.createElement(P.a,{key:e.value,value:e.value},e.label)})))),i.createElement(E.a,{item:!0,xs:3,sm:3},i.createElement(g.a,{id:"reference-outlined-number",label:"Reference",size:"small",fullWidth:!0,value:null===(s=this.props.counter)||void 0===s?void 0:s.referenceValue,onChange:this.handleReferenceValue,type:"number",InputLabelProps:{shrink:!0},variant:"outlined"})))):null))}}]),t}(i.Component),te=a(833),ae=a(837),ne=a(391),re=["count","avg","sum","min","max"],ie=function(e){function t(){var e,a;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).handleSelectField=function(e){console.log("handleSelectField "+e.target.value);var t=Object(n.a)({},a.props.table,{field:e.target.value});a.props.onTableChange(t)},a.handleSelectOp=function(e){console.log("handleSelectYOp "+e.target.value);var t=Object(n.a)({},a.props.table,{op:e.target.value});a.props.onTableChange(t)},a.handleAggregationFieldInGroupBy=function(e){console.log("handleAggregationFieldInGroupBy "+e.target.value);var t=e.target.checked,r=Object(n.a)({},a.props.table,{isAggregationFieldInGroupBy:t});a.props.onTableChange(r)},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e,t,a,n,r,l,s,c,u,d,p=this,m=o.a(this.props.groupBy).map((function(e){return t=e,p.props.groupByAvailable.find((function(e){return e.name===t}));var t})).filter((function(e){return!!e})).map((function(e){return e})),v=null!==(e=null!==(t=null===(a=this.props.table)||void 0===a?void 0:a.field)&&void 0!==t?t:o.a(this.props.groupBy).first())&&void 0!==e?e:"",h=null!==(n=m.filter((function(e){return e.name===v})).map((function(e){return e.descriptor.type})).first())&&void 0!==n?n:"",f="number"!==h?["count"]:re,y=f.includes(null!==(r=null===(l=this.props.table)||void 0===l?void 0:l.op)&&void 0!==r?r:"")&&null!==(s=null===(c=this.props.table)||void 0===c?void 0:c.op)&&void 0!==s?s:"count";return i.createElement("div",{title:"VisualizeTypeTable"},i.createElement(k.a,{variant:"h6"},"Group by"),i.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},i.createElement(E.a,{item:!0},i.createElement(te.a,null,m.map((function(e){return i.createElement(ae.a,{dense:!0,key:e.name},i.createElement(ne.a,{primary:e.translation,secondary:e.descriptor.type}))})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"value-outlined-text",label:""!==h?"Aggregate by / "+h:"Aggregate by",size:"small",select:!0,fullWidth:!0,value:v,onChange:this.handleSelectField,variant:"outlined"},m.map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"value-outlined-text",label:"Aggregate op",size:"small",select:!0,fullWidth:!0,value:y,onChange:this.handleSelectOp,variant:"outlined"},f.map((function(e){return i.createElement(P.a,{key:e,value:e},e)})))),i.createElement(E.a,{item:!0},i.createElement(Q.a,{control:i.createElement(H.a,{checked:null!==(u=null===(d=this.props.table)||void 0===d?void 0:d.isAggregationFieldInGroupBy)&&void 0!==u&&u,onChange:this.handleAggregationFieldInGroupBy,size:"small"}),label:"Include aggregation field in group by"}))))}}]),t}(i.Component);var le=function(e){var t,a,r,l,s,c,u,d,p,m,v,h,f=function(t){return e.groupByAvailable.find((function(e){return e.name===t}))},y=e.groupBy.map((function(e){return f(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.pivot)||void 0===a?void 0:a.values)||t.name===(null===(n=e.pivot)||void 0===n?void 0:n.columns))})),b=e.groupBy.map((function(e){return f(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.pivot)||void 0===a?void 0:a.rows)||t.name===(null===(n=e.pivot)||void 0===n?void 0:n.values))})),C=e.groupBy.map((function(e){return f(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.pivot)||void 0===a?void 0:a.rows)||t.name===(null===(n=e.pivot)||void 0===n?void 0:n.columns))})),S=o.a(e.groupBy).map((function(e){return f(e)})).filter((function(e){return!!e})).map((function(e){return e})),O=null!==(t=S.filter((function(t){var a;return t.name===(null===(a=e.pivot)||void 0===a?void 0:a.rows)})).map((function(e){return e.descriptor.type})).first())&&void 0!==t?t:"",w=null!==(a=S.filter((function(t){var a;return t.name===(null===(a=e.pivot)||void 0===a?void 0:a.columns)})).map((function(e){return e.descriptor.type})).first())&&void 0!==a?a:"",A=null!==(r=S.filter((function(t){var a;return t.name===(null===(a=e.pivot)||void 0===a?void 0:a.values)})).map((function(e){return e.descriptor.type})).first())&&void 0!==r?r:"",B="number"!==A?["count"]:["count","avg","sum","min","max"];return i.createElement("div",{title:"VisualizeTypePivotTable"},i.createElement(k.a,{variant:"h6"},"Pivot table"),i.createElement(k.a,{variant:"subtitle2"},"\xa0"),i.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"rows-outlined-text",label:""!==O?"Rows Field / "+O:"Rows Field",size:"small",select:!0,fullWidth:!0,value:null!==(l=null===(s=e.pivot)||void 0===s?void 0:s.rows)&&void 0!==l?l:"",onChange:function(t){console.log("handleSelectRows "+t.target.value);var a=e.groupBy.map((function(e){return f(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectRows item "+(null===a||void 0===a?void 0:a.name));var r=t.target.value&&""!==t.target.value?t.target.value:void 0,i=Object(n.a)({},e.pivot,{rows:r});e.onPivotTableChange(i)},variant:"outlined"},i.createElement(P.a,{key:"[no value]",value:""},"[ No value ]"),y.map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"columns-outlined-text",label:""!==w?"Columns Field / "+w:"Columns Field",size:"small",select:!0,fullWidth:!0,value:null!==(c=null===(u=e.pivot)||void 0===u?void 0:u.columns)&&void 0!==c?c:"",onChange:function(t){console.log("handleSelectColumns "+t.target.value);var a=e.groupBy.map((function(e){return f(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectColumns item "+(null===a||void 0===a?void 0:a.name));var r=t.target.value&&""!==t.target.value?t.target.value:void 0,i=Object(n.a)({},e.pivot,{columns:r});e.onPivotTableChange(i)},variant:"outlined"},i.createElement(P.a,{key:"[no value]",value:""},"[ No value ]"),b.map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"values-outlined-text",label:""!==A?"Values Field / "+A:"Values Field",size:"small",select:!0,fullWidth:!0,value:null!==(d=null===(p=e.pivot)||void 0===p?void 0:p.values)&&void 0!==d?d:"",onChange:function(t){var a;console.log("handleSelectValues "+t.target.value);var r=e.groupBy.map((function(e){return f(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectValues item "+(null===r||void 0===r?void 0:r.name));var i=t.target.value&&""!==t.target.value?t.target.value:void 0,l="number"!==(null===r||void 0===r?void 0:r.descriptor.type)?"count":null===(a=e.pivot)||void 0===a?void 0:a.op,o=Object(n.a)({},e.pivot,{values:i,op:l});e.onPivotTableChange(o)},variant:"outlined"},i.createElement(P.a,{key:"[no value]",value:""},"[ No value ]"),C.map((function(e){return i.createElement(P.a,{key:e.name,value:e.name},e.translation)})))),i.createElement(E.a,{item:!0},i.createElement(g.a,{id:"values-op-outlined-text",label:"Value op",size:"small",select:!0,fullWidth:!0,value:null===(m=e.pivot)||void 0===m?void 0:m.op,onChange:function(t){console.log("handleSelectValuesOp "+t.target.value);var a=Object(n.a)({},e.pivot,{op:t.target.value});e.onPivotTableChange(a)},variant:"outlined"},B.map((function(e){return i.createElement(P.a,{key:e,value:e},e)})))),i.createElement(E.a,{item:!0},i.createElement(Q.a,{control:i.createElement(H.a,{checked:null!==(v=null===(h=e.pivot)||void 0===h?void 0:h.fixed1)&&void 0!==v&&v,onChange:function(t){console.log("handleFixed1 "+t.target.value);var a=t.target.checked,r=Object(n.a)({},e.pivot,{fixed1:a});e.onPivotTableChange(r)},size:"small"}),label:"Fixed 1 column"}))))},oe=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return i.createElement("div",{title:"VisualizeTypeTable"},i.createElement(k.a,{variant:"h6"},"Events support is ugly on server. Can't select fields. Response with strange names not found in field list. To be fixed in future."),i.createElement(k.a,{variant:"subtitle2"},"\xa0"),i.createElement(k.a,{variant:"subtitle2"},"TODO: add limit option"))}}]),t}(i.Component);var se=function(e){var t;return i.createElement("div",{title:"VisualizeTypePivotTable"},i.createElement(k.a,{variant:"h6"},"Markdown"),i.createElement(k.a,{variant:"subtitle2"},"\xa0"),i.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},i.createElement(E.a,{item:!0},i.createElement(Q.a,{control:i.createElement(H.a,{checked:null!==(t=e.bottom)&&void 0!==t&&t,onChange:function(t){console.log("handleMarkdownBottomChange "+t.target.value);var a=t.target.checked;e.onMarkdownBottomChange(a)},size:"small"}),label:"at bottom"}))))},ce=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return i.createElement(y.a,{variant:"elevation",elevation:0,title:"Choose the way in which the result dataset or some static information will be presented"},i.createElement(k.a,{variant:"h5"},"Visualize"),i.createElement(k.a,{variant:"subtitle2"},"\xa0"),i.createElement(X,{value:this.props.visualizeType,onChange:this.props.onChange}),i.createElement(k.a,{variant:"subtitle2"},"\xa0"),"Chart"===this.props.visualizeType?i.createElement(K,{chart:this.props.chart,groupBy:this.props.groupBy,groupByAvailable:this.props.groupByAvailable,onChartChange:this.props.onChartChange}):null,"Pie"===this.props.visualizeType?i.createElement(Z,{chart:this.props.chart,groupBy:this.props.groupBy,groupByAvailable:this.props.groupByAvailable,onChartChange:this.props.onChartChange}):null,"Counter"===this.props.visualizeType?i.createElement(ee,{counter:this.props.counter,groupBy:this.props.groupBy,groupByAvailable:this.props.groupByAvailable,onCounterChange:this.props.onCounterChange}):null,"Table"===this.props.visualizeType?i.createElement(ie,{table:this.props.table,groupBy:this.props.groupBy,groupByAvailable:this.props.groupByAvailable,onTableChange:this.props.onTableChange}):null,"PivotTable"===this.props.visualizeType?i.createElement(le,{pivot:this.props.pivot,groupBy:this.props.groupBy,groupByAvailable:this.props.groupByAvailable,onPivotTableChange:this.props.onPivotTableChange}):null,"Events"===this.props.visualizeType?i.createElement(oe,null):null,"Markdown"===this.props.visualizeType?i.createElement(se,{bottom:this.props.bottom,onMarkdownBottomChange:this.props.onMarkdownBottomChange}):null,i.createElement(k.a,{variant:"subtitle2"},"\xa0"))}}]),t}(i.Component),ue=a(29),de=a.n(ue),pe=a(845),me=a(846),ve=a(847),he=a(848),fe=a(449),ge=a(189),ye=a.n(ge),Ee=a(127),be=a.n(Ee),Ce=a(160),ke=a.n(Ce),Se=a(188),Oe=a.n(Se),we=a(490),Ae=a(718),Be=a.n(Ae),Fe=a(447),xe=a.n(Fe),je=a(448),De=a.n(je);xe.a.vfs=De.a.pdfMake.vfs;var Te=function(e){function t(){var e,a;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).state={rows:void 0,err:void 0,openFullscreen:!1},a.lineChart=null,a.barChart=null,a.areaChart=null,a.handleFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!0})}))},a.handleFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!1})}))},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.stringToColour=function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);for(var n="#",r=0;r<3;r++){n+=("00"+(t>>8*r&255).toString(16)).substr(-2)}return n},a.download=function(){var e=document.getElementById("download"),t=document.getElementById("myCanvas").toDataURL("image/png").replace("image/png","image/octet-stream");e.setAttribute("href",t)},a.exportChart=function(e){var t,n,r=null!==(t=null!==(n=a.lineChart)&&void 0!==n?n:a.barChart)&&void 0!==t?t:a.areaChart;if(r){var i=de.a.findDOMNode(r).children[0];if(e){var l,o,s=(new XMLSerializer).serializeToString(i),c=(new Blob([s],{type:"image/svg+xml;charset=utf-8"}),l=i.getAttribute("width"),o=i.getAttribute("height"),{footer:function(e,t){return{text:"Created at "+new Date,alignment:"center"}},content:[a.props.title,"\n",a.props.description,"\n","something more can be added",{svg:s,width:500}]});xe.a.createPdf(c).download(a.props.title+".pdf")}else{var u=new Blob([i.outerHTML],{type:"text/html;charset=utf-8"});Be.a.saveAs(u,a.props.title+".html")}}},a.svgToPng=function(e,t,a){return new Promise((function(n,r){var i=document.createElement("canvas");i.width=t,i.height=a;var l=i.getContext("2d");l.fillStyle="#ffffff",l.fillRect(0,0,t,a);var o=(new XMLSerializer).serializeToString(e),s="data:image/svg+xml;utf8,"+encodeURIComponent(o),c=new Image(t,a);c.onload=function(){l.drawImage(c,0,0);var e=i.toDataURL("image/png",1);n(e)},c.onerror=function(){return r()},c.src=s}))},a.handleDownloadSvg=function(){var e,t,n=null!==(e=null!==(t=a.lineChart)&&void 0!==t?t:a.barChart)&&void 0!==e?e:a.areaChart;if(n){var r=de.a.findDOMNode(n).children[0],i=(new XMLSerializer).serializeToString(r),l=new Blob([i],{type:"image/svg+xml;charset=utf-8"});Be.a.saveAs(l,a.props.title+".svg")}},a.handleDownloadPng=Object(F.a)(B.a.mark((function e(){var t,n,r,i,l,o,s,c,u,d;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=null!==(t=null!==(n=a.lineChart)&&void 0!==n?n:a.barChart)&&void 0!==t?t:a.areaChart)){e.next=14;break}return o=de.a.findDOMNode(r).children[0],s=null!==(i=o.getAttribute("width"))&&void 0!==i?i:"1920",c=null!==(l=o.getAttribute("height"))&&void 0!==l?l:"1080",e.next=7,a.svgToPng(o,Number(s),Number(c));case 7:u=e.sent,u.replace("image/png","image/octet-stream"),new Blob([u],{type:"image/png"}),(d=document.createElement("a")).href=u,d.download=a.props.title+".png",d.click();case 14:case"end":return e.stop()}}),e)}))),a.handleDownloadPdf=function(){a.exportChart(!0)},a.handleDownload=function(){a.exportChart(!0)},a.handleDownload1=Object(F.a)(B.a.mark((function e(){var t,n,r,i,l,o;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=null!==(t=null!==(n=a.lineChart)&&void 0!==n?n:a.barChart)&&void 0!==t?t:a.areaChart)){e.next=9;break}return i=de.a.findDOMNode(r).children[0],e.next=5,a.svgToPng(i,900,500);case 5:l=e.sent,o=l.replace("image/png","image/octet-stream"),document.getElementById("download").setAttribute("href",o);case 9:case"end":return e.stop()}}),e)}))),a.handleDownload111=Object(F.a)(B.a.mark((function e(){var t,n,r,i,l,o;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=null!==(t=null!==(n=a.lineChart)&&void 0!==n?n:a.barChart)&&void 0!==t?t:a.areaChart)){e.next=8;break}return i=de.a.findDOMNode(r).children[0],e.next=5,a.svgToPng(i,546,300);case 5:l=e.sent,o={content:["SVG nodes behave similar to images by supporting width/height or fit","It is however not yet possible to use svg files or to have a library of svgs in the document definition","\n","Note that before you can use SVG nodes you must install svg-to-pdfkit as it is not included with pdfmake to keep bundle size down",{image:l,width:546,height:300}]},xe.a.createPdf(o).download("chart.pdf");case 8:case"end":return e.stop()}}),e)}))),a.loadData=function(){console.log("WidgetPreviewChart loadData"),a.setState({rows:void 0,err:void 0});var e=a.props.api+"/api/v2/ad-query/aggregation/table",t=a.props.chartState,n=t.x,r=t.y,i=t.op,l=t.series,o={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})).map((function(e){return{field:e.field,op:e.op,value:e.value}})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},groupBy:[n,r,l],fields:[{field:r,op:i}]},s={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(o)};fetch(e,s).then((function(e){return e.json()})).then((function(e){if(null==e.result)throw Error("no rows in result"+JSON.stringify(e));var t=e.result;console.log("WidgetPreviewLineChart r="+JSON.stringify(t)),a.setState({rows:t}),console.log("WidgetPreviewLineChart data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a.handleClick=function(e,t){e&&console.log("onClick "+a.props.title+" index="+t+" data[index]="+JSON.stringify(e.payload))},a.handleClickLine=function(e,t){e&&console.log("onClick "+a.props.title+" activeLabel="+e.activeLabel)},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetPreviewChart componentDidMount "+JSON.stringify(this.props.chartState)),this.loadData()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetPreviewChart componentDidUpdate "+JSON.stringify(this.props.chartState)),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadData()}},{key:"render",value:function(){var e=this;if(this.state.err)return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,null,"Error: ",this.state.err)));if(!this.props.chartState)return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,null,"Error: no chartState")));var t=this.props.chartState,a=t.type,n=t.x,r=t.y,l=t.op,s=t.series;if(!a)return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,null,"Error: no type")));if(!n||!r||!l||!s)return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,null,"Error: chartState content ",JSON.stringify(this.props.chartState))));if(!this.state.rows)return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,null,"Error: no rows")));var c,u=this.state.rows,d=this.props.groupByAvailable.filter((function(t){return t.name===e.props.chartState.series})),p=this.props.chartState.series,m=d[0].descriptor.type,v=[];"set"===m?v=(null===(c=this.props.possibleValues.set.get(p))||void 0===c?void 0:c.map((function(e){return{key:e,value:e}})))||[]:"dictionary"===m&&(v=this.props.possibleValues.dictionary.get(p)||[]);console.log(v);var h=u.reduce((function(e,t){var a=t[s];return e.add(a),e}),new Set);v=v.filter((function(e){return h.has(e.key)}));var f=u.reduce((function(e,t){var a=t[n],i=e.get(a)||{x:a};return i[t[s]]=t[l+"_"+r],e.set(a,i),e}),new Map);console.log(f);var g=o.a(f.values()).sortBy((function(e){return e.x}));console.log(g.toArray());var y=g.toArray(),E=i.createElement(k.a,null,"Error: unknown type ",a);return"Line"===a&&(E=i.createElement(we.j,{ref:function(t){return e.lineChart=t},width:400,height:300,data:y,margin:{top:5,right:20,left:10,bottom:5},onClick:this.handleClickLine},i.createElement(we.o,{dataKey:"x"}),i.createElement(we.p,null),i.createElement(we.n,null),i.createElement(we.h,null),i.createElement(we.f,{stroke:"#f5f5f5",strokeDasharray:"5 5"}),v.map((function(t){return i.createElement(we.i,{type:"monotone",connectNulls:!0,stroke:e.stringToColour(t.key),isAnimationActive:!1,dataKey:t.key,name:t.value,activeDot:{onClick:function(e){return console.log("activeDot: ",e)}}})})),this.props.chartState.brush?i.createElement(we.e,null):null)),"Bar"===a&&(E=i.createElement(we.d,{ref:function(t){return e.barChart=t},width:400,height:300,data:y,margin:{top:5,right:20,left:10,bottom:5},onClick:this.handleClickLine},i.createElement(we.o,{dataKey:"x"}),i.createElement(we.p,null),i.createElement(we.n,null),i.createElement(we.h,null),i.createElement(we.f,{stroke:"#f5f5f5",strokeDasharray:"5 5"}),v.map((function(t){return i.createElement(we.c,{stroke:e.stringToColour(t.key),fill:e.stringToColour(t.key),dataKey:t.key,name:t.value,onClick:e.handleClick})})),this.props.chartState.brush?i.createElement(we.e,null):null)),"Area"===a&&(E=i.createElement(we.b,{ref:function(t){return e.areaChart=t},width:400,height:300,data:y,margin:{top:5,right:20,left:10,bottom:5},onClick:this.handleClickLine},i.createElement(we.o,{dataKey:"x"}),i.createElement(we.p,null),i.createElement(we.n,null),i.createElement(we.h,null),i.createElement(we.f,{stroke:"#f5f5f5",strokeDasharray:"5 5"}),v.map((function(t){return i.createElement(we.a,{type:"monotone",connectNulls:!0,stroke:e.stringToColour(t.key),fill:e.stringToColour(t.key),fillOpacity:.5,dataKey:t.key,name:t.value})})),this.props.chartState.brush?i.createElement(we.e,null):null)),i.createElement("div",{id:this.props.id},i.createElement(pe.a,{variant:"outlined"},i.createElement(ve.a,{action:i.createElement(T.a,{"aria-label":"fullscreen",onClick:this.handleFullscreenOpen},i.createElement(Oe.a,null)),title:this.props.title,subheader:this.props.description}),i.createElement(me.a,null,i.createElement(we.m,{width:"95%",height:300},E)),this.props.isEditMode?i.createElement(he.a,{disableSpacing:!0},i.createElement(T.a,{"aria-label":"edit",onClick:this.handleEdit},i.createElement(be.a,null)),i.createElement(T.a,{"aria-label":"delete",onClick:this.handleDelete},i.createElement(ke.a,null))):null),i.createElement(q.a,{fullScreen:!0,open:this.state.openFullscreen,onClose:this.handleFullscreenClose},i.createElement(L.a,{id:"editor-dialog-title"},i.createElement(fe.a,{variant:"dense"},i.createElement(T.a,{edge:"start",color:"inherit",onClick:this.handleFullscreenClose,"aria-label":"close"},i.createElement(ye.a,null)),i.createElement(k.a,{variant:"h6"},this.props.title),i.createElement(V.a,{color:"inherit",onClick:this.handleDownloadPdf},"PDF"),i.createElement(V.a,{color:"inherit",onClick:this.handleDownloadSvg},"SVG"),i.createElement(V.a,{color:"inherit",onClick:this.handleDownloadPng},"PNG"))),i.createElement(R.a,null,i.createElement(k.a,{variant:"h6"},this.props.description),i.createElement(we.m,{width:"95%",height:700},E))))}}]),t}(i.Component),Ie=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={rows:void 0,err:void 0},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.loadData=function(){console.log("WidgetPreviewPie loadData"),a.setState({rows:void 0,err:void 0});var e=a.props.api+"/api/v2/ad-query/aggregation/table",t=a.props.chartState,n=t.x,r=t.y,i=t.op,l=t.series,o={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})).map((function(e){return{field:e.field,op:e.op,value:e.value}})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},groupBy:[n,r,l],fields:[{field:r,op:i}]},s={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(o)};fetch(e,s).then((function(e){return e.json()})).then((function(e){if(null==e.result)throw Error("no rows in result"+JSON.stringify(e));var t=e.result;console.log("WidgetPreviewLineChart r="+JSON.stringify(t)),a.setState({rows:t}),console.log("WidgetPreviewLineChart data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetPreviewPie componentDidMount "+JSON.stringify(this.props.chartState)),this.loadData()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetPreviewPie componentDidUpdate "+JSON.stringify(this.props.chartState)),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadData()}},{key:"render",value:function(){var e=this;if(this.state.err)return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,null,"Error: ",this.state.err)));if(!this.props.chartState)return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,null,"Error: no chartState")));var t=this.props.chartState,a=t.x,n=t.y,r=t.op,l=t.series;if(!a||!n||!r||!l)return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,null,"Error: chartState content ",JSON.stringify(this.props.chartState))));if(!this.state.rows)return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,null,"Error: no rows")));var s,c=this.state.rows,u=this.props.groupByAvailable.filter((function(t){return t.name===e.props.chartState.series})),d=this.props.chartState.series,p=u[0].descriptor.type,m=[];"set"===p?m=(null===(s=this.props.possibleValues.set.get(d))||void 0===s?void 0:s.map((function(e){return{key:e,value:e}})))||[]:"dictionary"===p&&(m=this.props.possibleValues.dictionary.get(d)||[]);console.log(m);var v=c.reduce((function(e,t){var a=t[l];return e.add(a),e}),new Set);m=m.filter((function(e){return v.has(e.key)}));var h=c.reduce((function(e,t){var i=t[l]+"("+t[a]+")",o=e.get(i)||{x:i};return o.value=t[r+"_"+n],e.set(i,o),e}),new Map);console.log(h);var f=o.a(h.keys()).sortBy((function(e){return e.x})),g=o.a(h.values()).sortBy((function(e){return e.x}));console.log(f.toArray()),console.log(g.toArray());var y=g.toArray(),E=function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);for(var n="#",r=0;r<3;r++){n+=("00"+(t>>8*r&255).toString(16)).substr(-2)}return n};return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,{align:"center",color:"textSecondary",gutterBottom:!0},this.props.title),i.createElement(we.m,{width:"95%",height:400},i.createElement(we.l,{width:400,height:400,margin:{top:5,right:20,left:10,bottom:5}},i.createElement(we.n,null),i.createElement(we.h,null),i.createElement(we.k,{cx:"50%",cy:"50%",data:y,label:!0,innerRadius:80,outerRadius:100,dataKey:"value",nameKey:"x",key:"value"},y.map((function(e,t){return i.createElement(we.g,{key:"cell-".concat(t),fill:E(e.x)})}))))),i.createElement(k.a,{align:"center",color:"textSecondary"},this.props.description)),this.props.isEditMode?i.createElement(he.a,{disableSpacing:!0},i.createElement(T.a,{"aria-label":"edit",onClick:this.handleEdit},i.createElement(be.a,null)),i.createElement(T.a,{"aria-label":"delete",onClick:this.handleDelete},i.createElement(ke.a,null))):null)}}]),t}(i.Component),Pe=a(300),We=a.n(Pe),Ne=a(309),ze=a.n(Ne),Ve=a(320),Me=a.n(Ve),Je=a(310),Le=a.n(Je),Re=a(318),_e=a.n(Re),qe=a(313),Ge=a.n(qe),Ye=a(311),Ue=a.n(Ye),Xe=a(312),Qe=a.n(Xe),He=a(315),Ke=a.n(He),Ze=a(316),$e=a.n(Ze),et=a(317),tt=a.n(et),at=a(321),nt=a.n(at),rt=a(314),it=a.n(rt),lt=a(319),ot=a.n(lt),st=a(322),ct=a.n(st),ut=a(246),dt=a.n(ut),pt=function(e){return Object(i.forwardRef)((function(t,a){return l.a.createElement(e,Object.assign({},t,{ref:a}))}))},mt={Add:pt(ze.a),Check:pt(Le.a),Clear:pt(Ue.a),Delete:pt(Qe.a),DetailPanel:pt(Ge.a),Edit:pt(be.a),Export:pt(it.a),Filter:pt(Ke.a),FirstPage:pt($e.a),LastPage:pt(tt.a),NextPage:pt(Ge.a),PreviousPage:pt(_e.a),ResetSearch:pt(Ue.a),Search:pt(ot.a),SortArrow:pt(Me.a),ThirdStateCheck:pt(nt.a),ViewColumn:pt(ct.a)},vt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).state={rows:void 0,err:void 0,openFullscreen:!1,selected:void 0},a.handleFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!0})}))},a.handleFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!1})}))},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.loadData=function(){var e,t,n,r,i;console.log("WidgetAggregationTable loadData"),a.setState({rows:void 0,err:void 0});var l=a.props.api+"/api/v2/ad-query/aggregation/table",s=o.a(a.props.groupBy).map((function(e){return t=e,a.props.groupByAvailable.find((function(e){return e.name===t}));var t})).filter((function(e){return!!e})).map((function(e){return e})),c=null!==(e=null!==(t=a.props.tableState.field)&&void 0!==t?t:o.a(a.props.groupBy).first())&&void 0!==e?e:"",u=null!==(n=s.filter((function(e){return e.name===c})).map((function(e){return e.descriptor.type})).first())&&void 0!==n?n:"",d=a.props.tableState.isAggregationFieldInGroupBy?a.props.groupBy.toArray():a.props.groupBy.filter((function(e){return e!==c})).toArray(),p=("number"!==u?["count"]:["count","avg","sum","min","max"]).includes(null!==(r=a.props.tableState.op)&&void 0!==r?r:"")&&null!==(i=a.props.tableState.op)&&void 0!==i?i:"count",m={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},groupBy:d,fields:[{field:c,op:p}]},v={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(m)};fetch(l,v).then((function(e){return e.json()})).then((function(e){if(null==e.result)throw Error("no rows in result"+JSON.stringify(e));var t=e.result.map((function(e){return e}));a.setState({rows:t}),console.log("WidgetAggregationTable data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetAggregationTable componentDidMount "+this.props.tableState.field),this.loadData()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetAggregationTable componentDidUpdate "+this.props.tableState.field),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadData()}},{key:"render",value:function(){var e,t,a,n,r,i,s=this,c=o.a(this.props.groupBy).map((function(e){return t=e,s.props.groupByAvailable.find((function(e){return e.name===t}));var t})).filter((function(e){return!!e})).map((function(e){return e})),u=null!==(e=null!==(t=this.props.tableState.field)&&void 0!==t?t:o.a(this.props.groupBy).first())&&void 0!==e?e:"",d=null!==(a=c.filter((function(e){return e.name===u})).map((function(e){return e.descriptor.type})).first())&&void 0!==a?a:"",p=null!==(n=c.filter((function(e){return e.name===u})).map((function(e){return e.translation})).first())&&void 0!==n?n:u,m=("number"!==d?["count"]:["count","avg","sum","min","max"]).includes(null!==(r=this.props.tableState.op)&&void 0!==r?r:"")&&null!==(i=this.props.tableState.op)&&void 0!==i?i:"count",v=c.filter((function(e){return!!s.props.tableState.isAggregationFieldInGroupBy||e.name!==u})).map((function(e){var t=[];"dictionary"===e.descriptor.type&&(t=(t=s.props.possibleValues.dictionary.get(e.name)||[]).map((function(e){return{key:e.key,value:e.value&&""!==e.value?e.value:e.key}})));var a=t.reduce((function(e,t){var a=t.key,n=t.value;return e.set(a,n),e}),new Map),n=Object.fromEntries(a.entries());return console.log(n),{field:e.name,title:e.translation,lookup:"dictionary"===e.descriptor.type?n:void 0}})),h={field:m+"_"+u,title:m+"("+p+")"},f=v.toArray().concat(h);if(this.state.err)return l.a.createElement(pe.a,{variant:"outlined"},l.a.createElement(me.a,null,l.a.createElement(k.a,null,"Error: ",this.state.err)));var g=l.a.createElement(We.a,{icons:mt,columns:f,onColumnDragged:function(e,t){console.log("Dropped column from "+e+" to position "+t)},options:{showTitle:!1,padding:"dense",exportAllData:!0,exportButton:!0,exportFileName:this.props.title+"."+dt()().format("YYYYMMDDTHHmmss"),rowStyle:function(e){return{backgroundColor:s.state.selected===e.tableData.id?"#EEE":"#FFF"}}},onRowClick:function(e,t){return s.setState({selected:null===t||void 0===t?void 0:t.tableData.id})},title:this.props.title,isLoading:!this.state.rows&&!this.state.err,data:this.state.rows,components:{Container:function(e){return l.a.createElement(y.a,Object.assign({},e,{elevation:0}))}}});return l.a.createElement("div",{id:this.props.id},l.a.createElement(pe.a,{variant:"outlined",title:this.props.title},l.a.createElement(ve.a,{action:l.a.createElement(T.a,{"aria-label":"fullscreen",onClick:this.handleFullscreenOpen},l.a.createElement(Oe.a,null)),title:this.props.title,subheader:this.props.description}),l.a.createElement(me.a,null,g),this.props.isEditMode?l.a.createElement(he.a,{disableSpacing:!0},l.a.createElement(T.a,{"aria-label":"edit",onClick:this.handleEdit},l.a.createElement(be.a,null)),l.a.createElement(T.a,{"aria-label":"delete",onClick:this.handleDelete},l.a.createElement(ke.a,null))):null),l.a.createElement(q.a,{fullScreen:!0,open:this.state.openFullscreen,onClose:this.handleFullscreenClose},l.a.createElement(L.a,{id:"editor-dialog-title"},l.a.createElement(fe.a,{variant:"dense"},l.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.handleFullscreenClose,"aria-label":"close"},l.a.createElement(ye.a,null)),l.a.createElement(k.a,{variant:"h6"},this.props.title))),l.a.createElement(R.a,null,l.a.createElement(k.a,{variant:"h6"},this.props.description),g)))}}]),t}(l.a.Component),ht=a(814),ft=a.n(ht),gt=a(30),yt=function(e){return Object(i.forwardRef)((function(t,a){return l.a.createElement(e,Object.assign({},t,{ref:a}))}))},Et={Add:yt(ze.a),Check:yt(Le.a),Clear:yt(Ue.a),Delete:yt(Qe.a),DetailPanel:yt(Ge.a),Edit:yt(be.a),Export:yt(it.a),Filter:yt(Ke.a),FirstPage:yt($e.a),LastPage:yt(tt.a),NextPage:yt(Ge.a),PreviousPage:yt(_e.a),ResetSearch:yt(Ue.a),Search:yt(ot.a),SortArrow:yt(Me.a),ThirdStateCheck:yt(nt.a),ViewColumn:yt(ct.a)},bt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).state={rows:void 0,err:void 0,openEventFullscreen:!1,openFullscreen:!1,selected:void 0},a.handleEventFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openEventFullscreen:!0})}))},a.handleEventFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openEventFullscreen:!1})}))},a.handleFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!0})}))},a.handleFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!1})}))},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.loadData=function(){console.log("WidgetEvents loadData"),a.setState({rows:void 0,err:void 0});var e=a.props.api+"/api/v2/ad-query/events",t={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},limit:a.props.limit},n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(t)};fetch(e,n).then((function(e){return e.json()})).then((function(e){if(null==e.events)throw Error("no events in result"+JSON.stringify(e));var t,n=null!==(t=e.events)&&void 0!==t?t:[];a.setState({rows:n}),console.log("WidgetEvents data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetEvents componentDidMount "),this.loadData()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetEvents componentDidUpdate "),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadData()}},{key:"render",value:function(){var e=this;if(this.state.err)return l.a.createElement(pe.a,{variant:"outlined"},l.a.createElement(me.a,null,l.a.createElement(k.a,null,"Error: ",this.state.err)));var t=[{field:"id",title:"id",hidden:!0},{field:"time_date",title:"date",type:"date"},{field:"time_time",title:"time",type:"time"},{field:"source_video_name",title:"video"},{field:"source_server_name",title:"server"},{field:"source_detector_name",title:"detector"},{field:"event_detector_type_name",title:"detector_type"},{field:"link",title:"sample link",render:function(e){return l.a.createElement(ae.a,{button:!0,component:gt.c,to:"/id/"+e.id},l.a.createElement(ne.a,{primary:"sample link"}))}},{field:"raw",title:"raw",headerStyle:{font:"bold"},render:function(e){return JSON.stringify(e)}}],a=l.a.createElement(We.a,{icons:Et,columns:t,onColumnDragged:function(e,t){console.log("Dropped column from "+e+" to position "+t)},options:{selection:!0,toolbarButtonAlignment:"left",showTitle:!1,padding:"dense",exportAllData:!0,exportButton:!0,draggable:this.props.isEditMode,exportFileName:this.props.title+"."+dt()().format("YYYYMMDDTHHmmss"),rowStyle:function(t){return{backgroundColor:e.state.selected===t.tableData.id?"#EEE":"#FFF"}}},actions:[{tooltip:"Tag",icon:function(){return l.a.createElement(ft.a,null)},onClick:function(e,t){var a=null===t||void 0===t?void 0:t.length;alert("You want to add tag to "+a+" rows. Not implemented in backend yet.")}}],onRowClick:function(t,a){e.setState({openEventFullscreen:!0,selectedEvent:a})},title:this.props.title,isLoading:!this.state.rows&&!this.state.err,data:this.state.rows,components:{Container:function(e){return l.a.createElement(y.a,Object.assign({},e,{elevation:0}))}}});return l.a.createElement("div",{id:this.props.id},l.a.createElement(pe.a,{variant:"outlined",title:this.props.title},l.a.createElement(ve.a,{action:l.a.createElement(T.a,{"aria-label":"fullscreen",onClick:this.handleFullscreenOpen},l.a.createElement(Oe.a,null)),title:this.props.title,subheader:this.props.description}),l.a.createElement(me.a,null,a),this.props.isEditMode?l.a.createElement(he.a,{disableSpacing:!0},l.a.createElement(T.a,{"aria-label":"edit",onClick:this.handleEdit},l.a.createElement(be.a,null)),l.a.createElement(T.a,{"aria-label":"delete",onClick:this.handleDelete},l.a.createElement(ke.a,null))):null),l.a.createElement(q.a,{fullScreen:!0,open:this.state.openFullscreen,onClose:this.handleFullscreenClose},l.a.createElement(L.a,{id:"editor-dialog-title"},l.a.createElement(fe.a,{variant:"dense"},l.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.handleFullscreenClose,"aria-label":"close"},l.a.createElement(ye.a,null)),l.a.createElement(k.a,{variant:"h6"},this.props.title))),l.a.createElement(R.a,null,l.a.createElement(k.a,{variant:"h6"},this.props.description),a)),l.a.createElement(q.a,{fullScreen:!0,open:this.state.openEventFullscreen,onClose:this.handleEventFullscreenClose},l.a.createElement(L.a,{id:"event-dialog-title"},l.a.createElement(fe.a,{variant:"dense"},l.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.handleEventFullscreenClose,"aria-label":"close"},l.a.createElement(ye.a,null)),l.a.createElement(k.a,{variant:"h6"},"Event"))),l.a.createElement(R.a,null,l.a.createElement(k.a,{variant:"h6"},"TODO: show snapshot / video player"),l.a.createElement("pre",null,JSON.stringify(this.state.selectedEvent,void 0,2)))))}}]),t}(l.a.Component),Ct=function(e){return Object(i.forwardRef)((function(t,a){return l.a.createElement(e,Object.assign({},t,{ref:a}))}))},kt={Add:Ct(ze.a),Check:Ct(Le.a),Clear:Ct(Ue.a),Delete:Ct(Qe.a),DetailPanel:Ct(Ge.a),Edit:Ct(be.a),Export:Ct(it.a),Filter:Ct(Ke.a),FirstPage:Ct($e.a),LastPage:Ct(tt.a),NextPage:Ct(Ge.a),PreviousPage:Ct(_e.a),ResetSearch:Ct(Ue.a),Search:Ct(ot.a),SortArrow:Ct(Me.a),ThirdStateCheck:Ct(nt.a),ViewColumn:Ct(ct.a)},St=function(e){function t(){var e,a;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).state={rows:void 0,err:void 0,openFullscreen:!1,selected:void 0},a.handleFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!0})}))},a.handleFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!1})}))},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.loadData=function(){console.log("WidgetPivotTable loadData"),a.setState({rows:void 0,err:void 0});var e=a.props.api+"/api/v2/ad-query/aggregation/table",t=a.props.tableState,n=t.rows,r=t.columns,i=t.values,l=t.op,o={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},groupBy:[n,r,i],fields:[{field:i,op:l}]},s={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(o)};fetch(e,s).then((function(e){return e.json()})).then((function(e){if(null==e.result)throw Error("no rows in result"+JSON.stringify(e));var t=e.result.map((function(e){return e}));a.setState({rows:t}),console.log("WidgetPivotTable data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetPivotTable componentDidMount "),this.loadData()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetPivotTable componentDidUpdate "),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadData()}},{key:"render",value:function(){var e=this,t=this.props.tableState,a=t.rows,n=t.columns,r=t.values,i=t.op;if(!a||!n||!i||!r)return l.a.createElement(pe.a,{variant:"outlined"},l.a.createElement(me.a,null,l.a.createElement(k.a,null,"Error: state is not complete, content"," ",JSON.stringify(this.props.tableState))));if(this.state.err)return l.a.createElement(pe.a,{variant:"outlined"},l.a.createElement(me.a,null,l.a.createElement(k.a,null,"Error: ",this.state.err)));if(!this.state.rows)return l.a.createElement(pe.a,{variant:"outlined"},l.a.createElement(me.a,null,l.a.createElement(k.a,null,"No rows")));var s,c=this.state.rows,u=this.props.groupByAvailable.filter((function(e){return e.name===n})),d=n,p=u[0].descriptor.type,m=this.props.groupByAvailable.filter((function(e){return e.name===a})),v=a,h=m[0].descriptor.type,f=m[0].translation,g=[];"set"===p?g=(null===(s=this.props.possibleValues.set.get(d))||void 0===s?void 0:s.map((function(e){return{key:e,value:e}})))||[]:"dictionary"===p&&(g=(g=this.props.possibleValues.dictionary.get(d)||[]).map((function(e){return{key:e.key,value:e.value&&""!==e.value?e.value:e.key}})));console.log("columnsValues = "+JSON.stringify(g));var E,b=[];"set"===h?b=(null===(E=this.props.possibleValues.set.get(v))||void 0===E?void 0:E.map((function(e){return{key:e,value:e}})))||[]:"dictionary"===h&&(b=(b=this.props.possibleValues.dictionary.get(v)||[]).map((function(e){return{key:e.key,value:e.value&&""!==e.value?e.value:e.key}})));console.log("rowsValues = "+JSON.stringify(b));var S=c.reduce((function(e,t){var a=t[n];return e.add(a),e}),new Set),O=c.reduce((function(e,t){var n=t[a];return e.add(n),e}),new Set);console.log("columnsInDataValues = "+JSON.stringify(S)),console.log("rowsInDataValues = "+JSON.stringify(O)),g=g.filter((function(e){return S.has(e.key)})),b=b.filter((function(e){return O.has(e.key)})),console.log("columnsValues = "+JSON.stringify(g)),console.log("rowsValues = "+JSON.stringify(b));var w=c.reduce((function(e,t){var l=t[a],o=e.get(l)||{x:l};return o[t[n]]=t[i+"_"+r],e.set(l,o),e}),new Map);console.log(w);var A=o.a(w.values()).sortBy((function(e){return e.x})).toArray();console.log("dd = "+JSON.stringify(A));var B=b.reduce((function(e,t){var a=t.key,n=t.value;return e.set(a,n),e}),new Map),F=Object.fromEntries(B.entries());console.log(F);var x={field:"x",title:f,lookup:"dictionary"===h?F:void 0},j=g.map((function(e){return{field:e.key,title:e.value}})),D=[x].concat(j),I=A,P=l.a.createElement(We.a,{icons:kt,columns:D,onColumnDragged:function(e,t){console.log("Dropped column from "+e+" to position "+t)},options:{showTitle:!1,padding:"dense",exportAllData:!0,exportButton:!0,exportFileName:this.props.title+"."+dt()().format("YYYYMMDDTHHmmss"),fixedColumns:{left:this.props.tableState.fixed1?1:0,right:0},rowStyle:function(t){return{backgroundColor:e.state.selected===t.tableData.id?"#EEE":"#FFF"}}},onRowClick:function(t,a){return e.setState({selected:null===a||void 0===a?void 0:a.tableData.id})},title:l.a.createElement(C.a,null,l.a.createElement(k.a,{variant:"h5",component:"h5"},this.props.title),l.a.createElement(k.a,{color:"textSecondary"},this.props.description)),isLoading:!this.state.rows&&!this.state.err,data:I,components:{Container:function(e){return l.a.createElement(y.a,Object.assign({},e,{elevation:0}))}}});return l.a.createElement("div",{id:this.props.id},l.a.createElement(pe.a,{variant:"outlined",title:this.props.title},l.a.createElement(ve.a,{action:l.a.createElement(T.a,{"aria-label":"fullscreen",onClick:this.handleFullscreenOpen},l.a.createElement(Oe.a,null)),title:this.props.title,subheader:this.props.description}),l.a.createElement(me.a,null,P),this.props.isEditMode?l.a.createElement(he.a,{disableSpacing:!0},l.a.createElement(T.a,{"aria-label":"edit",onClick:this.handleEdit},l.a.createElement(be.a,null)),l.a.createElement(T.a,{"aria-label":"delete",onClick:this.handleDelete},l.a.createElement(ke.a,null))):null),l.a.createElement(q.a,{fullScreen:!0,open:this.state.openFullscreen,onClose:this.handleFullscreenClose},l.a.createElement(L.a,{id:"editor-dialog-title"},l.a.createElement(fe.a,{variant:"dense"},l.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.handleFullscreenClose,"aria-label":"close"},l.a.createElement(ye.a,null)),l.a.createElement(k.a,{variant:"h6"},this.props.title))),l.a.createElement(R.a,null,l.a.createElement(k.a,{variant:"h6"},this.props.description),P)))}}]),t}(l.a.Component),Ot=a(487),wt=a.n(Ot),At=function(e){function t(){var e,a;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).state={value:void 0,err:void 0,openFullscreen:!1},a.handleFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!0})}))},a.handleFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!1})}))},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.handleRefresh=function(){console.log("handleRefresh"),a.loadCounter()},a.loadCounter=function(){var e;console.log("WidgetCounter loadCounter "+a.props.counterState.field),a.setState({value:void 0,err:void 0});var t=a.props.api+"/api/v2/ad-query/aggregation/table",n={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},groupBy:[null!==(e=a.props.counterState.fieldGroupBy)&&void 0!==e?e:a.props.counterState.field],fields:[{field:a.props.counterState.field,op:a.props.counterState.op}]},r={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(n)};fetch(t,r).then((function(e){return e.json()})).then((function(e){if(1!==e.result.length)throw Error("rows in result == "+e.result.length+" "+JSON.stringify(e.result));var t=e.result[0][a.props.counterState.op+"_"+a.props.counterState.field];a.setState({value:t}),console.log({id:a.props.id,value:t}),console.log("WidgetCounter data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetCounter componentDidMount "+this.props.counterState.field),this.loadCounter()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetCounter componentDidUpdate "+this.props.counterState.field),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadCounter()}},{key:"render",value:function(){var e,t;if(this.state.err)return l.a.createElement(pe.a,{variant:"outlined"},l.a.createElement(me.a,null,l.a.createElement(k.a,null,"Error: ",this.state.err)));var a=!1;if(void 0!==this.props.counterState.referenceValue&&this.props.counterState.referenceOp){var n=this.props.counterState.referenceValue;switch(this.props.counterState.referenceOp){case"eq":a=Number(this.state.value)===n;break;case"neq":a=Number(this.state.value)!==n;break;case"gt":a=Number(this.state.value)>n;break;case"lt":a=Number(this.state.value)<n;break;case"gte":a=Number(this.state.value)>=n;break;case"lte":a=Number(this.state.value)<=n}}return l.a.createElement("div",{id:this.props.id},l.a.createElement(pe.a,{variant:"outlined"},l.a.createElement(ve.a,{action:l.a.createElement(T.a,{"aria-label":"fullscreen",onClick:this.handleFullscreenOpen},l.a.createElement(Oe.a,null)),color:a?"error":"textSecondary",title:this.props.title}),l.a.createElement(me.a,null,l.a.createElement(k.a,{align:"center",variant:"h4",component:"h4",color:a?"error":"inherit"},null!==(e=this.state.value)&&void 0!==e?e:"..."),l.a.createElement(k.a,{align:"center",color:a?"error":"textSecondary"},this.props.description)),this.props.isEditMode?l.a.createElement(he.a,{disableSpacing:!0},l.a.createElement(T.a,{"aria-label":"edit",onClick:this.handleEdit},l.a.createElement(be.a,null)),l.a.createElement(T.a,{"aria-label":"delete",onClick:this.handleDelete},l.a.createElement(ke.a,null))):null),l.a.createElement(q.a,{fullScreen:!0,open:this.state.openFullscreen,onClose:this.handleFullscreenClose},l.a.createElement(L.a,{id:"editor-dialog-title"},l.a.createElement(fe.a,{variant:"dense"},l.a.createElement(T.a,{edge:"start",color:"inherit",onClick:this.handleFullscreenClose,"aria-label":"close"},l.a.createElement(ye.a,null)),l.a.createElement(k.a,{variant:"h6"},this.props.title),l.a.createElement(T.a,{"aria-label":"refresh","aria-haspopup":"true",edge:"end",color:"inherit",onClick:this.handleRefresh},l.a.createElement(wt.a,null)))),l.a.createElement(R.a,null,l.a.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},l.a.createElement("div",null,l.a.createElement(k.a,{align:"center",variant:"h1",component:"h1",color:a?"error":"inherit"},null!==(t=this.state.value)&&void 0!==t?t:"..."),l.a.createElement(k.a,{align:"center",color:a?"error":"textSecondary"},this.props.description))))))}}]),t}(l.a.Component),Bt=a(815),Ft=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e;return l.a.createElement(pe.a,{variant:"outlined",title:this.props.title},l.a.createElement(me.a,null,l.a.createElement(Bt.a,null,null!==(e=this.props.description)&&void 0!==e?e:"")),this.props.isEditMode?l.a.createElement(he.a,{disableSpacing:!0},l.a.createElement(T.a,{"aria-label":"edit",onClick:this.handleEdit},l.a.createElement(be.a,null)),l.a.createElement(T.a,{"aria-label":"delete",onClick:this.handleDelete},l.a.createElement(ke.a,null))):null)}}]),t}(l.a.Component),xt=a(863),jt=a(817),Dt=a.n(jt),Tt=a(488),It=a.n(Tt),Pt=a(457);var Wt=function(e){var t=i.useState(!1),a=Object(r.a)(t,2),n=a[0],l=a[1],o=i.useState(""),s=Object(r.a)(o,2),c=s[0],u=s[1];return i.createElement(y.a,{variant:"elevation",elevation:0},i.createElement(Pt.a,{title:"Show the full source of widget internals. Copy/Paste enabled."},i.createElement(T.a,{"aria-label":"raw","aria-haspopup":"true",color:"primary",onClick:function(){l(!0),u(e.raw)}},i.createElement(It.a,null))),i.createElement(q.a,{disableBackdropClick:!0,disableEscapeKeyDown:!0,maxWidth:"xs",fullWidth:!0,"aria-labelledby":"confirmation-dialog-title",open:n},i.createElement(L.a,{id:"confirmation-dialog-title"},"Raw"),i.createElement(R.a,{dividers:!0},i.createElement(g.a,{id:"value-textfield",label:"Value",size:"small",fullWidth:!0,multiline:!0,value:c,onChange:function(e){var t=e.target.value&&""!==e.target.value?e.target.value:"";console.log("new rawValue "+t),u(t)},variant:"outlined"})),i.createElement(_.a,null,i.createElement(V.a,{autoFocus:!0,onClick:function(){l(!1),u("")},color:"primary"},"Cancel"),i.createElement(V.a,{onClick:function(){l(!1),e.onChangeRaw(c),u("")},color:"primary"},"Set"))))},Nt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).state={real:{id:Object(f.a)(),title:"New Widget 1",visualizeType:"Chart",groupBy:o.a(),filterItems:o.a([]),period:{type:"forever"}}},a.handleChangeTitle=function(e){a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{title:e})})}))},a.handleChangeDescription=function(e){a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{description:e})})}))},a.handleChange=function(e){console.log(e.target.value);var t=e.target.value;a.setState((function(e){return Object(n.a)({},e,{real:Object(n.a)({},e.real,{visualizeType:t})})}))},a.handleTimeperiod=function(e){console.log("handleTimeperiod "+e.type),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{period:{type:e.type}})})}))},a.handleAddField=function(e){console.log("handleAddField "+e.name),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{groupBy:o.a(t.real.groupBy).push(e.name)})})}))},a.handleRemoveField=function(e){console.log("handleRemoveField "+e.name),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{groupBy:t.real.groupBy.filter((function(t){return t!==e.name}))})})}))},a.handleChartChange=function(e){console.log("handleChartChange "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{chart:e})})}))},a.handleTableChange=function(e){console.log("handleTableChange "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{table:e})})}))},a.handlePivotTableChange=function(e){console.log("handlePivotTableChange "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{pivot:e})})}))},a.handleCounterChange=function(e){console.log("handleCounterChange "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{counter:e})})}))},a.handleMarkdownBottomChange=function(e){console.log("handleMarkdownBottomChange "+e),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{bottom:e})})}))},a.handleAddFilterItem=function(e){console.log("handleAddFilterItem "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{filterItems:o.a(t.real.filterItems).push(e)})})}))},a.handleRemoveFilterItem=function(e){console.log("handleRemoveFilterItem "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{filterItems:t.real.filterItems.filter((function(t){return JSON.stringify(t)!==JSON.stringify(e)}))})})}))},a.handleRaw=function(e){var t=JSON.parse(e);a.setState((function(e){return Object(n.a)({},e,{real:t})}))},a.handleEditorDialogSave=function(){a.props.onChangeWidgetEditorState(a.state.real)},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return this.props.internal.possiblePeriodsLoaded?this.props.internal.groupByAvailableLoaded?this.props.internal.possibleValuesLoaded?i.createElement("div",null,i.createElement(L.a,{id:"editor-dialog-title"},i.createElement(fe.a,{variant:"dense"},i.createElement(xt.a,{separator:"\u203a","aria-label":"breadcrumb"},i.createElement(k.a,{color:"textPrimary",title:"Create title and subtitle for the widget"},"title"),i.createElement(k.a,{color:"textPrimary",title:"Prepare query by selecting fields and filtering them"},"query"),i.createElement(k.a,{color:"textPrimary",title:"Visualize the result dataset with number of perdefined widgets"},"visualize"),i.createElement(k.a,{color:"textPrimary",title:"Preview the result dataset in widget"},"preview"),i.createElement(k.a,{color:"textPrimary",title:"Save to add widget to current dashboard"},"save")),i.createElement(T.a,{edge:"end",color:"inherit","aria-label":"help",title:"All controls have tooltips"},i.createElement(Dt.a,null)))),i.createElement(R.a,null,i.createElement(C.a,null,i.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},i.createElement(E.a,{item:!0,xs:12},i.createElement(b,{title:this.state.real.title,description:this.state.real.description,onChangeTitle:this.handleChangeTitle,onChangeDescription:this.handleChangeDescription})),i.createElement(E.a,{item:!0,xs:12},i.createElement(Wt,{raw:JSON.stringify(this.state.real,void 0,2),onChangeRaw:this.handleRaw})),"Markdown"!==this.state.real.visualizeType?i.createElement(E.a,{item:!0,xs:12},i.createElement(U,{groupBy:this.state.real.groupBy,groupByAvailable:this.props.internal.groupByAvailable,possibleValues:this.props.internal.possibleValues,filterItems:this.state.real.filterItems,period:this.state.real.period,possiblePeriods:this.props.internal.possiblePeriods,onAddField:this.handleAddField,onRemoveField:this.handleRemoveField,onTimeperiod:this.handleTimeperiod,onAddFilterItem:this.handleAddFilterItem,onRemoveFilterItem:this.handleRemoveFilterItem})):null,i.createElement(E.a,{item:!0,xs:12,sm:6},i.createElement(ce,{visualizeType:this.state.real.visualizeType,chart:this.state.real.chart,table:this.state.real.table,pivot:this.state.real.pivot,bottom:this.state.real.bottom,counter:this.state.real.counter,groupBy:this.state.real.groupBy,groupByAvailable:this.props.internal.groupByAvailable,onChange:this.handleChange,onChartChange:this.handleChartChange,onTableChange:this.handleTableChange,onPivotTableChange:this.handlePivotTableChange,onCounterChange:this.handleCounterChange,onMarkdownBottomChange:this.handleMarkdownBottomChange})),i.createElement(E.a,{item:!0,xs:12,sm:6},"Chart"===this.state.real.visualizeType&&this.state.real.chart?i.createElement(Te,{isEditMode:!1,api:this.props.api,token:this.props.token,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description,chartState:this.state.real.chart,filterItems:this.state.real.filterItems,period:this.state.real.period,possibleValues:this.props.internal.possibleValues,groupByAvailable:this.props.internal.groupByAvailable}):null,"Pie"===this.state.real.visualizeType&&this.state.real.chart?i.createElement(Ie,{isEditMode:!1,api:this.props.api,token:this.props.token,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description,chartState:this.state.real.chart,filterItems:this.state.real.filterItems,period:this.state.real.period,possibleValues:this.props.internal.possibleValues,groupByAvailable:this.props.internal.groupByAvailable}):null,"Table"===this.state.real.visualizeType&&this.state.real.table?i.createElement(vt,{isEditMode:!1,api:this.props.api,token:this.props.token,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description,tableState:this.state.real.table,groupBy:this.state.real.groupBy,groupByAvailable:this.props.internal.groupByAvailable,filterItems:this.state.real.filterItems,period:this.state.real.period,possibleValues:this.props.internal.possibleValues}):null,"PivotTable"===this.state.real.visualizeType&&this.state.real.pivot?i.createElement(St,{isEditMode:!1,api:this.props.api,token:this.props.token,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description,tableState:this.state.real.pivot,filterItems:this.state.real.filterItems,period:this.state.real.period,possibleValues:this.props.internal.possibleValues,groupByAvailable:this.props.internal.groupByAvailable}):null,"Events"===this.state.real.visualizeType?i.createElement(bt,{isEditMode:!1,api:this.props.api,token:this.props.token,limit:5,id:this.state.real.id,dashboardId:this.props.dashboardId,title:this.state.real.title,description:this.state.real.description,filterItems:this.state.real.filterItems,period:this.state.real.period,possibleValues:this.props.internal.possibleValues}):null,"Counter"===this.state.real.visualizeType&&this.state.real.counter?i.createElement(At,{isEditMode:!1,api:this.props.api,token:this.props.token,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description,counterState:this.state.real.counter,filterItems:this.state.real.filterItems,period:this.state.real.period}):null,"Markdown"===this.state.real.visualizeType?i.createElement(Ft,{isEditMode:!1,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description}):null)))),i.createElement(_.a,null,i.createElement(V.a,{onClick:this.props.onClose,color:"primary"},"Cancel"),i.createElement(V.a,{onClick:this.handleEditorDialogSave,color:"primary"},"Save"))):i.createElement(x,{api:this.props.api,token:this.props.token,eventFields:this.props.internal.groupByAvailable,onChangePossibleValues:this.props.onLoadPossibleValues}):i.createElement(w,{api:this.props.api,token:this.props.token,lang:this.props.lang,onChangeEventFields:this.props.onLoadEventFields}):i.createElement(j,{api:this.props.api,token:this.props.token,lang:this.props.lang,onLoadPossiblePeriods:this.props.onLoadPossiblePeriods})}}]),t}(i.Component),zt=a(489),Vt=a.n(zt),Mt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).state={filterItems:o.a([]),period:{type:"forever"}},a.handleAddFilterItem=function(e){console.log("Dashboard handleAddFilterItem "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{filterItems:o.a(t.filterItems).push(e)})}))},a.handleRemoveFilterItem=function(e){console.log("Dashboard handleRemoveFilterItem "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{filterItems:t.filterItems.filter((function(t){return JSON.stringify(t)!==JSON.stringify(e)}))})}))},a.handleTimeperiod=function(e){console.log("Dashboard handleTimeperiod "+e.type),a.setState((function(t){return Object(n.a)({},t,{period:{type:e.type}})}))},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;if(0===this.props.widgets.length)return i.createElement(pe.a,{variant:"outlined"},i.createElement(me.a,null,i.createElement(k.a,null,"No widgets created"),i.createElement(k.a,null,"Use ",i.createElement(Vt.a,null)," button to select dashboard"),i.createElement(k.a,null,"Or turn on edit mode and use ",i.createElement(N.a,null)," button to add widget"),i.createElement(k.a,null,"\xa0"),i.createElement(k.a,null,"If something is unclear use ",i.createElement(gt.b,{to:"/dashboard/11111111-1111-1111-1111-111111111111"},"Tutorial")," "),i.createElement(k.a,null,"\xa0"),i.createElement(k.a,null,"Dashboards can be loaded from external file url, in url encoded format"),i.createElement(k.a,null,'Example: "#/inbox/dashboard/file/https%3A%2F%2Fraw.githubusercontent.com%2Favgx%2Fwidgets%2Fgh-pages%2Fdashboards.json"'),i.createElement(k.a,null,i.createElement(gt.b,{to:"/inbox/dashboard/file/https%3A%2F%2Fraw.githubusercontent.com%2Favgx%2Fwidgets%2Fgh-pages%2Fdashboards.json"},"Click this link to see an example"))));if(!this.props.internal.possiblePeriodsLoaded)return i.createElement(j,{api:this.props.api,token:this.props.token,lang:this.props.lang,onLoadPossiblePeriods:this.props.onLoadPossiblePeriods});if(!this.props.internal.groupByAvailableLoaded)return i.createElement(w,{api:this.props.api,token:this.props.token,lang:this.props.lang,onChangeEventFields:this.props.onLoadEventFields});if(!this.props.internal.possibleValuesLoaded)return i.createElement(x,{api:this.props.api,token:this.props.token,eventFields:this.props.internal.groupByAvailable,onChangePossibleValues:this.props.onLoadPossibleValues});console.log("Dashboard widgets: "+JSON.stringify(this.props.widgets,void 0,2));var t=o.a(this.props.widgets).filter((function(e){return"Markdown"===e.visualizeType&&!e.bottom})),a=o.a(this.props.widgets).filter((function(e){return"Markdown"===e.visualizeType&&e.bottom})),n=o.a(this.props.widgets).filter((function(e){return"Chart"===e.visualizeType})),r=o.a(this.props.widgets).filter((function(e){return"Pie"===e.visualizeType})),l=o.a(this.props.widgets).filter((function(e){return"Counter"===e.visualizeType})),s=o.a(this.props.widgets).filter((function(e){return"Table"===e.visualizeType})),c=o.a(this.props.widgets).filter((function(e){return"PivotTable"===e.visualizeType})),u=o.a(this.props.widgets).filter((function(e){return"Events"===e.visualizeType}));return i.createElement("div",null,i.createElement(k.a,{variant:"subtitle2"},"\xa0"),this.props.isCommonFilterEnabled?i.createElement(Pt.a,{title:"Dashboard common filter that will be applied to every widget"},i.createElement(E.a,{container:!0,spacing:2,direction:"row",alignItems:"stretch",alignContent:"center"},i.createElement(E.a,{item:!0},i.createElement(Y,{period:this.state.period,possiblePeriods:this.props.internal.possiblePeriods,onTimeperiod:this.handleTimeperiod})),i.createElement(E.a,{item:!0},i.createElement(G,{filterItems:this.state.filterItems,possibleValues:this.props.internal.possibleValues,groupByAvailable:this.props.internal.groupByAvailable,onAddFilterItem:this.handleAddFilterItem,onRemoveFilterItem:this.handleRemoveFilterItem})))):null,i.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},t.map((function(t){return i.createElement(E.a,{item:!0,xs:12},i.createElement(Ft,{isEditMode:e.props.isEditMode,id:t.id,title:t.title,description:t.description,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))}))),i.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},l.map((function(t){return i.createElement(E.a,{item:!0,xs:12,sm:3},i.createElement(At,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,id:t.id,title:t.title,description:t.description,counterState:t.counter,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))}))),i.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},n.map((function(t){return i.createElement(E.a,{item:!0,xs:12,sm:6},i.createElement(Te,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,id:t.id,title:t.title,description:t.description,chartState:t.chart,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,possibleValues:e.props.internal.possibleValues,groupByAvailable:e.props.internal.groupByAvailable,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))})),r.map((function(t){return i.createElement(E.a,{item:!0,xs:12,sm:6},i.createElement(Ie,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,id:t.id,title:t.title,description:t.description,chartState:t.chart,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,possibleValues:e.props.internal.possibleValues,groupByAvailable:e.props.internal.groupByAvailable,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))}))),i.createElement(k.a,{variant:"subtitle2"},"\xa0"),i.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},s.map((function(t){return i.createElement(E.a,{item:!0,xs:12},i.createElement(vt,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,id:t.id,title:t.title,description:t.description,tableState:t.table,groupBy:t.groupBy,groupByAvailable:e.props.internal.groupByAvailable,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,possibleValues:e.props.internal.possibleValues,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))})),c.map((function(t){return i.createElement(E.a,{item:!0,xs:12},i.createElement(St,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,id:t.id,title:t.title,description:t.description,tableState:t.pivot,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,possibleValues:e.props.internal.possibleValues,groupByAvailable:e.props.internal.groupByAvailable,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))})),u.map((function(t){return i.createElement(E.a,{item:!0,xs:12},i.createElement(bt,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,limit:200,id:t.id,dashboardId:e.props.id,title:t.title,description:t.description,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,possibleValues:e.props.internal.possibleValues,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))}))),i.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},a.map((function(t){return i.createElement(E.a,{item:!0,xs:12},i.createElement(Ft,{isEditMode:e.props.isEditMode,id:t.id,title:t.title,description:t.description,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))}))))}}]),t}(i.Component);var Jt=function(e){var t=i.useState(!1),a=Object(r.a)(t,2),n=a[0],l=a[1],o=i.useState(""),s=Object(r.a)(o,2),c=s[0],u=s[1];return i.createElement("div",null,i.createElement(Pt.a,{title:"Show the full source of dashboard internals. Copy/Paste enabled."},i.createElement(T.a,{"aria-label":"raw","aria-haspopup":"true",color:"inherit",onClick:function(){l(!0),u(e.raw)}},i.createElement(It.a,null))),i.createElement(q.a,{disableBackdropClick:!0,disableEscapeKeyDown:!0,maxWidth:"xs",fullWidth:!0,"aria-labelledby":"confirmation-dialog-title",open:n},i.createElement(L.a,{id:"confirmation-dialog-title"},"Raw"),i.createElement(R.a,{dividers:!0},i.createElement(g.a,{id:"value-textfield",label:"Value",size:"small",fullWidth:!0,multiline:!0,value:c,onChange:function(e){var t=e.target.value&&""!==e.target.value?e.target.value:"";console.log("new rawValue "+t),u(t)},variant:"outlined"})),i.createElement(_.a,null,i.createElement(V.a,{autoFocus:!0,onClick:function(){l(!1),u("")},color:"primary"},"Cancel"),i.createElement(V.a,{onClick:function(){l(!1),e.onChangeRaw(c),u("")},color:"primary",disabled:e.isReadonly},"Set"))))},Lt=a(857),Rt=a(859);var _t=function(e){var t=i.useState(!1),a=Object(r.a)(t,2),n=a[0],l=a[1],o=function(){l(!1)};return i.createElement("div",null,i.createElement(Pt.a,{title:"Create new or select one of the predefined dashboards"},i.createElement(T.a,{edge:"start",disabled:e.isEditMode,color:"inherit","aria-label":"menu",onClick:function(){l(!0)}},i.createElement(Vt.a,null))),i.createElement(q.a,{onClose:o,"aria-labelledby":"simple-dialog-title",maxWidth:"xs",fullWidth:!0,open:n},i.createElement(L.a,{id:"simple-dialog-title"},"Dashboard"),i.createElement(te.a,null,i.createElement(ae.a,{button:!0,component:gt.c,to:"/dashboard",onClick:function(){return t="Dashboard",a=[],l(!1),void e.onSelectWidgets(t,a);var t,a},key:Object(f.a)()},i.createElement(ne.a,{primary:"Create new ..."})),i.createElement(Lt.a,null),i.createElement(Rt.a,null,"or select predefined"),e.list.map((function(e){return i.createElement(ae.a,{button:!0,component:gt.c,to:"/dashboard/"+e.id,onClick:o,key:e.id},i.createElement(ne.a,{primary:e.title}))})))))},qt=a(308),Gt=a(856),Yt=a(820),Ut=a.n(Yt),Xt=a(2);var Qt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={data:void 0,err:void 0},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch(this.props.dashboardsJsonUrl).then((function(e){return e.json()})).then((function(e){return function(e,t){return new Promise((function(a){return setTimeout(a,e,t)}))}(2e3,e)})).then((function(t){t.length>0?(e.props.onLoadedDashboards(t),e.setState({data:t})):e.setState({err:"No dashboards found in "+e.props.dashboardsJsonUrl})})).catch((function(t){e.setState({err:t.message})}))}},{key:"render",value:function(){return this.state.err?i.createElement("div",null,i.createElement(C.a,null,i.createElement(k.a,null,"Error: ",this.state.err),i.createElement(k.a,null,i.createElement(gt.b,{to:"/"},"Return to dashboards")))):this.state.data?i.createElement(Xt.a,{to:"/"}):i.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},i.createElement(O.a,null),"\xa0\xa0Loading dashboard from ",this.props.dashboardsJsonUrl,"...")}}]),t}(i.Component),Ht=a(818),Kt=a(819);xe.a.vfs=De.a.pdfMake.vfs;var Zt=Object(c.a)((function(e){return Object(u.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));t.default=function(){var e=Zt(),t=Object(Xt.g)(),a=t.dashboardId,i=(t.widgetId,t.widgetMode,t.eventId,t.dashboardFile),c=Ht,u=l.a.useState(c),d=Object(r.a)(u,2),p=d[0],m=d[1],v=Kt,h=l.a.useState("Dashboards"),f=Object(r.a)(h,2),y=f[0],E=f[1],b=l.a.useState(!1),C=Object(r.a)(b,2),S=C[0],O=C[1],w=l.a.useState("https://axxoncloud-test2.axxonnet.com"),A=Object(r.a)(w,2),B=A[0],F=A[1],x=l.a.useState("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjIsIlVzZXJOYW1lIjoic2hhdWx1a2hvdjEyQGdtYWlsLmNvbSIsIkNsaWVudElEIjoiNmNlZGQ2OTJjNTNiNWRmMGNkZGVjNjlmMmYxNzZhMDgiLCJUeXBlIjoiYWNjZXNzVG9rZW4iLCJWZXJzaW9uIjoidjIiLCJDcmVhdGVkQXQiOiIyMDIwLTA2LTI5VDA2OjQwOjA5Ljg2MjQwNDEwMloiLCJleHAiOjE1OTM0OTkyMDksImlhdCI6MTU5MzQxMjgwOSwiaXNzIjoiQ2xvdWQifQ.qPs77wT72mO4LD1iP2NUZZBoD9lXeTS9nbzC7366mAw"),j=Object(r.a)(x,2),D=j[0],I=j[1],W=l.a.useState("en"),z=Object(r.a)(W,2),M=z[0],J=z[1],G=l.a.useState(!0),Y=Object(r.a)(G,2),U=Y[0],X=Y[1],K=l.a.useState(new Date),Z=Object(r.a)(K,2),$=Z[0],ee=Z[1],te=l.a.useState(!1),ae=Object(r.a)(te,2),ne=ae[0],re=ae[1],ie=l.a.useState(!1),le=Object(r.a)(ie,2),oe=le[0],se=le[1],ce=function(){re(!1)},ue=function(){se(!1)},de=function(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(t){return null}}(D);console.log("tokenParsed: "+JSON.stringify(de));var pe=JSON.stringify(de),me=l.a.useState([]),ve=Object(r.a)(me,2),he=ve[0],ge=ve[1],ye=l.a.useState({groupByAvailableLoaded:!1,groupByAvailable:[],possibleValuesLoaded:!1,possibleValues:{set:o.b({}),dictionary:o.b({})},possiblePeriodsLoaded:!1,possiblePeriods:[]}),Ee=Object(r.a)(ye,2),Ce=Ee[0],ke=Ee[1],Se=function(e){console.log("handleLoadEventFields "+JSON.stringify(e));var t=e.sort((function(e,t){var a=e.translation.toUpperCase(),n=t.translation.toUpperCase(),r=0;return a>n?r=1:a<n&&(r=-1),r}));ke(Object(n.a)({},Ce,{groupByAvailableLoaded:!0,groupByAvailable:t}))},Oe=function(e){console.log("handleLoadPossibleValues "+JSON.stringify(e)),ke(Object(n.a)({},Ce,{possibleValuesLoaded:!0,possibleValues:e}))},we=function(e){console.log("handleLoadPossiblePeriods "+JSON.stringify(e)),ke(Object(n.a)({},Ce,{possiblePeriodsLoaded:!0,possiblePeriods:e}))};if(i)return l.a.createElement(Qt,{dashboardsJsonUrl:decodeURIComponent(i),onLoadedDashboards:function(e){console.log("handleonLoadedDashboards length="+e.length),m(e)}});var Ae=function(e){var t=JSON.parse(e);ge(t)},Be=function(e){console.log("TODO: implement handleEditWidget")},Fe=function(e){ge(he.filter((function(t){return t.id!==e})))};return l.a.createElement("div",{className:e.root},l.a.createElement(qt.a,{display:"block",displayPrint:"none"},l.a.createElement(s.a,{position:"static"},l.a.createElement(fe.a,{variant:"dense"},l.a.createElement(_t,{list:p,isEditMode:S,onSelectWidgets:function(e,t){ge(t),E(e)}}),l.a.createElement(k.a,{variant:"h6",className:e.title},y," ",S?" : Edit":""),S&&!a?l.a.createElement(Pt.a,{title:"Add widget"},l.a.createElement(T.a,{edge:"end",color:"inherit","aria-label":"add widget",onClick:function(){se(!0)}},l.a.createElement(N.a,null))):null,S?l.a.createElement((function(){var e=Object(Xt.g)().dashboardId;if(!e)return l.a.createElement(Jt,{isReadonly:!1,raw:JSON.stringify(he,void 0,2),onChangeRaw:Ae});var t=o.a(p).find((function(t){return t.id===e}));if(!t)return null;var a=t.raw;return l.a.createElement(Jt,{isReadonly:!0,raw:JSON.stringify(a,void 0,2),onChangeRaw:Ae})}),null):null,he.length>0?l.a.createElement(Pt.a,{title:"Refresh data"},l.a.createElement(T.a,{"aria-label":"refresh","aria-haspopup":"true",color:"inherit",onClick:function(){ee(new Date)}},l.a.createElement(wt.a,null))):null,!S&&he.length>0?l.a.createElement(V.a,{color:"inherit",onClick:function(){console.log("TODO: EXPORT");for(var e=[],t=0;t<he.length;t++){var a=he[t];if(a.id){var n=document.getElementById(a.id);if(console.log(n),n){var r=n.querySelector("svg.recharts-surface");if(console.log(r),null!=r){var i,l=(new XMLSerializer).serializeToString(r);e.push({text:a.title},{text:null!==(i=a.description)&&void 0!==i?i:""},{text:"raw: "+JSON.stringify(a)},{svg:l,width:500})}else e.push({text:"no svg for "+a.visualizeType+" "+a.title})}else e.push({text:"no widgetRoot for "+a.visualizeType+" "+a.title})}else e.push({text:"no id for "+a.visualizeType+" "+a.title})}var o={header:"Export (ugly but fixing is in progress)",footer:function(e,t){return{text:"Created at "+new Date,alignment:"center"}},content:e};xe.a.createPdf(o).download(y+"."+dt()().format("YYYYMMDDTHHmmss")+".pdf")}},"Export"):null,S?l.a.createElement(Pt.a,{title:"Show settings dialog"},l.a.createElement(T.a,{"aria-label":"backend","aria-haspopup":"true",color:"inherit",onClick:function(){re(!0)}},l.a.createElement(Ut.a,null))):null,l.a.createElement(Pt.a,{title:"Toggle edit mode"},l.a.createElement(T.a,{"aria-label":"edit-mode","aria-haspopup":"true",color:"inherit",onClick:function(){O(!S)}},l.a.createElement(be.a,{color:S?"secondary":"inherit"})))))),l.a.createElement((function(){var e;if(!a)return l.a.createElement(Mt,{id:"custom",api:B,token:D,lang:M,isCommonFilterEnabled:U,isEditMode:S,refreshTime:$,widgets:he,internal:Ce,onLoadEventFields:Se,onLoadPossibleValues:Oe,onLoadPossiblePeriods:we,onEditWidget:Be,onDeleteWidget:Fe});var t=null!==(e=o.a(p).find((function(e){return e.id===a})))&&void 0!==e?e:o.a(v).find((function(e){return e.id===a}));if(!t)return l.a.createElement(k.a,null,"Dashboard ",a," not found");var n=t.raw;return l.a.createElement(Mt,{id:t.id,api:B,token:D,lang:M,isCommonFilterEnabled:U,isEditMode:S,refreshTime:$,widgets:n,internal:Ce,onLoadEventFields:Se,onLoadPossibleValues:Oe,onLoadPossiblePeriods:we,onEditWidget:Be,onDeleteWidget:Fe})}),null),l.a.createElement(q.a,{open:ne,onClose:ce,"aria-labelledby":"backend-dialog-title"},l.a.createElement(L.a,{id:"backend-dialog-title"},"Backend"),l.a.createElement(R.a,null,l.a.createElement(Gt.a,null,"To get data need url and token"),l.a.createElement(g.a,{autoFocus:!0,margin:"dense",id:"backend-api",label:"API",type:"url",value:B,fullWidth:!0,onChange:function(e){console.log("handleApi "+e.target.value),F(e.target.value)}}),l.a.createElement(g.a,{id:"op-value-textfield",margin:"dense",label:"lang",size:"small",select:!0,fullWidth:!0,value:M,onChange:function(e){console.log("handleLang "+e.target.value);var t=e.target.value;J(t)}},l.a.createElement(P.a,{key:"en",value:"en"},"en"),l.a.createElement(P.a,{key:"ru",value:"ru"},"ru")),l.a.createElement(Q.a,{control:l.a.createElement(H.a,{checked:U,onChange:function(e){console.log("handleCommonFilter "+e.target.value);var t=e.target.checked;X(t)},size:"small"}),label:"Dashboard common filter"}),l.a.createElement(g.a,{autoFocus:!0,margin:"dense",id:"backend-token",label:"Access token",value:D,multiline:!0,fullWidth:!0,helperText:pe,onChange:function(e){console.log("handleToken "+e.target.value),I(e.target.value)}})),l.a.createElement(_.a,null,l.a.createElement(V.a,{onClick:ce,color:"primary"},"Cancel"),l.a.createElement(V.a,{onClick:ce,color:"primary"},"OK"))),l.a.createElement(q.a,{fullScreen:!0,open:oe,onClose:ue,fullWidth:!0,maxWidth:"xl","aria-labelledby":"editor-dialog-title"},l.a.createElement(Nt,{dashboardId:null!==a&&void 0!==a?a:"custom",api:B,token:D,lang:M,internal:Ce,onLoadEventFields:Se,onLoadPossibleValues:Oe,onLoadPossiblePeriods:we,onChangeWidgetEditorState:function(e){console.log("handleChangeWidgetEditorState "+a+" "+JSON.stringify(e)),ge(o.a(he).push(e).toArray()),se(!1)},onClose:ue})))}}}]);
//# sourceMappingURL=4.386ebd60.chunk.js.map