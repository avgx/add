(this["webpackJsonpmy-app-ts"]=this["webpackJsonpmy-app-ts"]||[]).push([[4],{818:function(e){e.exports=JSON.parse('[{"id":"tutorial","title":"Tutorial","raw":[{"id":"C4563479-6778-439D-9077-9909E986C503","title":"Sample title","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"![](https://www.axxonsoft.com/local/templates/axxonsoft-2019/img/logo.svg)\\n\\n# This is dashboard tutorial"},{"id":"D3120B30-A644-4C30-B21E-1EEECAF60670","title":"some other title","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"### To be continued\\n\\n[next link](#/dashboard/tutorial-page-1)"}]},{"id":"tutorial-page-1","title":"Tutorial","raw":[{"id":"18120B30-A644-4C30-B21E-1EEECAF60670","title":"some other title","visualizeType":"Markdown","groupBy":[],"period":{"type":"forever"},"filterItems":[],"description":"### To be continued"}]}]')},860:function(e,t,a){"use strict";a.r(t);var n=a(123),l=a(157),r=a(0),i=a.n(r),o=a(113),s=a(855),u=a(477),c=a(478),d=a(104),p=a(105),m=a(107),h=a(106),v=a(108),f=a(864),g=a(377),b=a(376),E=a(824);var y=function(e){return r.createElement(b.a,{variant:"elevation",elevation:0},r.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},r.createElement(E.a,{item:!0,spacing:2},r.createElement("div",null,r.createElement(g.a,{id:"title-text",size:"small",label:"Title",value:e.title,onChange:function(t){var a=t.target.value&&""!==t.target.value?t.target.value:"";console.log("newTitleValue "+a),e.onChangeTitle(a)},fullWidth:!0,InputLabelProps:{shrink:!0},variant:"outlined"}))),r.createElement(E.a,{item:!0,spacing:2},r.createElement(g.a,{id:"description-text",size:"small",label:"Description",value:e.description,onChange:function(t){var a=t.target.value&&""!==t.target.value?t.target.value:"";console.log("newDescriptionValue "+a),e.onChangeDescription(a)},fullWidth:!0,multiline:!0,variant:"outlined"}))))},C=a(835),k=a(385),S=a(40),O=a.n(S),w=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(l)))).state={err:void 0},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.api+"/api/v1/ad-dictionary/events/fields?lang="+this.props.lang,a={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.props.token}};fetch(t,a).then((function(e){return e.json()})).then((function(t){e.props.onChangeEventFields(t)})).catch((function(t){e.setState({err:t.message})}))}},{key:"render",value:function(){return this.state.err?r.createElement("div",null,r.createElement(E.a,{container:!0,direction:"row",justify:"center",alignItems:"center",style:{height:"90vh",margin:0,padding:0}},r.createElement(E.a,{item:!0},r.createElement(C.a,null,r.createElement(k.a,null,"Error: ",this.state.err))))):r.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},r.createElement(O.a,null),"\xa0\xa0Loading event fields...")}}]),t}(r.Component),j=a(271),x=a.n(j),F=a(386),D=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(l)))).fetchField1=function(){var e=Object(F.a)(x.a.mark((function e(t){var n,l,r,i;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptor.type,l=t.name,console.log("fetch "+n+" "+l),r=a.props.api+"/api/v2/ad-query/field/"+n+"/"+l,i={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token}},e.abrupt("return",fetch(r,i).catch((function(e){console.log("Error: "+r,e)})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=Object(F.a)(x.a.mark((function e(){var t,a,n,l,r,i,s,u=this;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("WidgetEditorLoadingPossibleValues componentDidMount"),t=this.props.eventFields.filter((function(e){return"set"===e.descriptor.type})),a=this.props.eventFields.filter((function(e){return"dictionary"===e.descriptor.type})),n=new Map,l=new Map,r=Promise.all(t.map(function(){var e=Object(F.a)(x.a.mark((function e(t){var a,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.fetchField1(t);case 2:if(!(a=e.sent)||!a.ok){e.next=10;break}return e.next=6,a.json();case 6:l=e.sent,n.set(t.name,l.result),e.next=11;break;case 10:n.set(t.name,[]);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),i=Promise.all(a.map(function(){var e=Object(F.a)(x.a.mark((function e(t){var a,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.fetchField1(t);case 2:if(!(a=e.sent)||!a.ok){e.next=10;break}return e.next=6,a.json();case 6:n=e.sent,l.set(t.name,n.result),e.next=11;break;case 10:l.set(t.name,[]);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),console.log("before Promise.all"),e.next=10,Promise.all([r,i]);case 10:console.log("after Promise.all"),console.log("setValues="+JSON.stringify(n)),console.log("dictionaryValues="+JSON.stringify(l)),s={set:o.b(n),dictionary:o.b(l)},this.props.onChangePossibleValues(s);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},r.createElement(O.a,null),"\xa0\xa0Loading possible values...")}}]),t}(r.Component),T=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(l)))).state={err:void 0},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.api+"/api/v1/ad-dictionary/timeperiods?lang="+this.props.lang,a={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.props.token}};fetch(t,a).then((function(e){return e.json()})).then((function(t){e.props.onLoadPossiblePeriods(t)})).catch((function(t){e.setState({err:t.message})}))}},{key:"render",value:function(){return this.state.err?r.createElement("div",null,r.createElement(E.a,{container:!0,direction:"row",justify:"center",alignItems:"center",style:{height:"90vh",margin:0,padding:0}},r.createElement(E.a,{item:!0},r.createElement(C.a,null,r.createElement(k.a,null,"Error: ",this.state.err))))):r.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},r.createElement(O.a,null),"\xa0\xa0Loading timeperiods...")}}]),t}(r.Component),B=a(499),A=a(387),I=a(269),W=a(388),P=a(272),N=a.n(P);var V=function(e){var t=r.useState(null),a=Object(l.a)(t,2),n=a[0],i=a[1],s=function(t){return function(){e.onRemoveField(t)}},u=function(t){return function(){e.onAddField(t),i(null)}},c=e.groupBy,d=e.groupByAvailable.filter((function(e){return!c.find((function(t){return t===e.name}))&&"complex"!==e.descriptor.type}));return r.createElement(b.a,{variant:"elevation",elevation:0,title:"Select fields that will be used in the result dataset"},r.createElement(k.a,{variant:"h6"},"Select",r.createElement(A.a,{edge:"end","aria-label":"filter",onClick:function(e){i(e.currentTarget)},title:"Add field"},r.createElement(N.a,null))),o.a(e.groupBy).map((function(t){return a=t,e.groupByAvailable.find((function(e){return e.name===a}));var a})).filter((function(e){return!!e})).map((function(e){return e})).map((function(e){return r.createElement(B.a,{key:e.name,variant:"outlined",size:"small",onDelete:s(e),label:e.translation})})),r.createElement(I.a,{id:"simple-menu",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:function(){i(null)}},d.map((function(e){return r.createElement(W.a,{key:e.name,onClick:u(e)},e.translation)}))))},z=a(389),M=a(527),J=a.n(M),L=a(841),R=a(842),Y=a(843),U=a(838);var G=function(e){var t,a=r.useState(!1),n=Object(l.a)(a,2),i=n[0],s=n[1],u=[{value:"eq",label:"=="},{value:"neq",label:"!="}],c=[{value:"contains",label:"contains"},{value:"notcontains",label:"notcontains"}],d=[{value:"gt",label:">"},{value:"lt",label:"<"},{value:"gte",label:">="},{value:"lte",label:"<="},{value:"eq",label:"=="},{value:"neq",label:"!="}],p=r.useState(""),m=Object(l.a)(p,2),h=m[0],v=m[1],f=r.useState(""),y=Object(l.a)(f,2),C=y[0],S=y[1],O=r.useState(""),w=Object(l.a)(O,2),j=w[0],x=w[1],F=function(t){return function(){console.log("handleDelete "+JSON.stringify(t)),e.onRemoveFilterItem(t)}},D=function(e){console.log("handleSelectValue "+e.target.value);var t=e.target.value&&""!==e.target.value?e.target.value:"";console.log("newValue "+t),x(t)},T=function(){var t;s(!1);var a=null!==(t=o.a(e.groupByAvailable).filter((function(e){return e.name===h})).map((function(e){return e.descriptor.type})).first())&&void 0!==t?t:"",n={field:h,type:a,op:C,value:j};e.onAddFilterItem(n),x(""),S(""),v("")},I=o.a(e.groupByAvailable),P=null!==(t=I.filter((function(e){return e.name===h})).map((function(e){return e.descriptor.type})).first())&&void 0!==t?t:"",N="set"===P&&e.possibleValues.set.has(h)?e.possibleValues.set.get(h):[],V="dictionary"===P&&e.possibleValues.dictionary.has(h)?e.possibleValues.dictionary.get(h):[],M=""!==h&&""!==C&&""!==j,G=o.a(e.filterItems);return console.log(G),r.createElement(b.a,{variant:"elevation",elevation:0,title:"Filter the result dataset"},r.createElement(k.a,{variant:"h6"},"Filter",r.createElement(A.a,{edge:"end","aria-label":"filter",onClick:function(){s(!0)},title:"Add filter"},r.createElement(J.a,null))),G.map((function(t,a){var n,l,i,s,p,m,h=t.field+"."+t.op+"."+t.value,v=null!==(n=I.filter((function(e){return e.name===t.field})).map((function(e){return e.translation})).first())&&void 0!==n?n:t.field,f=null!==(l=I.filter((function(e){return e.name===t.field})).map((function(e){return e.descriptor.type})).first())&&void 0!==l?l:"",g="number"===f?null!==(i=o.a(d).filter((function(e){return e.value===t.op})).map((function(e){return e.label})).first())&&void 0!==i?i:t.op:"set"===f||"dictionary"===f?null!==(s=o.a(u).filter((function(e){return e.value===t.op})).map((function(e){return e.label})).first())&&void 0!==s?s:t.op:"string"===f&&null!==(p=o.a(c).filter((function(e){return e.value===t.op})).map((function(e){return e.label})).first())&&void 0!==p?p:t.op,b=e.possibleValues.dictionary.has(t.field)?e.possibleValues.dictionary.get(t.field):[],E=v+" "+g+" "+("dictionary"===f&&null!==(m=o.a(b).filter((function(e){return e.key===t.value})).map((function(e){return e.value})).first())&&void 0!==m?m:t.value);return r.createElement(B.a,{key:h,variant:"outlined",size:"small",onDelete:F(t),label:E})})),r.createElement(U.a,{disableBackdropClick:!0,disableEscapeKeyDown:!0,maxWidth:"xs",fullWidth:!0,"aria-labelledby":"confirmation-dialog-title",open:i},r.createElement(L.a,{id:"confirmation-dialog-title"},"Filter by"),r.createElement(R.a,{dividers:!0},r.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"field-textfield",label:""!==P?"Field / "+P:"Field",size:"small",select:!0,fullWidth:!0,value:h,onChange:function(t){console.log("handleSelectField "+t.target.value);var a=e.groupByAvailable.find((function(e){return e.name===t.target.value}));console.log("handleSelectField item "+(null===a||void 0===a?void 0:a.name));var n=t.target.value&&""!==t.target.value?t.target.value:"";console.log("handleSelectField "+n),v(n)},variant:"outlined"},e.groupByAvailable.map((function(e,t){return null!=e.descriptor.childs?null:r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},"number"===P||"string"===P||"set"===P||"dictionary"===P?r.createElement(g.a,{id:"op-value-textfield",label:"op",size:"small",select:!0,fullWidth:!0,value:C,onChange:function(e){console.log("handleSelectOp "+e.target.value);var t=e.target.value&&""!==e.target.value?e.target.value:"";console.log("newOp "+t),S(t)},variant:"outlined"},"number"===P?d.map((function(e,t){return r.createElement(W.a,{key:e.value,value:e.value},e.label)})):null,"set"===P||"dictionary"===P?u.map((function(e,t){return r.createElement(W.a,{key:e.value,value:e.value},e.label)})):null,"string"===P?c.map((function(e,t){return r.createElement(W.a,{key:e.value,value:e.value},e.label)})):null):null),r.createElement(E.a,{item:!0},"number"===P||"string"===P?r.createElement(g.a,{id:"value-textfield",label:"Value",size:"small",fullWidth:!0,value:j,onChange:D,variant:"outlined"}):null,"set"===P?r.createElement(g.a,{id:"value-textfield",label:"Value",size:"small",fullWidth:!0,select:!0,value:j,onChange:D,variant:"outlined"},r.createElement(W.a,{key:"",value:""},"[No value]"),N.map((function(e){return r.createElement(W.a,{key:e,value:e},e)}))):null,"dictionary"===P?r.createElement(g.a,{id:"value-textfield",label:"Value",size:"small",fullWidth:!0,select:!0,value:j,onChange:D,variant:"outlined"},r.createElement(W.a,{key:"",value:""},"[No value]"),V.map((function(e){var t=e.key,a=e.value;return r.createElement(W.a,{key:t,value:t},a)}))):null))),r.createElement(Y.a,null,r.createElement(z.a,{autoFocus:!0,onClick:function(){s(!1)},color:"primary"},"Cancel"),M?r.createElement(z.a,{onClick:T,color:"primary"},"Ok"):r.createElement(z.a,{onClick:T,disabled:!0,color:"primary"},"Ok"))))};var q=function(e){var t=e.possiblePeriods;return r.createElement("div",{className:"QueryEditorTimeperiod"},r.createElement(g.a,{id:"outlined-select-timeperiod",size:"small",select:!0,label:"Timeperiod",variant:"outlined",onChange:function(a){var n;console.log("handleTimeperiod "+a.target.value);var l=null!==(n=t.find((function(e){return e.type===a.target.value})))&&void 0!==n?n:t[0];console.log("handleSelectSerie item "+(null===l||void 0===l?void 0:l.type)),e.onTimeperiod(l)},value:e.period.type},e.possiblePeriods.map((function(e,t){return r.createElement(W.a,{key:e.type,value:e.type},e.translation)}))))};var X=function(e){return r.createElement(b.a,{variant:"elevation",elevation:0,title:"Create query by selecting fields of the result dataset in 'Select' section and filter the result dataset by filters from 'Filter' section"},r.createElement(k.a,{variant:"h5"},"Query"),r.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},r.createElement(E.a,{item:!0},r.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},r.createElement(E.a,{item:!0},r.createElement(V,{groupBy:e.groupBy,groupByAvailable:e.groupByAvailable,onAddField:e.onAddField,onRemoveField:e.onRemoveField})),r.createElement(E.a,{item:!0},r.createElement(G,{filterItems:e.filterItems,possibleValues:e.possibleValues,groupByAvailable:e.groupByAvailable,onAddFilterItem:e.onAddFilterItem,onRemoveFilterItem:e.onRemoveFilterItem})),r.createElement(E.a,{item:!0},r.createElement(q,{period:e.period,possiblePeriods:e.possiblePeriods,onTimeperiod:e.onTimeperiod}))))))};var _=function(e){return r.createElement(b.a,{variant:"elevation",elevation:0,title:"Choose vizualization (widget) type"},r.createElement(g.a,{id:"outlined-select-currency",size:"small",select:!0,fullWidth:!0,label:"VisualizeType",variant:"outlined",onChange:e.onChange,value:e.value},r.createElement(W.a,{key:"Events",value:"Events"},"Events"),r.createElement(W.a,{key:"Table",value:"Table"},"Aggregation"),r.createElement(W.a,{key:"PivotTable",value:"PivotTable"},"Pivot"),r.createElement(W.a,{key:"Chart",value:"Chart"},"Chart"),r.createElement(W.a,{key:"Pie",value:"Pie"},"Pie"),r.createElement(W.a,{key:"Counter",value:"Counter"},"Counter"),r.createElement(W.a,{key:"Markdown",value:"Markdown"},"Markdown")))},H=a(390),K=a(844);var Q=function(e){var t,a,l,i,s,u,c,d,p,m,h,v,f,y=function(t){return e.groupByAvailable.find((function(e){return e.name===t}))},C=e.groupBy.map((function(e){return y(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.y)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.series))})),S=e.groupBy.map((function(e){return y(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.series))})),O=e.groupBy.map((function(e){return y(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.y))})),w=o.a(e.groupBy).map((function(e){return y(e)})).filter((function(e){return!!e})).map((function(e){return e})),j=null!==(t=w.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)})).map((function(e){return e.descriptor.type})).first())&&void 0!==t?t:"",x=null!==(a=w.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.y)})).map((function(e){return e.descriptor.type})).first())&&void 0!==a?a:"",F=null!==(l=w.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.series)})).map((function(e){return e.descriptor.type})).first())&&void 0!==l?l:"",D="number"!==x?["count"]:["count","avg","sum","min","max"];return r.createElement(b.a,{variant:"elevation",elevation:0,title:"Widget type: Chart. To build chart it is required to select which field be at axis x, which field be at axis y and how it must be aggregated, which field will form series"},r.createElement(k.a,{variant:"h6"},"Chart"),r.createElement(k.a,{variant:"subtitle2"},"\xa0"),r.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"type-outlined-text",label:"Type",size:"small",select:!0,fullWidth:!0,value:null===(i=e.chart)||void 0===i?void 0:i.type,onChange:function(t){console.log("handleSelectType "+t.target.value);var a=Object(n.a)({},e.chart,{type:t.target.value});e.onChartChange(a)},variant:"outlined"},["Line","Bar","Area"].map((function(e){return r.createElement(W.a,{key:e,value:e},e)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"x-outlined-text",label:""!==j?"X Field / "+j:"X Field",size:"small",select:!0,fullWidth:!0,value:null!==(s=null===(u=e.chart)||void 0===u?void 0:u.x)&&void 0!==s?s:"",onChange:function(t){console.log("handleSelectX "+t.target.value);var a=e.groupBy.map((function(e){return y(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectX item "+(null===a||void 0===a?void 0:a.name));var l=t.target.value&&""!==t.target.value?t.target.value:void 0,r=Object(n.a)({},e.chart,{x:l});e.onChartChange(r)},variant:"outlined"},r.createElement(W.a,{key:"[no value]",value:""},"[ No value ]"),C.map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"y-outlined-text",label:""!==x?"Y Field / "+x:"Y Field",size:"small",select:!0,fullWidth:!0,value:null!==(c=null===(d=e.chart)||void 0===d?void 0:d.y)&&void 0!==c?c:"",onChange:function(t){var a;console.log("handleSelectY "+t.target.value);var l=e.groupBy.map((function(e){return y(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectY item "+(null===l||void 0===l?void 0:l.name));var r=t.target.value&&""!==t.target.value?t.target.value:void 0,i="number"!==(null===l||void 0===l?void 0:l.descriptor.type)?"count":null===(a=e.chart)||void 0===a?void 0:a.op,o=Object(n.a)({},e.chart,{y:r,op:i});e.onChartChange(o)},variant:"outlined"},r.createElement(W.a,{key:"[no value]",value:""},"[ No value ]"),S.map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"value-outlined-text",label:"Value op",size:"small",select:!0,fullWidth:!0,value:null===(p=e.chart)||void 0===p?void 0:p.op,onChange:function(t){console.log("handleSelectYOp "+t.target.value);var a=Object(n.a)({},e.chart,{op:t.target.value});e.onChartChange(a)},variant:"outlined"},D.map((function(e){return r.createElement(W.a,{key:e,value:e},e)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"series-outlined-text",label:""!==F?"Series Field / "+F:"Series Field",size:"small",select:!0,fullWidth:!0,value:null!==(m=null===(h=e.chart)||void 0===h?void 0:h.series)&&void 0!==m?m:"",onChange:function(t){console.log("handleSelectSerie "+t.target.value);var a=e.groupBy.map((function(e){return y(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectSerie item "+(null===a||void 0===a?void 0:a.name));var l=t.target.value&&""!==t.target.value?t.target.value:void 0,r=Object(n.a)({},e.chart,{series:l});e.onChartChange(r)},variant:"outlined"},r.createElement(W.a,{key:"[no value]",value:""},"[ No value ]"),O.map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(H.a,{control:r.createElement(K.a,{checked:null!==(v=null===(f=e.chart)||void 0===f?void 0:f.brush)&&void 0!==v&&v,onChange:function(t){console.log("handleBrush "+t.target.value);var a=t.target.checked,l=Object(n.a)({},e.chart,{brush:a});e.onChartChange(l)},size:"small"}),label:"Brush"}))))};var Z=function(e){var t,a,l,i,s,u,c,d,p,m,h=function(t){return e.groupByAvailable.find((function(e){return e.name===t}))},v=e.groupBy.map((function(e){return h(e)})).filter((function(e){return null!=e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.y)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.series))})),f=e.groupBy.map((function(e){return h(e)})).filter((function(e){return null!=e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.series))})),b=e.groupBy.map((function(e){return h(e)})).filter((function(e){return null!=e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)||t.name===(null===(n=e.chart)||void 0===n?void 0:n.y))})),y=o.a(e.groupBy).map((function(e){return h(e)})).filter((function(e){return!!e})).map((function(e){return e})),C=null!==(t=y.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.x)})).map((function(e){return e.descriptor.type})).first())&&void 0!==t?t:"",S=null!==(a=y.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.y)})).map((function(e){return e.descriptor.type})).first())&&void 0!==a?a:"",O=null!==(l=y.filter((function(t){var a;return t.name===(null===(a=e.chart)||void 0===a?void 0:a.series)})).map((function(e){return e.descriptor.type})).first())&&void 0!==l?l:"",w="number"!==S?["count"]:["count","avg","sum","min","max"];return r.createElement("div",{title:"VisualizeType"},r.createElement(k.a,{variant:"h6"},"Pie"),r.createElement(k.a,{variant:"subtitle2"},"\xa0"),r.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"x-outlined-text",label:""!==C?"Name Field / "+C:"Name Field",size:"small",select:!0,fullWidth:!0,value:null!==(i=null===(s=e.chart)||void 0===s?void 0:s.x)&&void 0!==i?i:"",onChange:function(t){console.log("handleSelectX "+t.target.value);var a=e.groupBy.map((function(e){return h(e)})).filter((function(e){return null!=e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectX item "+(null===a||void 0===a?void 0:a.name));var l=t.target.value&&""!==t.target.value?t.target.value:void 0,r=Object(n.a)({},e.chart,{x:l});e.onChartChange(r)},variant:"outlined"},r.createElement(W.a,{key:"[no value]",value:""},"[ No value ]"),v.map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"series-outlined-text",label:""!==O?"Detail Field / "+O:"Detail Field",size:"small",select:!0,fullWidth:!0,value:null!==(u=null===(c=e.chart)||void 0===c?void 0:c.series)&&void 0!==u?u:"",onChange:function(t){console.log("handleSelectSerie "+t.target.value);var a=e.groupBy.map((function(e){return h(e)})).filter((function(e){return null!=e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectSerie item "+(null===a||void 0===a?void 0:a.name));var l=t.target.value&&""!==t.target.value?t.target.value:void 0,r=Object(n.a)({},e.chart,{series:l});e.onChartChange(r)},variant:"outlined"},r.createElement(W.a,{key:"[no value]",value:""},"[ No value ]"),b.map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"y-outlined-text",label:""!==S?"Value Field / "+S:"Value Field",size:"small",select:!0,fullWidth:!0,value:null!==(d=null===(p=e.chart)||void 0===p?void 0:p.y)&&void 0!==d?d:"",onChange:function(t){var a;console.log("handleSelectY "+t.target.value);var l=e.groupBy.map((function(e){return h(e)})).filter((function(e){return null!=e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectY item "+(null===l||void 0===l?void 0:l.name));var r=t.target.value&&""!==t.target.value?t.target.value:void 0,i="number"!==(null===l||void 0===l?void 0:l.descriptor.type)?"count":null===(a=e.chart)||void 0===a?void 0:a.op,o=Object(n.a)({},e.chart,{y:r,op:i});e.onChartChange(o)},variant:"outlined"},r.createElement(W.a,{key:"[no value]",value:""},"[ No value ]"),f.map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"value-outlined-text",label:"Value op",size:"small",select:!0,fullWidth:!0,value:null===(m=e.chart)||void 0===m?void 0:m.op,onChange:function(t){console.log("handleSelectYOp "+t.target.value);var a=Object(n.a)({},e.chart,{op:t.target.value});e.onChartChange(a)},variant:"outlined"},w.map((function(e){return r.createElement(W.a,{key:e,value:e},e)}))))))},$=["count","avg","sum","min","max"],ee=function(e){function t(){var e,a;Object(d.a)(this,t);for(var l=arguments.length,r=new Array(l),i=0;i<l;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).handleSelectField=function(e){var t,l;console.log("handleSelectField "+e.target.value);var r=Object(n.a)({},a.props.counter,{field:e.target.value,op:null!==(t=null===(l=a.props.counter)||void 0===l?void 0:l.op)&&void 0!==t?t:"count"});a.props.onCounterChange(r)},a.handleSelectFieldGroupBy=function(e){var t,l;console.log("handleSelectFieldGroupBy "+e.target.value);var r=Object(n.a)({},a.props.counter,{fieldGroupBy:e.target.value,op:null!==(t=null===(l=a.props.counter)||void 0===l?void 0:l.op)&&void 0!==t?t:"count"});a.props.onCounterChange(r)},a.handleSelectOp=function(e){console.log("handleSelectYOp "+e.target.value);var t=Object(n.a)({},a.props.counter,{op:e.target.value});a.props.onCounterChange(t)},a.handleOffsetValue=function(e){console.log("handleOffsetValue "+e.target.value);var t=Object(n.a)({},a.props.counter,{offset:Number(e.target.value)});a.props.onCounterChange(t)},a.handleWithReferenceValue=function(e){var t,l;console.log("handleWithReferenceValue "+e.target.value);var r=e.target.checked,i=Object(n.a)({},a.props.counter,{referenceValue:r?0:void 0,referenceOp:r?null!==(t=null===(l=a.props.counter)||void 0===l?void 0:l.referenceOp)&&void 0!==t?t:"eq":void 0});a.props.onCounterChange(i)},a.handleReferenceValue=function(e){console.log("handleReferenceValue "+e.target.value);var t=Object(n.a)({},a.props.counter,{referenceValue:Number(e.target.value)});a.props.onCounterChange(t)},a.handleReferenceOp=function(e){console.log("handleSelectYOp "+e.target.value);var t=Object(n.a)({},a.props.counter,{referenceOp:e.target.value});a.props.onCounterChange(t)},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e,t,a,n,l,i,s,u,c=this,d=function(e){return c.props.groupByAvailable.find((function(t){return t.name===e}))},p=null!==(e=o.a(this.props.groupBy).map((function(e){return d(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(e){var t;return e.name===(null===(t=c.props.counter)||void 0===t?void 0:t.field)})).map((function(e){return e.descriptor.type})).first())&&void 0!==e?e:"",m="number"!==p?["count"]:$,h="number"===p,v=void 0!==(null===(t=this.props.counter)||void 0===t?void 0:t.referenceValue);return r.createElement("div",null,r.createElement(k.a,{variant:"h6"},"Counter"),r.createElement(k.a,{variant:"subtitle2"},"Note: result must contain only 1 item. This can be achived via filters."),r.createElement(k.a,{variant:"subtitle2"},"\xa0"),r.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"value-outlined-text",label:""!==p?"Field / "+p:"Field",size:"small",select:!0,fullWidth:!0,value:null===(a=this.props.counter)||void 0===a?void 0:a.field,onChange:this.handleSelectField,variant:"outlined"},this.props.groupBy.map((function(e){return d(e)})).filter((function(e){return!!e})).map((function(e){return e})).map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"value-outlined-text",label:"Value op",size:"small",select:!0,fullWidth:!0,value:null===(n=this.props.counter)||void 0===n?void 0:n.op,onChange:this.handleSelectOp,variant:"outlined"},m.map((function(e){return r.createElement(W.a,{key:e,value:e},e)})))),h?r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"value-outlined-text",label:"Group by",size:"small",select:!0,fullWidth:!0,value:null===(l=this.props.counter)||void 0===l?void 0:l.fieldGroupBy,onChange:this.handleSelectFieldGroupBy,variant:"outlined"},this.props.groupBy.map((function(e){return d(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(e){return"set"===e.descriptor.type||"dictionary"===e.descriptor.type})).map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))):null,r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"offset-outlined-number",label:"Offset",size:"small",fullWidth:!0,defaultValue:0,value:null===(i=this.props.counter)||void 0===i?void 0:i.offset,onChange:this.handleOffsetValue,type:"number",InputLabelProps:{shrink:!0},variant:"outlined"})),r.createElement(E.a,{item:!0},r.createElement(H.a,{control:r.createElement(K.a,{checked:v,onChange:this.handleWithReferenceValue,size:"small"}),label:"Highlight if"})),v?r.createElement(E.a,{item:!0},r.createElement(E.a,{container:!0,spacing:2,direction:"row",alignItems:"stretch"},r.createElement(E.a,{item:!0,xs:3,sm:3},r.createElement(k.a,null,"Value")),r.createElement(E.a,{item:!0,xs:3,sm:3},r.createElement(g.a,{id:"op-value-textfield",label:"compare operation",size:"small",select:!0,fullWidth:!0,value:null===(s=this.props.counter)||void 0===s?void 0:s.referenceOp,onChange:this.handleReferenceOp,variant:"outlined"},[{value:"gt",label:">"},{value:"lt",label:"<"},{value:"gte",label:">="},{value:"lte",label:"<="},{value:"eq",label:"=="},{value:"neq",label:"!="}].map((function(e,t){return r.createElement(W.a,{key:e.value,value:e.value},e.label)})))),r.createElement(E.a,{item:!0,xs:3,sm:3},r.createElement(g.a,{id:"reference-outlined-number",label:"Reference",size:"small",fullWidth:!0,value:null===(u=this.props.counter)||void 0===u?void 0:u.referenceValue,onChange:this.handleReferenceValue,type:"number",InputLabelProps:{shrink:!0},variant:"outlined"})))):null))}}]),t}(r.Component),te=a(833),ae=a(837),ne=a(391),le=["count","avg","sum","min","max"],re=function(e){function t(){var e,a;Object(d.a)(this,t);for(var l=arguments.length,r=new Array(l),i=0;i<l;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).handleSelectField=function(e){console.log("handleSelectField "+e.target.value);var t=Object(n.a)({},a.props.table,{field:e.target.value});a.props.onTableChange(t)},a.handleSelectOp=function(e){console.log("handleSelectYOp "+e.target.value);var t=Object(n.a)({},a.props.table,{op:e.target.value});a.props.onTableChange(t)},a.handleAggregationFieldInGroupBy=function(e){console.log("handleAggregationFieldInGroupBy "+e.target.value);var t=e.target.checked,l=Object(n.a)({},a.props.table,{isAggregationFieldInGroupBy:t});a.props.onTableChange(l)},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e,t,a,n,l,i,s,u,c,d,p=this,m=o.a(this.props.groupBy).map((function(e){return t=e,p.props.groupByAvailable.find((function(e){return e.name===t}));var t})).filter((function(e){return!!e})).map((function(e){return e})),h=null!==(e=null!==(t=null===(a=this.props.table)||void 0===a?void 0:a.field)&&void 0!==t?t:o.a(this.props.groupBy).first())&&void 0!==e?e:"",v=null!==(n=m.filter((function(e){return e.name===h})).map((function(e){return e.descriptor.type})).first())&&void 0!==n?n:"",f="number"!==v?["count"]:le,b=f.includes(null!==(l=null===(i=this.props.table)||void 0===i?void 0:i.op)&&void 0!==l?l:"")&&null!==(s=null===(u=this.props.table)||void 0===u?void 0:u.op)&&void 0!==s?s:"count";return r.createElement("div",{title:"VisualizeTypeTable"},r.createElement(k.a,{variant:"h6"},"Group by"),r.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},r.createElement(E.a,{item:!0},r.createElement(te.a,null,m.map((function(e){return r.createElement(ae.a,{dense:!0,key:e.name},r.createElement(ne.a,{primary:e.translation,secondary:e.descriptor.type}))})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"value-outlined-text",label:""!==v?"Aggregate by / "+v:"Aggregate by",size:"small",select:!0,fullWidth:!0,value:h,onChange:this.handleSelectField,variant:"outlined"},m.map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"value-outlined-text",label:"Aggregate op",size:"small",select:!0,fullWidth:!0,value:b,onChange:this.handleSelectOp,variant:"outlined"},f.map((function(e){return r.createElement(W.a,{key:e,value:e},e)})))),r.createElement(E.a,{item:!0},r.createElement(H.a,{control:r.createElement(K.a,{checked:null!==(c=null===(d=this.props.table)||void 0===d?void 0:d.isAggregationFieldInGroupBy)&&void 0!==c&&c,onChange:this.handleAggregationFieldInGroupBy,size:"small"}),label:"Include aggregation field in group by"}))))}}]),t}(r.Component),ie=a(495),oe=a(210),se=a.n(oe);var ue=function(e){var t,a,l,i,s,u,c,d,p,m,h,v,f,b,y,C,S,O,w,j,x,F,D,T,B,A,I,P,N,V,z,M,J,L=function(t){return e.groupByAvailable.find((function(e){return e.name===t}))},R=e.groupBy.map((function(e){return L(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.pivot)||void 0===a?void 0:a.values)||t.name===(null===(n=e.pivot)||void 0===n?void 0:n.columns))})),Y=e.groupBy.map((function(e){return L(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.pivot)||void 0===a?void 0:a.rows)||t.name===(null===(n=e.pivot)||void 0===n?void 0:n.values))})),U=e.groupBy.map((function(e){return L(e)})).filter((function(e){return!!e})).map((function(e){return e})).filter((function(t){var a,n;return!(t.name===(null===(a=e.pivot)||void 0===a?void 0:a.rows)||t.name===(null===(n=e.pivot)||void 0===n?void 0:n.columns))})),G=o.a(e.groupBy).map((function(e){return L(e)})).filter((function(e){return!!e})).map((function(e){return e})),q=null!==(t=G.filter((function(t){var a;return t.name===(null===(a=e.pivot)||void 0===a?void 0:a.rows)})).map((function(e){return e.descriptor.type})).first())&&void 0!==t?t:"",X=null!==(a=G.filter((function(t){var a;return t.name===(null===(a=e.pivot)||void 0===a?void 0:a.columns)})).map((function(e){return e.descriptor.type})).first())&&void 0!==a?a:"",_=null!==(l=G.filter((function(t){var a;return t.name===(null===(a=e.pivot)||void 0===a?void 0:a.values)})).map((function(e){return e.descriptor.type})).first())&&void 0!==l?l:"",Q="number"!==_?["count"]:["count","avg","sum","min","max"],Z=null!==(i=null===(s=e.pivot)||void 0===s?void 0:s.columns)&&void 0!==i?i:"",$=X,ee=[];"set"===$?ee=(null===(J=e.possibleValues.set.get(Z))||void 0===J?void 0:J.map((function(e){return{key:e,value:e}})))||[]:"dictionary"===$&&(ee=(ee=e.possibleValues.dictionary.get(Z)||[]).map((function(e){return{key:e.key,value:e.value&&""!==e.value?e.value:e.key}}))),console.log("columnsValues = "+JSON.stringify(ee));var te=ee,ae=ee,ne=[{key:"*",value:"*"}].concat(ee),le=void 0!==(null===(u=e.pivot)||void 0===u?void 0:u.referenceValue);return r.createElement("div",{title:"VisualizeTypePivotTable"},r.createElement(k.a,{variant:"h6"},"Pivot table"),r.createElement(k.a,{variant:"subtitle2"},"\xa0"),r.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"rows-outlined-text",label:""!==q?"Rows Field / "+q:"Rows Field",size:"small",select:!0,fullWidth:!0,value:null!==(c=null===(d=e.pivot)||void 0===d?void 0:d.rows)&&void 0!==c?c:"",onChange:function(t){console.log("handleSelectRows "+t.target.value);var a=e.groupBy.map((function(e){return L(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectRows item "+(null===a||void 0===a?void 0:a.name));var l=t.target.value&&""!==t.target.value?t.target.value:void 0,r=Object(n.a)({},e.pivot,{rows:l});e.onPivotTableChange(r)},variant:"outlined"},r.createElement(W.a,{key:"[no value]",value:""},"[ No value ]"),R.map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"columns-outlined-text",label:""!==X?"Columns Field / "+X:"Columns Field",size:"small",select:!0,fullWidth:!0,value:null!==(p=null===(m=e.pivot)||void 0===m?void 0:m.columns)&&void 0!==p?p:"",onChange:function(t){console.log("handleSelectColumns "+t.target.value);var a=e.groupBy.map((function(e){return L(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectColumns item "+(null===a||void 0===a?void 0:a.name));var l=t.target.value&&""!==t.target.value?t.target.value:void 0,r=Object(n.a)({},e.pivot,{columns:l});e.onPivotTableChange(r)},variant:"outlined"},r.createElement(W.a,{key:"[no value]",value:""},"[ No value ]"),Y.map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"values-outlined-text",label:""!==_?"Values Field / "+_:"Values Field",size:"small",select:!0,fullWidth:!0,value:null!==(h=null===(v=e.pivot)||void 0===v?void 0:v.values)&&void 0!==h?h:"",onChange:function(t){var a;console.log("handleSelectValues "+t.target.value);var l=e.groupBy.map((function(e){return L(e)})).filter((function(e){return!!e})).map((function(e){return e})).find((function(e){return e.name===t.target.value}));console.log("handleSelectValues item "+(null===l||void 0===l?void 0:l.name));var r=t.target.value&&""!==t.target.value?t.target.value:void 0,i="number"!==(null===l||void 0===l?void 0:l.descriptor.type)?"count":null===(a=e.pivot)||void 0===a?void 0:a.op,o=Object(n.a)({},e.pivot,{values:r,op:i});e.onPivotTableChange(o)},variant:"outlined"},r.createElement(W.a,{key:"[no value]",value:""},"[ No value ]"),U.map((function(e){return r.createElement(W.a,{key:e.name,value:e.name},e.translation)})))),r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"values-op-outlined-text",label:"Value op",size:"small",select:!0,fullWidth:!0,value:null===(f=e.pivot)||void 0===f?void 0:f.op,onChange:function(t){console.log("handleSelectValuesOp "+t.target.value);var a=Object(n.a)({},e.pivot,{op:t.target.value});e.onPivotTableChange(a)},variant:"outlined"},Q.map((function(e){return r.createElement(W.a,{key:e,value:e},e)})))),r.createElement(E.a,{item:!0},r.createElement(H.a,{control:r.createElement(K.a,{checked:null!==(b=null===(y=e.pivot)||void 0===y?void 0:y.fixed1)&&void 0!==b&&b,onChange:function(t){console.log("handleFixed1 "+t.target.value);var a=t.target.checked,l=Object(n.a)({},e.pivot,{fixed1:a});e.onPivotTableChange(l)},size:"small"}),label:"Fixed 1 column"})),r.createElement(E.a,{item:!0},r.createElement(E.a,{container:!0,spacing:2,direction:"row",alignItems:"center",justify:"flex-start"},r.createElement(E.a,{item:!0,xs:3,sm:3},r.createElement(H.a,{control:r.createElement(K.a,{checked:null!==(C=null===(S=e.pivot)||void 0===S?void 0:S.delta)&&void 0!==C&&C,onChange:function(t){console.log("handleFixed1 "+t.target.value);var a=t.target.checked,l=Object(n.a)({},e.pivot,{delta:a});e.onPivotTableChange(l)},size:"small"}),label:"Delta column"})),null!==(O=null===(w=e.pivot)||void 0===w?void 0:w.delta)&&void 0!==O&&O?r.createElement(E.a,{item:!0},r.createElement(g.a,{id:"delta-title-outlined-text",label:"Title",size:"small",fullWidth:!0,defaultValue:"\u0394",value:null===(j=e.pivot)||void 0===j?void 0:j.deltaTitle,onChange:function(t){console.log("handleDeltaColumnTitle "+t.target.value);var a=Object(n.a)({},e.pivot,{deltaTitle:t.target.value});e.onPivotTableChange(a)},variant:"outlined"})):null,null!==(x=null===(F=e.pivot)||void 0===F?void 0:F.delta)&&void 0!==x&&x?r.createElement(E.a,{item:!0},r.createElement(H.a,{control:r.createElement(ie.a,{checked:null!==(D=null===(T=e.pivot)||void 0===T?void 0:T.deltaOnly)&&void 0!==D&&D,onChange:function(t){console.log("handleFixed1 "+t.target.value);var a=t.target.checked,l=Object(n.a)({},e.pivot,{deltaOnly:a});e.onPivotTableChange(l)},name:"deltaOnly"}),label:"Hide others"})):null)),null!==(B=null===(A=e.pivot)||void 0===A?void 0:A.delta)&&void 0!==B&&B?r.createElement(E.a,{item:!0},r.createElement(E.a,{container:!0,spacing:2,direction:"row",alignItems:"center",justify:"flex-start"},r.createElement(E.a,{item:!0,xs:3,sm:3},r.createElement(g.a,{id:"values-op-outlined-text",label:"A",size:"small",select:!0,fullWidth:!0,value:null===(I=e.pivot)||void 0===I?void 0:I.deltaA,onChange:function(t){console.log("handleSelectDeltaA "+t.target.value);var a=t.target.value&&""!==t.target.value?t.target.value:void 0,l=Object(n.a)({},e.pivot,{deltaA:a});e.onPivotTableChange(l)},variant:"outlined"},te.map((function(e){return r.createElement(W.a,{key:e.key,value:e.value},e.value)})))),r.createElement(E.a,{item:!0,justify:"center",alignItems:"center"},r.createElement(se.a,null)),r.createElement(E.a,{item:!0,xs:3,sm:3},r.createElement(g.a,{id:"values-op-outlined-text",label:"B",size:"small",select:!0,fullWidth:!0,value:null===(P=e.pivot)||void 0===P?void 0:P.deltaB,onChange:function(t){console.log("handleSelectDeltaB "+t.target.value);var a=t.target.value&&""!==t.target.value?t.target.value:void 0,l=Object(n.a)({},e.pivot,{deltaB:a});e.onPivotTableChange(l)},variant:"outlined"},ae.map((function(e){return r.createElement(W.a,{key:e.key,value:e.value},e.value)})))))):null,r.createElement(E.a,{item:!0},r.createElement(H.a,{control:r.createElement(K.a,{checked:le,onChange:function(t){var a,l;console.log("handleWithReferenceValue "+t.target.value);var r=t.target.checked,i=Object(n.a)({},e.pivot,{referenceValue:r?0:void 0,referenceOp:r?null!==(a=null===(l=e.pivot)||void 0===l?void 0:l.referenceOp)&&void 0!==a?a:"eq":void 0});e.onPivotTableChange(i)},size:"small"}),label:"Highlight row if"})),le?r.createElement(E.a,{item:!0},r.createElement(E.a,{container:!0,spacing:2,direction:"row",alignItems:"stretch"},r.createElement(E.a,{item:!0,xs:3,sm:3},r.createElement(g.a,{id:"reference-outlined-column",label:"Column",size:"small",select:!0,fullWidth:!0,value:null!==(N=null===(V=e.pivot)||void 0===V?void 0:V.referenceColumn)&&void 0!==N?N:"*",onChange:function(t){console.log("handleReferenceColumn "+t.target.value);var a=Object(n.a)({},e.pivot,{referenceColumn:t.target.value});e.onPivotTableChange(a)},variant:"outlined"},ne.map((function(e){return r.createElement(W.a,{key:e.key,value:e.value},e.value)})))),r.createElement(E.a,{item:!0,xs:3,sm:3},r.createElement(g.a,{id:"op-value-textfield",label:"compare operation",size:"small",select:!0,fullWidth:!0,value:null===(z=e.pivot)||void 0===z?void 0:z.referenceOp,onChange:function(t){console.log("handleReferenceOp "+t.target.value);var a=Object(n.a)({},e.pivot,{referenceOp:t.target.value});e.onPivotTableChange(a)},variant:"outlined"},[{value:"gt",label:">"},{value:"lt",label:"<"},{value:"gte",label:">="},{value:"lte",label:"<="},{value:"eq",label:"=="},{value:"neq",label:"!="}].map((function(e,t){return r.createElement(W.a,{key:e.value,value:e.value},e.label)})))),r.createElement(E.a,{item:!0,xs:3,sm:3},r.createElement(g.a,{id:"reference-outlined-number",label:"Reference",size:"small",fullWidth:!0,value:null===(M=e.pivot)||void 0===M?void 0:M.referenceValue,onChange:function(t){console.log("handleReferenceValue "+t.target.value);var a=Object(n.a)({},e.pivot,{referenceValue:Number(t.target.value)});e.onPivotTableChange(a)},type:"number",InputLabelProps:{shrink:!0},variant:"outlined"})))):null))},ce=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.createElement("div",{title:"VisualizeTypeTable"},r.createElement(k.a,{variant:"h6"},"Events support is ugly on server. Can't select fields. Response with strange names not found in field list. To be fixed in future."),r.createElement(k.a,{variant:"subtitle2"},"\xa0"),r.createElement(k.a,{variant:"subtitle2"},"TODO: add limit option"))}}]),t}(r.Component);var de=function(e){var t;return r.createElement("div",{title:"VisualizeTypePivotTable"},r.createElement(k.a,{variant:"h6"},"Markdown"),r.createElement(k.a,{variant:"subtitle2"},"\xa0"),r.createElement(E.a,{container:!0,spacing:2,direction:"column",alignItems:"stretch"},r.createElement(E.a,{item:!0},r.createElement(H.a,{control:r.createElement(K.a,{checked:null!==(t=e.bottom)&&void 0!==t&&t,onChange:function(t){console.log("handleMarkdownBottomChange "+t.target.value);var a=t.target.checked;e.onMarkdownBottomChange(a)},size:"small"}),label:"at bottom"}))))},pe=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.createElement(b.a,{variant:"elevation",elevation:0,title:"Choose the way in which the result dataset or some static information will be presented"},r.createElement(k.a,{variant:"h5"},"Visualize"),r.createElement(k.a,{variant:"subtitle2"},"\xa0"),r.createElement(_,{value:this.props.visualizeType,onChange:this.props.onChange}),r.createElement(k.a,{variant:"subtitle2"},"\xa0"),"Chart"===this.props.visualizeType?r.createElement(Q,{chart:this.props.chart,groupBy:this.props.groupBy,groupByAvailable:this.props.groupByAvailable,onChartChange:this.props.onChartChange}):null,"Pie"===this.props.visualizeType?r.createElement(Z,{chart:this.props.chart,groupBy:this.props.groupBy,groupByAvailable:this.props.groupByAvailable,onChartChange:this.props.onChartChange}):null,"Counter"===this.props.visualizeType?r.createElement(ee,{counter:this.props.counter,groupBy:this.props.groupBy,groupByAvailable:this.props.groupByAvailable,onCounterChange:this.props.onCounterChange}):null,"Table"===this.props.visualizeType?r.createElement(re,{table:this.props.table,groupBy:this.props.groupBy,groupByAvailable:this.props.groupByAvailable,onTableChange:this.props.onTableChange}):null,"PivotTable"===this.props.visualizeType?r.createElement(ue,{pivot:this.props.pivot,groupBy:this.props.groupBy,groupByAvailable:this.props.groupByAvailable,possibleValues:this.props.possibleValues,onPivotTableChange:this.props.onPivotTableChange}):null,"Events"===this.props.visualizeType?r.createElement(ce,null):null,"Markdown"===this.props.visualizeType?r.createElement(de,{bottom:this.props.bottom,onMarkdownBottomChange:this.props.onMarkdownBottomChange}):null,r.createElement(k.a,{variant:"subtitle2"},"\xa0"))}}]),t}(r.Component),me=a(29),he=a.n(me),ve=a(845),fe=a(846),ge=a(847),be=a(848),Ee=a(449),ye=a(189),Ce=a.n(ye),ke=a(125),Se=a.n(ke),Oe=a(161),we=a.n(Oe),je=a(188),xe=a.n(je),Fe=a(490),De=a(718),Te=a.n(De),Be=a(447),Ae=a.n(Be),Ie=a(448),We=a.n(Ie);Ae.a.vfs=We.a.pdfMake.vfs;var Pe=function(e){function t(){var e,a;Object(d.a)(this,t);for(var l=arguments.length,r=new Array(l),i=0;i<l;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={rows:void 0,err:void 0,openFullscreen:!1},a.lineChart=null,a.barChart=null,a.areaChart=null,a.handleFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!0})}))},a.handleFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!1})}))},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.stringToColour=function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);for(var n="#",l=0;l<3;l++){n+=("00"+(t>>8*l&255).toString(16)).substr(-2)}return n},a.download=function(){var e=document.getElementById("download"),t=document.getElementById("myCanvas").toDataURL("image/png").replace("image/png","image/octet-stream");e.setAttribute("href",t)},a.exportChart=function(e){var t,n,l=null!==(t=null!==(n=a.lineChart)&&void 0!==n?n:a.barChart)&&void 0!==t?t:a.areaChart;if(l){var r=he.a.findDOMNode(l).children[0];if(e){var i,o,s=(new XMLSerializer).serializeToString(r),u=(new Blob([s],{type:"image/svg+xml;charset=utf-8"}),i=r.getAttribute("width"),o=r.getAttribute("height"),{footer:function(e,t){return{text:"Created at "+new Date,alignment:"center"}},content:[a.props.title,"\n",a.props.description,"\n","something more can be added",{svg:s,width:500}]});Ae.a.createPdf(u).download(a.props.title+".pdf")}else{var c=new Blob([r.outerHTML],{type:"text/html;charset=utf-8"});Te.a.saveAs(c,a.props.title+".html")}}},a.svgToPng=function(e,t,a){return new Promise((function(n,l){var r=document.createElement("canvas");r.width=t,r.height=a;var i=r.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,t,a);var o=(new XMLSerializer).serializeToString(e),s="data:image/svg+xml;utf8,"+encodeURIComponent(o),u=new Image(t,a);u.onload=function(){i.drawImage(u,0,0);var e=r.toDataURL("image/png",1);n(e)},u.onerror=function(){return l()},u.src=s}))},a.handleDownloadSvg=function(){var e,t,n=null!==(e=null!==(t=a.lineChart)&&void 0!==t?t:a.barChart)&&void 0!==e?e:a.areaChart;if(n){var l=he.a.findDOMNode(n).children[0],r=(new XMLSerializer).serializeToString(l),i=new Blob([r],{type:"image/svg+xml;charset=utf-8"});Te.a.saveAs(i,a.props.title+".svg")}},a.handleDownloadPng=Object(F.a)(x.a.mark((function e(){var t,n,l,r,i,o,s,u,c,d;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(l=null!==(t=null!==(n=a.lineChart)&&void 0!==n?n:a.barChart)&&void 0!==t?t:a.areaChart)){e.next=14;break}return o=he.a.findDOMNode(l).children[0],s=null!==(r=o.getAttribute("width"))&&void 0!==r?r:"1920",u=null!==(i=o.getAttribute("height"))&&void 0!==i?i:"1080",e.next=7,a.svgToPng(o,Number(s),Number(u));case 7:c=e.sent,c.replace("image/png","image/octet-stream"),new Blob([c],{type:"image/png"}),(d=document.createElement("a")).href=c,d.download=a.props.title+".png",d.click();case 14:case"end":return e.stop()}}),e)}))),a.handleDownloadPdf=function(){a.exportChart(!0)},a.handleDownload=function(){a.exportChart(!0)},a.handleDownload1=Object(F.a)(x.a.mark((function e(){var t,n,l,r,i,o;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(l=null!==(t=null!==(n=a.lineChart)&&void 0!==n?n:a.barChart)&&void 0!==t?t:a.areaChart)){e.next=9;break}return r=he.a.findDOMNode(l).children[0],e.next=5,a.svgToPng(r,900,500);case 5:i=e.sent,o=i.replace("image/png","image/octet-stream"),document.getElementById("download").setAttribute("href",o);case 9:case"end":return e.stop()}}),e)}))),a.handleDownload111=Object(F.a)(x.a.mark((function e(){var t,n,l,r,i,o;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(l=null!==(t=null!==(n=a.lineChart)&&void 0!==n?n:a.barChart)&&void 0!==t?t:a.areaChart)){e.next=8;break}return r=he.a.findDOMNode(l).children[0],e.next=5,a.svgToPng(r,546,300);case 5:i=e.sent,o={content:["SVG nodes behave similar to images by supporting width/height or fit","It is however not yet possible to use svg files or to have a library of svgs in the document definition","\n","Note that before you can use SVG nodes you must install svg-to-pdfkit as it is not included with pdfmake to keep bundle size down",{image:i,width:546,height:300}]},Ae.a.createPdf(o).download("chart.pdf");case 8:case"end":return e.stop()}}),e)}))),a.loadData=function(){console.log("WidgetPreviewChart loadData"),a.setState({rows:void 0,err:void 0});var e=a.props.api+"/api/v2/ad-query/aggregation/table",t=a.props.chartState,n=t.x,l=t.y,r=t.op,i=t.series,o={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})).map((function(e){return{field:e.field,op:e.op,value:e.value}})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},groupBy:[n,l,i],fields:[{field:l,op:r}]},s={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(o)};fetch(e,s).then((function(e){return e.json()})).then((function(e){if(null==e.result)throw Error("no rows in result"+JSON.stringify(e));var t=e.result;console.log("WidgetPreviewLineChart r="+JSON.stringify(t)),a.setState({rows:t}),console.log("WidgetPreviewLineChart data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a.handleClick=function(e,t){e&&console.log("onClick "+a.props.title+" index="+t+" data[index]="+JSON.stringify(e.payload))},a.handleClickLine=function(e,t){e&&console.log("onClick "+a.props.title+" activeLabel="+e.activeLabel)},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetPreviewChart componentDidMount "+JSON.stringify(this.props.chartState)),this.loadData()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetPreviewChart componentDidUpdate "+JSON.stringify(this.props.chartState)),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadData()}},{key:"render",value:function(){var e=this;if(this.state.err)return r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,null,"Error: ",this.state.err)));if(!this.props.chartState)return r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,null,"Error: no chartState")));var t=this.props.chartState,a=t.type,n=t.x,l=t.y,i=t.op,s=t.series;if(!a)return r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,null,"Error: no type")));if(!n||!l||!i||!s)return r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,null,"Error: chartState content ",JSON.stringify(this.props.chartState))));if(!this.state.rows)return r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,null,"Error: no rows")));var u,c=this.state.rows,d=this.props.groupByAvailable.filter((function(t){return t.name===e.props.chartState.series})),p=this.props.chartState.series,m=d[0].descriptor.type,h=[];"set"===m?h=(null===(u=this.props.possibleValues.set.get(p))||void 0===u?void 0:u.map((function(e){return{key:e,value:e}})))||[]:"dictionary"===m&&(h=this.props.possibleValues.dictionary.get(p)||[]);console.log(h);var v=c.reduce((function(e,t){var a=t[s];return e.add(a),e}),new Set);h=h.filter((function(e){return v.has(e.key)}));var f=c.reduce((function(e,t){var a=t[n],r=e.get(a)||{x:a};return r[t[s]]=t[i+"_"+l],e.set(a,r),e}),new Map);console.log(f);var g=o.a(f.values()).sortBy((function(e){return e.x}));console.log(g.toArray());var b=g.toArray(),E=r.createElement(k.a,null,"Error: unknown type ",a);return"Line"===a&&(E=r.createElement(Fe.j,{ref:function(t){return e.lineChart=t},width:400,height:300,data:b,margin:{top:5,right:20,left:10,bottom:5},onClick:this.handleClickLine},r.createElement(Fe.o,{dataKey:"x"}),r.createElement(Fe.p,null),r.createElement(Fe.n,null),r.createElement(Fe.h,null),r.createElement(Fe.f,{stroke:"#f5f5f5",strokeDasharray:"5 5"}),h.map((function(t){return r.createElement(Fe.i,{type:"monotone",connectNulls:!0,stroke:e.stringToColour(t.key),isAnimationActive:!1,dataKey:t.key,name:t.value,activeDot:{onClick:function(e){return console.log("activeDot: ",e)}}})})),this.props.chartState.brush?r.createElement(Fe.e,null):null)),"Bar"===a&&(E=r.createElement(Fe.d,{ref:function(t){return e.barChart=t},width:400,height:300,data:b,margin:{top:5,right:20,left:10,bottom:5},onClick:this.handleClickLine},r.createElement(Fe.o,{dataKey:"x"}),r.createElement(Fe.p,null),r.createElement(Fe.n,null),r.createElement(Fe.h,null),r.createElement(Fe.f,{stroke:"#f5f5f5",strokeDasharray:"5 5"}),h.map((function(t){return r.createElement(Fe.c,{stroke:e.stringToColour(t.key),fill:e.stringToColour(t.key),dataKey:t.key,name:t.value,onClick:e.handleClick})})),this.props.chartState.brush?r.createElement(Fe.e,null):null)),"Area"===a&&(E=r.createElement(Fe.b,{ref:function(t){return e.areaChart=t},width:400,height:300,data:b,margin:{top:5,right:20,left:10,bottom:5},onClick:this.handleClickLine},r.createElement(Fe.o,{dataKey:"x"}),r.createElement(Fe.p,null),r.createElement(Fe.n,null),r.createElement(Fe.h,null),r.createElement(Fe.f,{stroke:"#f5f5f5",strokeDasharray:"5 5"}),h.map((function(t){return r.createElement(Fe.a,{type:"monotone",connectNulls:!0,stroke:e.stringToColour(t.key),fill:e.stringToColour(t.key),fillOpacity:.5,dataKey:t.key,name:t.value})})),this.props.chartState.brush?r.createElement(Fe.e,null):null)),r.createElement("div",{id:this.props.id},r.createElement(ve.a,{variant:"outlined"},r.createElement(ge.a,{action:r.createElement(A.a,{"aria-label":"fullscreen",onClick:this.handleFullscreenOpen},r.createElement(xe.a,null)),title:this.props.title,subheader:this.props.description}),r.createElement(fe.a,null,r.createElement(Fe.m,{width:"95%",height:300},E)),this.props.isEditMode?r.createElement(be.a,{disableSpacing:!0},r.createElement(A.a,{"aria-label":"edit",onClick:this.handleEdit},r.createElement(Se.a,null)),r.createElement(A.a,{"aria-label":"delete",onClick:this.handleDelete},r.createElement(we.a,null))):null),r.createElement(U.a,{fullScreen:!0,open:this.state.openFullscreen,onClose:this.handleFullscreenClose},r.createElement(L.a,{id:"editor-dialog-title"},r.createElement(Ee.a,{variant:"dense"},r.createElement(A.a,{edge:"start",color:"inherit",onClick:this.handleFullscreenClose,"aria-label":"close"},r.createElement(Ce.a,null)),r.createElement(k.a,{variant:"h6"},this.props.title),r.createElement(z.a,{color:"inherit",onClick:this.handleDownloadPdf},"PDF"),r.createElement(z.a,{color:"inherit",onClick:this.handleDownloadSvg},"SVG"),r.createElement(z.a,{color:"inherit",onClick:this.handleDownloadPng},"PNG"))),r.createElement(R.a,null,r.createElement(k.a,{variant:"h6"},this.props.description),r.createElement(Fe.m,{width:"95%",height:700},E))))}}]),t}(r.Component),Ne=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(l)))).state={rows:void 0,err:void 0},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.loadData=function(){console.log("WidgetPreviewPie loadData"),a.setState({rows:void 0,err:void 0});var e=a.props.api+"/api/v2/ad-query/aggregation/table",t=a.props.chartState,n=t.x,l=t.y,r=t.op,i=t.series,o={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})).map((function(e){return{field:e.field,op:e.op,value:e.value}})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},groupBy:[n,l,i],fields:[{field:l,op:r}]},s={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(o)};fetch(e,s).then((function(e){return e.json()})).then((function(e){if(null==e.result)throw Error("no rows in result"+JSON.stringify(e));var t=e.result;console.log("WidgetPreviewLineChart r="+JSON.stringify(t)),a.setState({rows:t}),console.log("WidgetPreviewLineChart data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetPreviewPie componentDidMount "+JSON.stringify(this.props.chartState)),this.loadData()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetPreviewPie componentDidUpdate "+JSON.stringify(this.props.chartState)),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadData()}},{key:"render",value:function(){var e=this;if(this.state.err)return r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,null,"Error: ",this.state.err)));if(!this.props.chartState)return r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,null,"Error: no chartState")));var t=this.props.chartState,a=t.x,n=t.y,l=t.op,i=t.series;if(!a||!n||!l||!i)return r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,null,"Error: chartState content ",JSON.stringify(this.props.chartState))));if(!this.state.rows)return r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,null,"Error: no rows")));var s,u=this.state.rows,c=this.props.groupByAvailable.filter((function(t){return t.name===e.props.chartState.series})),d=this.props.chartState.series,p=c[0].descriptor.type,m=[];"set"===p?m=(null===(s=this.props.possibleValues.set.get(d))||void 0===s?void 0:s.map((function(e){return{key:e,value:e}})))||[]:"dictionary"===p&&(m=this.props.possibleValues.dictionary.get(d)||[]);console.log(m);var h=u.reduce((function(e,t){var a=t[i];return e.add(a),e}),new Set);m=m.filter((function(e){return h.has(e.key)}));var v=u.reduce((function(e,t){var r=t[i]+"("+t[a]+")",o=e.get(r)||{x:r};return o.value=t[l+"_"+n],e.set(r,o),e}),new Map);console.log(v);var f=o.a(v.keys()).sortBy((function(e){return e.x})),g=o.a(v.values()).sortBy((function(e){return e.x}));console.log(f.toArray()),console.log(g.toArray());var b=g.toArray(),E=function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);for(var n="#",l=0;l<3;l++){n+=("00"+(t>>8*l&255).toString(16)).substr(-2)}return n};return r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,{align:"center",color:"textSecondary",gutterBottom:!0},this.props.title),r.createElement(Fe.m,{width:"95%",height:400},r.createElement(Fe.l,{width:400,height:400,margin:{top:5,right:20,left:10,bottom:5}},r.createElement(Fe.n,null),r.createElement(Fe.h,null),r.createElement(Fe.k,{cx:"50%",cy:"50%",data:b,label:!0,innerRadius:80,outerRadius:100,dataKey:"value",nameKey:"x",key:"value"},b.map((function(e,t){return r.createElement(Fe.g,{key:"cell-".concat(t),fill:E(e.x)})}))))),r.createElement(k.a,{align:"center",color:"textSecondary"},this.props.description)),this.props.isEditMode?r.createElement(be.a,{disableSpacing:!0},r.createElement(A.a,{"aria-label":"edit",onClick:this.handleEdit},r.createElement(Se.a,null)),r.createElement(A.a,{"aria-label":"delete",onClick:this.handleDelete},r.createElement(we.a,null))):null)}}]),t}(r.Component),Ve=a(301),ze=a.n(Ve),Me=a(310),Je=a.n(Me),Le=a(321),Re=a.n(Le),Ye=a(311),Ue=a.n(Ye),Ge=a(319),qe=a.n(Ge),Xe=a(314),_e=a.n(Xe),He=a(312),Ke=a.n(He),Qe=a(313),Ze=a.n(Qe),$e=a(316),et=a.n($e),tt=a(317),at=a.n(tt),nt=a(318),lt=a.n(nt),rt=a(315),it=a.n(rt),ot=a(320),st=a.n(ot),ut=a(322),ct=a.n(ut),dt=a(247),pt=a.n(dt),mt=function(e){return Object(r.forwardRef)((function(t,a){return i.a.createElement(e,Object.assign({},t,{ref:a}))}))},ht={Add:mt(Je.a),Check:mt(Ue.a),Clear:mt(Ke.a),Delete:mt(Ze.a),DetailPanel:mt(_e.a),Edit:mt(Se.a),Export:mt(it.a),Filter:mt(et.a),FirstPage:mt(at.a),LastPage:mt(lt.a),NextPage:mt(_e.a),PreviousPage:mt(qe.a),ResetSearch:mt(Ke.a),Search:mt(st.a),SortArrow:mt(Re.a),ThirdStateCheck:mt(se.a),ViewColumn:mt(ct.a)},vt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var l=arguments.length,r=new Array(l),i=0;i<l;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={rows:void 0,err:void 0,openFullscreen:!1,selected:void 0},a.handleFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!0})}))},a.handleFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!1})}))},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.loadData=function(){var e,t,n,l,r;console.log("WidgetAggregationTable loadData"),a.setState({rows:void 0,err:void 0});var i=a.props.api+"/api/v2/ad-query/aggregation/table",s=o.a(a.props.groupBy).map((function(e){return t=e,a.props.groupByAvailable.find((function(e){return e.name===t}));var t})).filter((function(e){return!!e})).map((function(e){return e})),u=null!==(e=null!==(t=a.props.tableState.field)&&void 0!==t?t:o.a(a.props.groupBy).first())&&void 0!==e?e:"",c=null!==(n=s.filter((function(e){return e.name===u})).map((function(e){return e.descriptor.type})).first())&&void 0!==n?n:"",d=a.props.tableState.isAggregationFieldInGroupBy?o.a(a.props.groupBy).toArray():o.a(a.props.groupBy).filter((function(e){return e!==u})).toArray(),p=("number"!==c?["count"]:["count","avg","sum","min","max"]).includes(null!==(l=a.props.tableState.op)&&void 0!==l?l:"")&&null!==(r=a.props.tableState.op)&&void 0!==r?r:"count",m={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},groupBy:d,fields:[{field:u,op:p}]},h={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(m)};fetch(i,h).then((function(e){return e.json()})).then((function(e){if(null==e.result)throw Error("no rows in result"+JSON.stringify(e));var t=e.result.map((function(e){return e}));a.setState({rows:t}),console.log("WidgetAggregationTable data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetAggregationTable componentDidMount "+this.props.tableState.field),this.loadData()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetAggregationTable componentDidUpdate "+this.props.tableState.field),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadData()}},{key:"render",value:function(){var e,t,a,n,l,r,s=this,u=o.a(this.props.groupBy).map((function(e){return t=e,s.props.groupByAvailable.find((function(e){return e.name===t}));var t})).filter((function(e){return!!e})).map((function(e){return e})),c=null!==(e=null!==(t=this.props.tableState.field)&&void 0!==t?t:o.a(this.props.groupBy).first())&&void 0!==e?e:"",d=null!==(a=u.filter((function(e){return e.name===c})).map((function(e){return e.descriptor.type})).first())&&void 0!==a?a:"",p=null!==(n=u.filter((function(e){return e.name===c})).map((function(e){return e.translation})).first())&&void 0!==n?n:c,m=("number"!==d?["count"]:["count","avg","sum","min","max"]).includes(null!==(l=this.props.tableState.op)&&void 0!==l?l:"")&&null!==(r=this.props.tableState.op)&&void 0!==r?r:"count",h=u.filter((function(e){return!!s.props.tableState.isAggregationFieldInGroupBy||e.name!==c})).map((function(e){var t=[];"dictionary"===e.descriptor.type&&(t=(t=s.props.possibleValues.dictionary.get(e.name)||[]).map((function(e){return{key:e.key,value:e.value&&""!==e.value?e.value:e.key}})));var a=t.reduce((function(e,t){var a=t.key,n=t.value;return e.set(a,n),e}),new Map),n=Object.fromEntries(a.entries());return console.log(n),{field:e.name,title:e.translation,lookup:"dictionary"===e.descriptor.type?n:void 0}})),v={field:m+"_"+c,title:m+"("+p+")"},f=h.toArray().concat(v);if(this.state.err)return i.a.createElement(ve.a,{variant:"outlined"},i.a.createElement(fe.a,null,i.a.createElement(k.a,null,"Error: ",this.state.err)));var g=i.a.createElement(ze.a,{icons:ht,columns:f,onColumnDragged:function(e,t){console.log("Dropped column from "+e+" to position "+t)},options:{showTitle:!1,padding:"dense",exportAllData:!0,exportButton:!0,exportFileName:this.props.title+"."+pt()().format("YYYYMMDDTHHmmss"),rowStyle:function(e){return{backgroundColor:s.state.selected===e.tableData.id?"#EEE":"#FFF"}}},onRowClick:function(e,t){return s.setState({selected:null===t||void 0===t?void 0:t.tableData.id})},title:this.props.title,isLoading:!this.state.rows&&!this.state.err,data:this.state.rows,components:{Container:function(e){return i.a.createElement(b.a,Object.assign({},e,{elevation:0}))}}});return i.a.createElement("div",{id:this.props.id},i.a.createElement(ve.a,{variant:"outlined",title:this.props.title},i.a.createElement(ge.a,{action:i.a.createElement(A.a,{"aria-label":"fullscreen",onClick:this.handleFullscreenOpen},i.a.createElement(xe.a,null)),title:this.props.title,subheader:this.props.description}),i.a.createElement(fe.a,null,g),this.props.isEditMode?i.a.createElement(be.a,{disableSpacing:!0},i.a.createElement(A.a,{"aria-label":"edit",onClick:this.handleEdit},i.a.createElement(Se.a,null)),i.a.createElement(A.a,{"aria-label":"delete",onClick:this.handleDelete},i.a.createElement(we.a,null))):null),i.a.createElement(U.a,{fullScreen:!0,open:this.state.openFullscreen,onClose:this.handleFullscreenClose},i.a.createElement(L.a,{id:"editor-dialog-title"},i.a.createElement(Ee.a,{variant:"dense"},i.a.createElement(A.a,{edge:"start",color:"inherit",onClick:this.handleFullscreenClose,"aria-label":"close"},i.a.createElement(Ce.a,null)),i.a.createElement(k.a,{variant:"h6"},this.props.title))),i.a.createElement(R.a,null,i.a.createElement(k.a,{variant:"h6"},this.props.description),g)))}}]),t}(i.a.Component),ft=a(814),gt=a.n(ft),bt=function(e){return Object(r.forwardRef)((function(t,a){return i.a.createElement(e,Object.assign({},t,{ref:a}))}))},Et={Add:bt(Je.a),Check:bt(Ue.a),Clear:bt(Ke.a),Delete:bt(Ze.a),DetailPanel:bt(_e.a),Edit:bt(Se.a),Export:bt(it.a),Filter:bt(et.a),FirstPage:bt(at.a),LastPage:bt(lt.a),NextPage:bt(_e.a),PreviousPage:bt(qe.a),ResetSearch:bt(Ke.a),Search:bt(st.a),SortArrow:bt(Re.a),ThirdStateCheck:bt(se.a),ViewColumn:bt(ct.a)},yt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var l=arguments.length,r=new Array(l),i=0;i<l;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={rows:void 0,err:void 0,openEventFullscreen:!1,openFullscreen:!1,selected:void 0},a.itemByName=function(e){return a.props.groupByAvailable.find((function(t){return t.name===e}))},a.handleEventFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openEventFullscreen:!0})}))},a.handleEventFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openEventFullscreen:!1})}))},a.handleFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!0})}))},a.handleFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!1})}))},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.loadData=function(){console.log("WidgetEvents loadData"),a.setState({rows:void 0,err:void 0});var e=a.props.api+"/api/v2/ad-query/events",t={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},limit:a.props.limit},n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(t)};fetch(e,n).then((function(e){return e.json()})).then((function(e){if(null==e.events)throw Error("no events in result"+JSON.stringify(e));var t,n=null!==(t=e.events)&&void 0!==t?t:[];a.setState({rows:n}),console.log("WidgetEvents data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetEvents componentDidMount "),this.loadData()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetEvents componentDidUpdate "),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadData()}},{key:"render",value:function(){var e=this;if(this.state.err)return i.a.createElement(ve.a,{variant:"outlined"},i.a.createElement(fe.a,null,i.a.createElement(k.a,null,"Error: ",this.state.err)));var t=[{field:"id",title:"id",hidden:!0},{field:"time_date",title:"date",type:"date"},{field:"time_time",title:"time",type:"time"},{field:"source_video_name",title:"video"},{field:"source_server_name",title:"server"},{field:"source_detector_name",title:"detector"},{field:"event_detector_type_name",title:"detector_type"},{field:"description",title:"description",headerStyle:{font:"bold"},render:function(t){var a;return console.log("description "+t.id+" "+JSON.stringify(t.description)),Object.entries(null!==(a=t.description)&&void 0!==a?a:{}).map((function(t){var a,n,r=Object(l.a)(t,2),i=r[0],o=r[1];return(null!==(a=null===(n=e.itemByName(i))||void 0===n?void 0:n.translation)&&void 0!==a?a:i)+" = "+o+"\n"}))}},{field:"raw",title:"raw",hidden:!0,headerStyle:{font:"bold"},render:function(e){return JSON.stringify(e)}}],a=i.a.createElement(ze.a,{icons:Et,columns:t,onColumnDragged:function(e,t){console.log("Dropped column from "+e+" to position "+t)},options:{selection:!0,toolbarButtonAlignment:"left",showTitle:!1,padding:"dense",exportAllData:!0,exportButton:!0,pageSize:5,pageSizeOptions:[5,10,20,50],draggable:this.props.isEditMode,exportFileName:this.props.title+"."+pt()().format("YYYYMMDDTHHmmss"),rowStyle:function(t){return{backgroundColor:e.state.selected===t.tableData.id?"#EEE":"#FFF"}}},actions:[{tooltip:"Tag",icon:function(){return i.a.createElement(gt.a,null)},onClick:function(e,t){var a=null===t||void 0===t?void 0:t.length;alert("You want to add tag to "+a+" rows. Not implemented in backend yet.")}}],onRowClick:function(t,a){e.setState({openEventFullscreen:!0,selectedEvent:a})},title:this.props.title,isLoading:!this.state.rows&&!this.state.err,data:this.state.rows,components:{Container:function(e){return i.a.createElement(b.a,Object.assign({},e,{elevation:0}))}}});return i.a.createElement("div",{id:this.props.id},i.a.createElement(ve.a,{variant:"outlined",title:this.props.title},i.a.createElement(ge.a,{action:i.a.createElement(A.a,{"aria-label":"fullscreen",onClick:this.handleFullscreenOpen},i.a.createElement(xe.a,null)),title:this.props.title,subheader:this.props.description}),i.a.createElement(fe.a,null,a),this.props.isEditMode?i.a.createElement(be.a,{disableSpacing:!0},i.a.createElement(A.a,{"aria-label":"edit",onClick:this.handleEdit},i.a.createElement(Se.a,null)),i.a.createElement(A.a,{"aria-label":"delete",onClick:this.handleDelete},i.a.createElement(we.a,null))):null),i.a.createElement(U.a,{fullScreen:!0,open:this.state.openFullscreen,onClose:this.handleFullscreenClose},i.a.createElement(L.a,{id:"editor-dialog-title"},i.a.createElement(Ee.a,{variant:"dense"},i.a.createElement(A.a,{edge:"start",color:"inherit",onClick:this.handleFullscreenClose,"aria-label":"close"},i.a.createElement(Ce.a,null)),i.a.createElement(k.a,{variant:"h6"},this.props.title))),i.a.createElement(R.a,null,i.a.createElement(k.a,{variant:"h6"},this.props.description),a)),i.a.createElement(U.a,{fullScreen:!0,open:this.state.openEventFullscreen,onClose:this.handleEventFullscreenClose},i.a.createElement(L.a,{id:"event-dialog-title"},i.a.createElement(Ee.a,{variant:"dense"},i.a.createElement(A.a,{edge:"start",color:"inherit",onClick:this.handleEventFullscreenClose,"aria-label":"close"},i.a.createElement(Ce.a,null)),i.a.createElement(k.a,{variant:"h6"},"Event"))),i.a.createElement(R.a,null,i.a.createElement(k.a,{variant:"h6"},"TODO: show snapshot / video player"),i.a.createElement("pre",null,JSON.stringify(this.state.selectedEvent,void 0,2)))))}}]),t}(i.a.Component),Ct=function(e){return Object(r.forwardRef)((function(t,a){return i.a.createElement(e,Object.assign({},t,{ref:a}))}))},kt={Add:Ct(Je.a),Check:Ct(Ue.a),Clear:Ct(Ke.a),Delete:Ct(Ze.a),DetailPanel:Ct(_e.a),Edit:Ct(Se.a),Export:Ct(it.a),Filter:Ct(et.a),FirstPage:Ct(at.a),LastPage:Ct(lt.a),NextPage:Ct(_e.a),PreviousPage:Ct(qe.a),ResetSearch:Ct(Ke.a),Search:Ct(st.a),SortArrow:Ct(Re.a),ThirdStateCheck:Ct(se.a),ViewColumn:Ct(ct.a)},St=function(e){function t(){var e,a;Object(d.a)(this,t);for(var l=arguments.length,r=new Array(l),i=0;i<l;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={rows:void 0,err:void 0,openFullscreen:!1,selected:void 0},a.handleFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!0})}))},a.handleFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!1})}))},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.loadData=function(){console.log("WidgetPivotTable loadData"),a.setState({rows:void 0,err:void 0});var e=a.props.api+"/api/v2/ad-query/aggregation/table",t=a.props.tableState,n=t.rows,l=t.columns,r=t.values,i=t.op,o={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},groupBy:[n,l,r],fields:[{field:r,op:i}]},s={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(o)};fetch(e,s).then((function(e){return e.json()})).then((function(e){if(null==e.result)throw Error("no rows in result"+JSON.stringify(e));var t=e.result.map((function(e){return e}));a.setState({rows:t}),console.log("WidgetPivotTable data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetPivotTable componentDidMount "),this.loadData()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetPivotTable componentDidUpdate "),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadData()}},{key:"render",value:function(){var e,t=this,a=this.props.tableState,n=a.rows,l=a.columns,r=a.values,s=a.op;if(!n||!l||!s||!r)return i.a.createElement(ve.a,{variant:"outlined"},i.a.createElement(fe.a,null,i.a.createElement(k.a,null,"Error: state is not complete, content"," ",JSON.stringify(this.props.tableState))));if(this.state.err)return i.a.createElement(ve.a,{variant:"outlined"},i.a.createElement(fe.a,null,i.a.createElement(k.a,null,"Error: ",this.state.err)));if(!this.state.rows)return i.a.createElement(ve.a,{variant:"outlined"},i.a.createElement(fe.a,null,i.a.createElement(k.a,null,"No rows")));var u,c=this.state.rows,d=this.props.groupByAvailable.filter((function(e){return e.name===l})),p=l,m=d[0].descriptor.type,h=this.props.groupByAvailable.filter((function(e){return e.name===n})),v=n,f=h[0].descriptor.type,g=h[0].translation,E=[];"set"===m?E=(null===(u=this.props.possibleValues.set.get(p))||void 0===u?void 0:u.map((function(e){return{key:e,value:e}})))||[]:"dictionary"===m&&(E=(E=this.props.possibleValues.dictionary.get(p)||[]).map((function(e){return{key:e.key,value:e.value&&""!==e.value?e.value:e.key}})));console.log("columnsValues = "+JSON.stringify(E));var y,S=[];"set"===f?S=(null===(y=this.props.possibleValues.set.get(v))||void 0===y?void 0:y.map((function(e){return{key:e,value:e}})))||[]:"dictionary"===f&&(S=(S=this.props.possibleValues.dictionary.get(v)||[]).map((function(e){return{key:e.key,value:e.value&&""!==e.value?e.value:e.key}})));console.log("rowsValues = "+JSON.stringify(S));var O=c.reduce((function(e,t){var a=t[l];return e.add(a),e}),new Set),w=c.reduce((function(e,t){var a=t[n];return e.add(a),e}),new Set);console.log("columnsInDataValues = "+JSON.stringify(O)),console.log("rowsInDataValues = "+JSON.stringify(w)),E=E.filter((function(e){return O.has(e.key)})),S=S.filter((function(e){return w.has(e.key)})),console.log("columnsValues = "+JSON.stringify(E)),console.log("rowsValues = "+JSON.stringify(S));var j=c.reduce((function(e,t){var a=t[n],i=e.get(a)||{x:a};return i[t[l]]=t[s+"_"+r],e.set(a,i),e}),new Map);console.log(j);var x=o.a(j.values()).sortBy((function(e){return e.x})).toArray();console.log("dd = "+JSON.stringify(x));var F=this.props.tableState.delta&&this.props.tableState.deltaA&&this.props.tableState.deltaB,D=null!==(e=this.props.tableState.deltaTitle)&&void 0!==e?e:"\u0394",T=F&&this.props.tableState.deltaOnly;if(F){var B=this.props.tableState.deltaA,I=this.props.tableState.deltaB;x=o.a(x).map((function(e){var t=Number(e[B]),a=Number(e[I]),n=e;return n[D]=t-a,n})).toArray(),console.log("dd with delta = "+JSON.stringify(x))}if(this.props.tableState.referenceValue&&this.props.tableState.referenceOp){var W,P=null!==(W=this.props.tableState.referenceColumn)&&void 0!==W?W:"*",N=this.props.tableState.referenceValue,V=this.props.tableState.referenceOp;x=o.a(x).map((function(e){var t=Number(e[P]),a=!1;switch(V){case"eq":a=t===N;break;case"neq":a=t!==N;break;case"gt":a=t>N;break;case"lt":a=t<N;break;case"gte":a=t>=N;break;case"lte":a=t<=N}var n=e;return n.highlight=a,n})).toArray(),console.log("dd with highlight = "+JSON.stringify(x))}var z=S.reduce((function(e,t){var a=t.key,n=t.value;return e.set(a,n),e}),new Map),M=Object.fromEntries(z.entries());console.log(M);var J={field:"x",title:g,lookup:"dictionary"===f?M:void 0},Y=E.map((function(e){return{field:e.key,title:e.value}})),G={field:D,title:D},q=[J].concat(T?[]:Y).concat(F?G:[]).concat([{field:"highlight",title:"highlight",hidden:!0}]),X=x,_=i.a.createElement(ze.a,{icons:kt,columns:q,onColumnDragged:function(e,t){console.log("Dropped column from "+e+" to position "+t)},options:{showTitle:!1,padding:"dense",exportAllData:!0,exportButton:!0,exportFileName:this.props.title+"."+pt()().format("YYYYMMDDTHHmmss"),fixedColumns:{left:this.props.tableState.fixed1?1:0,right:0},rowStyle:function(e){return{backgroundColor:t.state.selected===e.tableData.id?"#EEE":"#FFF",color:e.highlight?"#F00":"#000"}}},onRowClick:function(e,a){return t.setState({selected:null===a||void 0===a?void 0:a.tableData.id})},title:i.a.createElement(C.a,null,i.a.createElement(k.a,{variant:"h5",component:"h5"},this.props.title),i.a.createElement(k.a,{color:"textSecondary"},this.props.description)),isLoading:!this.state.rows&&!this.state.err,data:X,components:{Container:function(e){return i.a.createElement(b.a,Object.assign({},e,{elevation:0}))}}});return i.a.createElement("div",{id:this.props.id},i.a.createElement(ve.a,{variant:"outlined",title:this.props.title},i.a.createElement(ge.a,{action:i.a.createElement(A.a,{"aria-label":"fullscreen",onClick:this.handleFullscreenOpen},i.a.createElement(xe.a,null)),title:this.props.title,subheader:this.props.description}),i.a.createElement(fe.a,null,_),this.props.isEditMode?i.a.createElement(be.a,{disableSpacing:!0},i.a.createElement(A.a,{"aria-label":"edit",onClick:this.handleEdit},i.a.createElement(Se.a,null)),i.a.createElement(A.a,{"aria-label":"delete",onClick:this.handleDelete},i.a.createElement(we.a,null))):null),i.a.createElement(U.a,{fullScreen:!0,open:this.state.openFullscreen,onClose:this.handleFullscreenClose},i.a.createElement(L.a,{id:"editor-dialog-title"},i.a.createElement(Ee.a,{variant:"dense"},i.a.createElement(A.a,{edge:"start",color:"inherit",onClick:this.handleFullscreenClose,"aria-label":"close"},i.a.createElement(Ce.a,null)),i.a.createElement(k.a,{variant:"h6"},this.props.title))),i.a.createElement(R.a,null,i.a.createElement(k.a,{variant:"h6"},this.props.description),_)))}}]),t}(i.a.Component),Ot=a(487),wt=a.n(Ot),jt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var l=arguments.length,r=new Array(l),i=0;i<l;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={value:void 0,err:void 0,openFullscreen:!1},a.handleFullscreenOpen=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!0})}))},a.handleFullscreenClose=function(){a.setState((function(e){return Object(n.a)({},e,{openFullscreen:!1})}))},a.handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a.handleRefresh=function(){console.log("handleRefresh"),a.loadCounter()},a.loadCounter=function(){var e;console.log("WidgetCounter loadCounter "+a.props.counterState.field),a.setState({value:void 0,err:void 0});var t=a.props.api+"/api/v2/ad-query/aggregation/table",n={filter:{keys:a.props.filterItems.filter((function(e){return"set"===e.type||"dictionary"===e.type})),numbers:a.props.filterItems.filter((function(e){return"number"===e.type})).map((function(e){return{field:e.field,op:e.op,value:Number.parseFloat(e.value)}})),lists:[],period:a.props.period},groupBy:[null!==(e=a.props.counterState.fieldGroupBy)&&void 0!==e?e:a.props.counterState.field],fields:[{field:a.props.counterState.field,op:a.props.counterState.op}]},l={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.props.token},body:JSON.stringify(n)};fetch(t,l).then((function(e){return e.json()})).then((function(e){if(1!==e.result.length)throw Error("rows in result == "+e.result.length+" "+JSON.stringify(e.result));var t,n=e.result[0][a.props.counterState.op+"_"+a.props.counterState.field];a.setState({value:n+(null!==(t=a.props.counterState.offset)&&void 0!==t?t:0)}),console.log({id:a.props.id,value:n}),console.log("WidgetCounter data="+JSON.stringify(e))})).catch((function(e){a.setState({err:e.message})}))},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("WidgetCounter componentDidMount "+this.props.counterState.field),this.loadCounter()}},{key:"componentDidUpdate",value:function(e){console.log("WidgetCounter componentDidUpdate "+this.props.counterState.field),JSON.stringify(this.props)!==JSON.stringify(e)&&this.loadCounter()}},{key:"render",value:function(){var e,t;if(this.state.err)return i.a.createElement(ve.a,{variant:"outlined"},i.a.createElement(fe.a,null,i.a.createElement(k.a,null,"Error: ",this.state.err)));var a=!1;if(void 0!==this.props.counterState.referenceValue&&this.props.counterState.referenceOp){var n=this.props.counterState.referenceValue;switch(this.props.counterState.referenceOp){case"eq":a=Number(this.state.value)===n;break;case"neq":a=Number(this.state.value)!==n;break;case"gt":a=Number(this.state.value)>n;break;case"lt":a=Number(this.state.value)<n;break;case"gte":a=Number(this.state.value)>=n;break;case"lte":a=Number(this.state.value)<=n}}return i.a.createElement("div",{id:this.props.id},i.a.createElement(ve.a,{variant:"outlined"},i.a.createElement(ge.a,{action:i.a.createElement(A.a,{"aria-label":"fullscreen",onClick:this.handleFullscreenOpen},i.a.createElement(xe.a,null)),color:a?"error":"textSecondary",title:this.props.title}),i.a.createElement(fe.a,null,i.a.createElement(k.a,{align:"center",variant:"h4",component:"h4",color:a?"error":"inherit"},null!==(e=this.state.value)&&void 0!==e?e:"..."),i.a.createElement(k.a,{align:"center",color:a?"error":"textSecondary"},this.props.description)),this.props.isEditMode?i.a.createElement(be.a,{disableSpacing:!0},i.a.createElement(A.a,{"aria-label":"edit",onClick:this.handleEdit},i.a.createElement(Se.a,null)),i.a.createElement(A.a,{"aria-label":"delete",onClick:this.handleDelete},i.a.createElement(we.a,null))):null),i.a.createElement(U.a,{fullScreen:!0,open:this.state.openFullscreen,onClose:this.handleFullscreenClose},i.a.createElement(L.a,{id:"editor-dialog-title"},i.a.createElement(Ee.a,{variant:"dense"},i.a.createElement(A.a,{edge:"start",color:"inherit",onClick:this.handleFullscreenClose,"aria-label":"close"},i.a.createElement(Ce.a,null)),i.a.createElement(k.a,{variant:"h6"},this.props.title),i.a.createElement(A.a,{"aria-label":"refresh","aria-haspopup":"true",edge:"end",color:"inherit",onClick:this.handleRefresh},i.a.createElement(wt.a,null)))),i.a.createElement(R.a,null,i.a.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},i.a.createElement("div",null,i.a.createElement(k.a,{align:"center",variant:"h1",component:"h1",color:a?"error":"inherit"},null!==(t=this.state.value)&&void 0!==t?t:"..."),i.a.createElement(k.a,{align:"center",color:a?"error":"textSecondary"},this.props.description))))))}}]),t}(i.a.Component),xt=a(815),Ft=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(l)))).handleEdit=function(){console.log("handleEdit "+a.props.id),a.props.onEditWidget&&a.props.onEditWidget(a.props.id)},a.handleDelete=function(){console.log("handleDelete "+a.props.id),a.props.onDeleteWidget&&a.props.onDeleteWidget(a.props.id)},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e;return i.a.createElement(ve.a,{variant:"outlined",title:this.props.title},i.a.createElement(fe.a,null,i.a.createElement(xt.a,null,null!==(e=this.props.description)&&void 0!==e?e:"")),this.props.isEditMode?i.a.createElement(be.a,{disableSpacing:!0},i.a.createElement(A.a,{"aria-label":"edit",onClick:this.handleEdit},i.a.createElement(Se.a,null)),i.a.createElement(A.a,{"aria-label":"delete",onClick:this.handleDelete},i.a.createElement(we.a,null))):null)}}]),t}(i.a.Component),Dt=a(863),Tt=a(817),Bt=a.n(Tt),At=a(488),It=a.n(At),Wt=a(457);var Pt=function(e){var t=r.useState(!1),a=Object(l.a)(t,2),n=a[0],i=a[1],o=r.useState(""),s=Object(l.a)(o,2),u=s[0],c=s[1];return r.createElement(b.a,{variant:"elevation",elevation:0},r.createElement(Wt.a,{title:"Show the full source of widget internals. Copy/Paste enabled."},r.createElement(A.a,{"aria-label":"raw","aria-haspopup":"true",color:"primary",onClick:function(){i(!0),c(e.raw)}},r.createElement(It.a,null))),r.createElement(U.a,{disableBackdropClick:!0,disableEscapeKeyDown:!0,maxWidth:"xs",fullWidth:!0,"aria-labelledby":"confirmation-dialog-title",open:n},r.createElement(L.a,{id:"confirmation-dialog-title"},"Raw"),r.createElement(R.a,{dividers:!0},r.createElement(g.a,{id:"value-textfield",label:"Value",size:"small",fullWidth:!0,multiline:!0,value:u,onChange:function(e){var t=e.target.value&&""!==e.target.value?e.target.value:"";console.log("new rawValue "+t),c(t)},variant:"outlined"})),r.createElement(Y.a,null,r.createElement(z.a,{autoFocus:!0,onClick:function(){i(!1),c("")},color:"primary"},"Cancel"),r.createElement(z.a,{onClick:function(){i(!1),e.onChangeRaw(u),c("")},color:"primary"},"Set"))))},Nt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var l=arguments.length,r=new Array(l),i=0;i<l;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={real:{id:Object(f.a)(),title:"New Widget 1",visualizeType:"Chart",groupBy:o.a(),filterItems:o.a([]),period:{type:"forever"}}},a.handleChangeTitle=function(e){a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{title:e})})}))},a.handleChangeDescription=function(e){a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{description:e})})}))},a.handleChange=function(e){console.log(e.target.value);var t=e.target.value;a.setState((function(e){return Object(n.a)({},e,{real:Object(n.a)({},e.real,{visualizeType:t})})}))},a.handleTimeperiod=function(e){console.log("handleTimeperiod "+e.type),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{period:{type:e.type}})})}))},a.handleAddField=function(e){console.log("handleAddField "+e.name),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{groupBy:o.a(t.real.groupBy).push(e.name)})})}))},a.handleRemoveField=function(e){console.log("handleRemoveField "+e.name),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{groupBy:t.real.groupBy.filter((function(t){return t!==e.name}))})})}))},a.handleChartChange=function(e){console.log("handleChartChange "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{chart:e})})}))},a.handleTableChange=function(e){console.log("handleTableChange "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{table:e})})}))},a.handlePivotTableChange=function(e){console.log("handlePivotTableChange "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{pivot:e})})}))},a.handleCounterChange=function(e){console.log("handleCounterChange "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{counter:e})})}))},a.handleMarkdownBottomChange=function(e){console.log("handleMarkdownBottomChange "+e),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{bottom:e})})}))},a.handleAddFilterItem=function(e){console.log("handleAddFilterItem "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{filterItems:o.a(t.real.filterItems).push(e)})})}))},a.handleRemoveFilterItem=function(e){console.log("handleRemoveFilterItem "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{real:Object(n.a)({},t.real,{filterItems:t.real.filterItems.filter((function(t){return JSON.stringify(t)!==JSON.stringify(e)}))})})}))},a.handleRaw=function(e){var t=JSON.parse(e);a.setState((function(e){return Object(n.a)({},e,{real:t})}))},a.handleEditorDialogSave=function(){a.props.onChangeWidgetEditorState(a.state.real)},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return this.props.internal.possiblePeriodsLoaded?this.props.internal.groupByAvailableLoaded?this.props.internal.possibleValuesLoaded?r.createElement("div",null,r.createElement(L.a,{id:"editor-dialog-title"},r.createElement(Ee.a,{variant:"dense"},r.createElement(Dt.a,{separator:"\u203a","aria-label":"breadcrumb"},r.createElement(k.a,{color:"textPrimary",title:"Create title and subtitle for the widget"},"title"),r.createElement(k.a,{color:"textPrimary",title:"Prepare query by selecting fields and filtering them"},"query"),r.createElement(k.a,{color:"textPrimary",title:"Visualize the result dataset with number of perdefined widgets"},"visualize"),r.createElement(k.a,{color:"textPrimary",title:"Preview the result dataset in widget"},"preview"),r.createElement(k.a,{color:"textPrimary",title:"Save to add widget to current dashboard"},"save")),r.createElement(A.a,{edge:"end",color:"inherit","aria-label":"help",title:"All controls have tooltips"},r.createElement(Bt.a,null)))),r.createElement(R.a,null,r.createElement(C.a,null,r.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},r.createElement(E.a,{item:!0,xs:12},r.createElement(y,{title:this.state.real.title,description:this.state.real.description,onChangeTitle:this.handleChangeTitle,onChangeDescription:this.handleChangeDescription})),r.createElement(E.a,{item:!0,xs:12},r.createElement(Pt,{raw:JSON.stringify(this.state.real,void 0,2),onChangeRaw:this.handleRaw})),"Markdown"!==this.state.real.visualizeType?r.createElement(E.a,{item:!0,xs:12},r.createElement(X,{groupBy:this.state.real.groupBy,groupByAvailable:this.props.internal.groupByAvailable,possibleValues:this.props.internal.possibleValues,filterItems:this.state.real.filterItems,period:this.state.real.period,possiblePeriods:this.props.internal.possiblePeriods,onAddField:this.handleAddField,onRemoveField:this.handleRemoveField,onTimeperiod:this.handleTimeperiod,onAddFilterItem:this.handleAddFilterItem,onRemoveFilterItem:this.handleRemoveFilterItem})):null,r.createElement(E.a,{item:!0,xs:12,sm:6},r.createElement(pe,{visualizeType:this.state.real.visualizeType,chart:this.state.real.chart,table:this.state.real.table,pivot:this.state.real.pivot,bottom:this.state.real.bottom,counter:this.state.real.counter,groupBy:this.state.real.groupBy,groupByAvailable:this.props.internal.groupByAvailable,possibleValues:this.props.internal.possibleValues,onChange:this.handleChange,onChartChange:this.handleChartChange,onTableChange:this.handleTableChange,onPivotTableChange:this.handlePivotTableChange,onCounterChange:this.handleCounterChange,onMarkdownBottomChange:this.handleMarkdownBottomChange})),r.createElement(E.a,{item:!0,xs:12,sm:6},"Chart"===this.state.real.visualizeType&&this.state.real.chart?r.createElement(Pe,{isEditMode:!1,api:this.props.api,token:this.props.token,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description,chartState:this.state.real.chart,filterItems:this.state.real.filterItems,period:this.state.real.period,possibleValues:this.props.internal.possibleValues,groupByAvailable:this.props.internal.groupByAvailable}):null,"Pie"===this.state.real.visualizeType&&this.state.real.chart?r.createElement(Ne,{isEditMode:!1,api:this.props.api,token:this.props.token,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description,chartState:this.state.real.chart,filterItems:this.state.real.filterItems,period:this.state.real.period,possibleValues:this.props.internal.possibleValues,groupByAvailable:this.props.internal.groupByAvailable}):null,"Table"===this.state.real.visualizeType&&this.state.real.table?r.createElement(vt,{isEditMode:!1,api:this.props.api,token:this.props.token,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description,tableState:this.state.real.table,groupBy:this.state.real.groupBy,groupByAvailable:this.props.internal.groupByAvailable,filterItems:this.state.real.filterItems,period:this.state.real.period,possibleValues:this.props.internal.possibleValues}):null,"PivotTable"===this.state.real.visualizeType&&this.state.real.pivot?r.createElement(St,{isEditMode:!1,api:this.props.api,token:this.props.token,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description,tableState:this.state.real.pivot,filterItems:this.state.real.filterItems,period:this.state.real.period,possibleValues:this.props.internal.possibleValues,groupByAvailable:this.props.internal.groupByAvailable}):null,"Events"===this.state.real.visualizeType?r.createElement(yt,{isEditMode:!1,api:this.props.api,token:this.props.token,limit:5,id:this.state.real.id,dashboardId:this.props.dashboardId,title:this.state.real.title,description:this.state.real.description,filterItems:this.state.real.filterItems,period:this.state.real.period,possibleValues:this.props.internal.possibleValues,groupByAvailable:this.props.internal.groupByAvailable}):null,"Counter"===this.state.real.visualizeType&&this.state.real.counter?r.createElement(jt,{isEditMode:!1,api:this.props.api,token:this.props.token,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description,counterState:this.state.real.counter,filterItems:this.state.real.filterItems,period:this.state.real.period}):null,"Markdown"===this.state.real.visualizeType?r.createElement(Ft,{isEditMode:!1,id:this.state.real.id,title:this.state.real.title,description:this.state.real.description}):null)))),r.createElement(Y.a,null,r.createElement(z.a,{onClick:this.props.onClose,color:"primary"},"Cancel"),r.createElement(z.a,{onClick:this.handleEditorDialogSave,color:"primary"},"Save"))):r.createElement(D,{api:this.props.api,token:this.props.token,eventFields:this.props.internal.groupByAvailable,onChangePossibleValues:this.props.onLoadPossibleValues}):r.createElement(w,{api:this.props.api,token:this.props.token,lang:this.props.lang,onChangeEventFields:this.props.onLoadEventFields}):r.createElement(T,{api:this.props.api,token:this.props.token,lang:this.props.lang,onLoadPossiblePeriods:this.props.onLoadPossiblePeriods})}}]),t}(r.Component),Vt=a(30),zt=a(489),Mt=a.n(zt),Jt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var l=arguments.length,r=new Array(l),i=0;i<l;i++)r[i]=arguments[i];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={filterItems:o.a([]),period:{type:"forever"}},a.handleAddFilterItem=function(e){console.log("Dashboard handleAddFilterItem "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{filterItems:o.a(t.filterItems).push(e)})}))},a.handleRemoveFilterItem=function(e){console.log("Dashboard handleRemoveFilterItem "+JSON.stringify(e)),a.setState((function(t){return Object(n.a)({},t,{filterItems:t.filterItems.filter((function(t){return JSON.stringify(t)!==JSON.stringify(e)}))})}))},a.handleTimeperiod=function(e){console.log("Dashboard handleTimeperiod "+e.type),a.setState((function(t){return Object(n.a)({},t,{period:{type:e.type}})}))},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;if(0===this.props.widgets.length)return r.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},r.createElement(E.a,{item:!0,xs:12},r.createElement(ve.a,{variant:"outlined"},r.createElement(fe.a,null,r.createElement(k.a,{variant:"h5",component:"h2"},"No widgets created"),r.createElement(k.a,null,"\xa0"),r.createElement(k.a,{variant:"body2",component:"p",color:"textSecondary"},"Use ",r.createElement(Mt.a,null)," button to select dashboard"),r.createElement(k.a,{variant:"body2",component:"p",color:"textSecondary"},"Or turn on edit mode with ",r.createElement(Se.a,null)," and use ",r.createElement(N.a,null)," button to add widget")))),r.createElement(E.a,{item:!0,xs:12},r.createElement(ve.a,{variant:"outlined"},r.createElement(ge.a,{title:"Tutorial"}),r.createElement(fe.a,null,r.createElement(k.a,null,r.createElement(Vt.b,{to:"/dashboard/tutorial"},"Start"))))),r.createElement(E.a,{item:!0,xs:12},r.createElement(ve.a,{variant:"outlined"},r.createElement(ge.a,{title:"Whats new",subheader:"v.0.1"}),r.createElement(fe.a,null,r.createElement(k.a,null,"Dashboards can be loaded from external file url, in url encoded format"),r.createElement(k.a,null,'Example: "#/inbox/dashboard/file/https%3A%2F%2Fraw.githubusercontent.com%2Favgx%2Fadd%2Fgh-pages%2Fdashboards.json"'),r.createElement(k.a,null,r.createElement(Vt.b,{to:"/inbox/dashboard/file/https%3A%2F%2Fraw.githubusercontent.com%2Favgx%2Fadd%2Fgh-pages%2Fdashboards.json"},"Click this link to see an example")),r.createElement(k.a,null,r.createElement(Vt.b,{to:"/inbox/dashboard/file/https%3A%2F%2Fraw.githubusercontent.com%2Favgx%2Fadd%2Fgh-pages%2Fdashboards.1.json"},"Click this link to see an example 2 "))),r.createElement(be.a,null,r.createElement(z.a,{size:"small"},"More")))),r.createElement(E.a,{item:!0,xs:12},r.createElement(ve.a,{variant:"outlined"},r.createElement(ge.a,{title:"Blog",subheader:"2020-07-01"}),r.createElement(fe.a,null,r.createElement(k.a,null,"Prepared presentation about Dashboards ",r.createElement("a",{href:"/add/presentation/index.html"},"Click to open")),r.createElement(k.a,null,"\xa0"),r.createElement(Vt.b,{to:"/inbox/dashboard/file/https%3A%2F%2Fraw.githubusercontent.com%2Favgx%2Fadd%2Fgh-pages%2Fdashboard.demo.json"},"Click this link to load demo of all kinds of widgets for presentation")),r.createElement(be.a,null,r.createElement(z.a,{size:"small"},"More")))),r.createElement(E.a,{item:!0,xs:12},r.createElement(ve.a,{variant:"outlined"},r.createElement(ge.a,{title:"Market / Store / Share network / Social network",subheader:"like lottiefiles.com"}),r.createElement(fe.a,null,r.createElement(k.a,null,"Visitors dashboard ",r.createElement(Vt.b,{to:"/inbox/dashboard/file/1.json"},"Download")),r.createElement(k.a,null,"People counter dashboard ",r.createElement(Vt.b,{to:"/inbox/dashboard/file/2.json"},"Download")),r.createElement(k.a,null,"...")),r.createElement(be.a,null,r.createElement(z.a,{size:"small"},"More")))));if(!this.props.internal.possiblePeriodsLoaded)return r.createElement(T,{api:this.props.api,token:this.props.token,lang:this.props.lang,onLoadPossiblePeriods:this.props.onLoadPossiblePeriods});if(!this.props.internal.groupByAvailableLoaded)return r.createElement(w,{api:this.props.api,token:this.props.token,lang:this.props.lang,onChangeEventFields:this.props.onLoadEventFields});if(!this.props.internal.possibleValuesLoaded)return r.createElement(D,{api:this.props.api,token:this.props.token,eventFields:this.props.internal.groupByAvailable,onChangePossibleValues:this.props.onLoadPossibleValues});console.log("Dashboard widgets: "+JSON.stringify(this.props.widgets,void 0,2));var t=o.a(this.props.widgets).filter((function(e){return"Markdown"===e.visualizeType&&!e.bottom})),a=o.a(this.props.widgets).filter((function(e){return"Markdown"===e.visualizeType&&e.bottom})),n=o.a(this.props.widgets).filter((function(e){return"Chart"===e.visualizeType})),l=o.a(this.props.widgets).filter((function(e){return"Pie"===e.visualizeType})),i=o.a(this.props.widgets).filter((function(e){return"Counter"===e.visualizeType})),s=o.a(this.props.widgets).filter((function(e){return"Table"===e.visualizeType})),u=o.a(this.props.widgets).filter((function(e){return"PivotTable"===e.visualizeType})),c=o.a(this.props.widgets).filter((function(e){return"Events"===e.visualizeType}));return r.createElement("div",null,r.createElement(k.a,{variant:"subtitle2"},"\xa0"),this.props.isCommonFilterEnabled?r.createElement(Wt.a,{title:"Dashboard common filter that will be applied to every widget"},r.createElement(E.a,{container:!0,spacing:2,direction:"row",alignItems:"stretch",alignContent:"center"},r.createElement(E.a,{item:!0},r.createElement(q,{period:this.state.period,possiblePeriods:this.props.internal.possiblePeriods,onTimeperiod:this.handleTimeperiod})),r.createElement(E.a,{item:!0},r.createElement(G,{filterItems:this.state.filterItems,possibleValues:this.props.internal.possibleValues,groupByAvailable:this.props.internal.groupByAvailable,onAddFilterItem:this.handleAddFilterItem,onRemoveFilterItem:this.handleRemoveFilterItem})))):null,r.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},t.map((function(t){return r.createElement(E.a,{item:!0,xs:12},r.createElement(Ft,{isEditMode:e.props.isEditMode,id:t.id,title:t.title,description:t.description,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))}))),r.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},i.map((function(t){return r.createElement(E.a,{item:!0,xs:12,sm:3},r.createElement(jt,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,id:t.id,title:t.title,description:t.description,counterState:t.counter,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))}))),r.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},n.map((function(t){return r.createElement(E.a,{item:!0,xs:12,sm:6},r.createElement(Pe,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,id:t.id,title:t.title,description:t.description,chartState:t.chart,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,possibleValues:e.props.internal.possibleValues,groupByAvailable:e.props.internal.groupByAvailable,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))})),l.map((function(t){return r.createElement(E.a,{item:!0,xs:12,sm:6},r.createElement(Ne,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,id:t.id,title:t.title,description:t.description,chartState:t.chart,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,possibleValues:e.props.internal.possibleValues,groupByAvailable:e.props.internal.groupByAvailable,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))}))),r.createElement(k.a,{variant:"subtitle2"},"\xa0"),r.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},s.map((function(t){return r.createElement(E.a,{item:!0,xs:12},r.createElement(vt,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,id:t.id,title:t.title,description:t.description,tableState:t.table,groupBy:t.groupBy,groupByAvailable:e.props.internal.groupByAvailable,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,possibleValues:e.props.internal.possibleValues,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))})),u.map((function(t){return r.createElement(E.a,{item:!0,xs:12},r.createElement(St,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,id:t.id,title:t.title,description:t.description,tableState:t.pivot,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,possibleValues:e.props.internal.possibleValues,groupByAvailable:e.props.internal.groupByAvailable,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))})),c.map((function(t){return r.createElement(E.a,{item:!0,xs:12},r.createElement(yt,{isEditMode:e.props.isEditMode,api:e.props.api,token:e.props.token,limit:200,id:t.id,dashboardId:e.props.id,title:t.title,description:t.description,filterItems:e.props.isCommonFilterEnabled?o.a(t.filterItems).concat(e.state.filterItems):t.filterItems,period:e.props.isCommonFilterEnabled?e.state.period:t.period,possibleValues:e.props.internal.possibleValues,groupByAvailable:e.props.internal.groupByAvailable,refreshTime:e.props.refreshTime,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))}))),r.createElement(E.a,{container:!0,spacing:2,alignItems:"stretch"},a.map((function(t){return r.createElement(E.a,{item:!0,xs:12},r.createElement(Ft,{isEditMode:e.props.isEditMode,id:t.id,title:t.title,description:t.description,onEditWidget:e.props.onEditWidget,onDeleteWidget:e.props.onDeleteWidget}))}))))}}]),t}(r.Component);var Lt=function(e){var t=r.useState(!1),a=Object(l.a)(t,2),n=a[0],i=a[1],o=r.useState(""),s=Object(l.a)(o,2),u=s[0],c=s[1];return r.createElement("div",null,r.createElement(Wt.a,{title:"Show the full source of dashboard internals. Copy/Paste enabled."},r.createElement(A.a,{"aria-label":"raw","aria-haspopup":"true",color:"inherit",onClick:function(){i(!0),c(e.raw)}},r.createElement(It.a,null))),r.createElement(U.a,{disableBackdropClick:!0,disableEscapeKeyDown:!0,maxWidth:"xs",fullWidth:!0,"aria-labelledby":"confirmation-dialog-title",open:n},r.createElement(L.a,{id:"confirmation-dialog-title"},"Raw"),r.createElement(R.a,{dividers:!0},r.createElement(g.a,{id:"value-textfield",label:"Value",size:"small",fullWidth:!0,multiline:!0,value:u,onChange:function(e){var t=e.target.value&&""!==e.target.value?e.target.value:"";console.log("new rawValue "+t),c(t)},variant:"outlined"})),r.createElement(Y.a,null,r.createElement(z.a,{autoFocus:!0,onClick:function(){i(!1),c("")},color:"primary"},"Cancel"),r.createElement(z.a,{onClick:function(){i(!1),e.onChangeRaw(u),c("")},color:"primary",disabled:e.isReadonly},"Set"))))},Rt=a(857),Yt=a(859);var Ut=function(e){var t=r.useState(!1),a=Object(l.a)(t,2),n=a[0],i=a[1],o=function(){i(!1)};return r.createElement("div",null,r.createElement(Wt.a,{title:"Create new or select one of the predefined dashboards"},r.createElement(A.a,{edge:"start",disabled:e.isEditMode,color:"inherit","aria-label":"menu",onClick:function(){i(!0)}},r.createElement(Mt.a,null))),r.createElement(U.a,{onClose:o,"aria-labelledby":"simple-dialog-title",maxWidth:"xs",fullWidth:!0,open:n},r.createElement(L.a,{id:"simple-dialog-title"},"Dashboard"),r.createElement(te.a,null,r.createElement(ae.a,{button:!0,component:Vt.c,to:"/dashboard",onClick:function(){return t="Dashboard",a=[],i(!1),void e.onSelectWidgets(t,a);var t,a},key:Object(f.a)()},r.createElement(ne.a,{primary:"Create new ..."})),r.createElement(Rt.a,null),r.createElement(Yt.a,null,"or select"),e.list.map((function(e){return r.createElement(ae.a,{button:!0,component:Vt.c,to:"/dashboard/"+e.id,onClick:o,key:e.id},r.createElement(ne.a,{primary:e.title}))})))))},Gt=a(309),qt=a(856),Xt=a(819),_t=a.n(Xt),Ht=a(820),Kt=a.n(Ht),Qt=a(2);var Zt=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(l)))).state={data:void 0,err:void 0},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch(this.props.dashboardsJsonUrl).then((function(e){return e.json()})).then((function(e){return function(e,t){return new Promise((function(a){return setTimeout(a,e,t)}))}(2e3,e)})).then((function(t){t.length>0?(e.props.onLoadedDashboards(t),e.setState({data:t})):e.setState({err:"No dashboards found in "+e.props.dashboardsJsonUrl})})).catch((function(t){e.setState({err:t.message})}))}},{key:"render",value:function(){return this.state.err?r.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},r.createElement(C.a,null,r.createElement(k.a,{align:"center"},"Error: ",this.state.err),r.createElement(k.a,{align:"center"},r.createElement(Vt.b,{to:"/"},"Return to dashboards")))):this.state.data?r.createElement(Qt.a,{to:"/"}):r.createElement("div",{style:{height:"90vh",margin:0,padding:0,display:"flex",justifyContent:"center",alignItems:"center"}},r.createElement(C.a,null,r.createElement(k.a,{align:"center"},r.createElement(O.a,null),"\xa0\xa0Loading dashboard..."),r.createElement(k.a,{align:"center"},this.props.dashboardsJsonUrl)))}}]),t}(r.Component),$t=a(818);Ae.a.vfs=We.a.pdfMake.vfs;var ea=Object(u.a)((function(e){return Object(c.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));t.default=function(){var e=ea(),t=Object(Qt.g)(),a=t.dashboardId,r=(t.widgetId,t.widgetMode,t.eventId,t.dashboardFile),u=i.a.useState([]),c=Object(l.a)(u,2),d=c[0],p=c[1],m=$t,h=i.a.useState("Dashboards"),v=Object(l.a)(h,2),f=v[0],b=v[1],E=i.a.useState(!1),y=Object(l.a)(E,2),C=y[0],S=y[1],O=i.a.useState("https://axxoncloud-test2.axxonnet.com"),w=Object(l.a)(O,2),j=w[0],x=w[1],F=i.a.useState("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjUzLCJVc2VyTmFtZSI6ImF6cmV0LnNoYXVsdWtob3ZAcnUuYXh4b25zb2Z0LmNvbSIsIkNsaWVudElEIjoiNmNlZGQ2OTJjNTNiNWRmMGNkZGVjNjlmMmYxNzZhMDgiLCJUeXBlIjoiYWNjZXNzVG9rZW4iLCJWZXJzaW9uIjoidjIiLCJDcmVhdGVkQXQiOiIyMDIwLTA3LTAxVDE4OjE2OjIxLjAxMTg4NDk0M1oiLCJleHAiOjE1OTM3MTM3ODEsImlhdCI6MTU5MzYyNzM4MSwiaXNzIjoiQ2xvdWQifQ.cj-fFWwnJWP3OS-OX9cSUOwmU2aIprwE3EPOtYXqwkE"),D=Object(l.a)(F,2),T=D[0],B=D[1],I=i.a.useState("en"),P=Object(l.a)(I,2),V=P[0],M=P[1],J=i.a.useState(!0),G=Object(l.a)(J,2),q=G[0],X=G[1],_=i.a.useState(new Date),Q=Object(l.a)(_,2),Z=Q[0],$=Q[1],ee=i.a.useState(!1),te=Object(l.a)(ee,2),ae=te[0],ne=te[1],le=i.a.useState(!1),re=Object(l.a)(le,2),ie=re[0],oe=re[1],se=function(){ne(!1)},ue=function(){oe(!1)},ce=function(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(t){return null}}(T);console.log("tokenParsed: "+JSON.stringify(ce));var de=JSON.stringify(ce),pe=i.a.useState([]),me=Object(l.a)(pe,2),he=me[0],ve=me[1],fe=i.a.useState({groupByAvailableLoaded:!1,groupByAvailable:[],possibleValuesLoaded:!1,possibleValues:{set:o.b({}),dictionary:o.b({})},possiblePeriodsLoaded:!1,possiblePeriods:[]}),ge=Object(l.a)(fe,2),be=ge[0],ye=ge[1],Ce=function(e){console.log("handleLoadEventFields "+JSON.stringify(e));var t=e.sort((function(e,t){var a=e.translation.toUpperCase(),n=t.translation.toUpperCase(),l=0;return a>n?l=1:a<n&&(l=-1),l}));ye(Object(n.a)({},be,{groupByAvailableLoaded:!0,groupByAvailable:t}))},ke=function(e){console.log("handleLoadPossibleValues "+JSON.stringify(e)),ye(Object(n.a)({},be,{possibleValuesLoaded:!0,possibleValues:e}))},Oe=function(e){console.log("handleLoadPossiblePeriods "+JSON.stringify(e)),ye(Object(n.a)({},be,{possiblePeriodsLoaded:!0,possiblePeriods:e}))};if(r)return i.a.createElement(Zt,{dashboardsJsonUrl:decodeURIComponent(r),onLoadedDashboards:function(e){console.log("handleonLoadedDashboards length="+e.length),p(d.concat(e))}});var we=function(e){var t=JSON.parse(e);ve(t)},je=function(e){console.log("TODO: implement handleEditWidget")},xe=function(e){ve(he.filter((function(t){return t.id!==e})))};return i.a.createElement("div",{className:e.root},i.a.createElement(Gt.a,{display:"block",displayPrint:"none"},i.a.createElement(s.a,{position:"static"},i.a.createElement(Ee.a,{variant:"dense"},i.a.createElement(Ut,{list:d,isEditMode:C,onSelectWidgets:function(e,t){ve(t),b(e)}}),i.a.createElement(k.a,{variant:"h6",className:e.title},f," ",C?" : Edit":""),C&&!a?i.a.createElement(Wt.a,{title:"Add widget"},i.a.createElement(A.a,{edge:"end",color:"inherit","aria-label":"add widget",onClick:function(){oe(!0)}},i.a.createElement(N.a,null))):null,C?i.a.createElement((function(){var e=Object(Qt.g)().dashboardId;if(!e)return i.a.createElement(Lt,{isReadonly:!1,raw:JSON.stringify(he,void 0,2),onChangeRaw:we});var t=o.a(d).find((function(t){return t.id===e}));if(!t)return null;var a=t.raw;return i.a.createElement(Lt,{isReadonly:!0,raw:JSON.stringify(a,void 0,2),onChangeRaw:we})}),null):null,he.length>0?i.a.createElement(Wt.a,{title:"Refresh data"},i.a.createElement(A.a,{"aria-label":"refresh","aria-haspopup":"true",color:"inherit",onClick:function(){$(new Date)}},i.a.createElement(wt.a,null))):null,!C&&he.length>0?i.a.createElement(Wt.a,{title:"Export"},i.a.createElement(A.a,{"aria-label":"export","aria-haspopup":"true",color:"inherit",onClick:function(){console.log("TODO: EXPORT");for(var e=[],t=0;t<he.length;t++){var a=he[t];if(a.id){var n=document.getElementById(a.id);if(console.log(n),n){var l=n.querySelector("svg.recharts-surface");if(console.log(l),null!=l){var r,i=(new XMLSerializer).serializeToString(l);e.push({text:a.title},{text:null!==(r=a.description)&&void 0!==r?r:""},{text:"raw: "+JSON.stringify(a)},{svg:i,width:500})}else e.push({text:"no svg for "+a.visualizeType+" "+a.title})}else e.push({text:"no widgetRoot for "+a.visualizeType+" "+a.title})}else e.push({text:"no id for "+a.visualizeType+" "+a.title})}var o={header:"Export (ugly but fixing is in progress)",footer:function(e,t){return{text:"Created at "+new Date,alignment:"center"}},content:e};Ae.a.createPdf(o).download(f+"."+pt()().format("YYYYMMDDTHHmmss")+".pdf")}},i.a.createElement(_t.a,null))):null,C?i.a.createElement(Wt.a,{title:"Show settings dialog"},i.a.createElement(A.a,{"aria-label":"backend","aria-haspopup":"true",color:"inherit",onClick:function(){ne(!0)}},i.a.createElement(Kt.a,null))):null,i.a.createElement(Wt.a,{title:"Toggle edit mode"},i.a.createElement(A.a,{"aria-label":"edit-mode","aria-haspopup":"true",color:"inherit",onClick:function(){S(!C)}},i.a.createElement(Se.a,{color:C?"secondary":"inherit"})))))),i.a.createElement((function(){var e;if(!a)return i.a.createElement(Jt,{id:"custom",api:j,token:T,lang:V,isCommonFilterEnabled:q,isEditMode:C,refreshTime:Z,widgets:he,internal:be,onLoadEventFields:Ce,onLoadPossibleValues:ke,onLoadPossiblePeriods:Oe,onEditWidget:je,onDeleteWidget:xe});var t=null!==(e=o.a(d).find((function(e){return e.id===a})))&&void 0!==e?e:o.a(m).find((function(e){return e.id===a}));if(!t)return i.a.createElement(k.a,null,"Dashboard ",a," not found");var n=t.raw;return i.a.createElement(Jt,{id:t.id,api:j,token:T,lang:V,isCommonFilterEnabled:q,isEditMode:C,refreshTime:Z,widgets:n,internal:be,onLoadEventFields:Ce,onLoadPossibleValues:ke,onLoadPossiblePeriods:Oe,onEditWidget:je,onDeleteWidget:xe})}),null),i.a.createElement(U.a,{open:ae,onClose:se,"aria-labelledby":"backend-dialog-title"},i.a.createElement(L.a,{id:"backend-dialog-title"},"Backend"),i.a.createElement(R.a,null,i.a.createElement(qt.a,null,"To get data need url and token"),i.a.createElement(g.a,{autoFocus:!0,margin:"dense",id:"backend-api",label:"API",type:"url",value:j,fullWidth:!0,onChange:function(e){console.log("handleApi "+e.target.value),x(e.target.value)}}),i.a.createElement(g.a,{id:"op-value-textfield",margin:"dense",label:"lang",size:"small",select:!0,fullWidth:!0,value:V,onChange:function(e){console.log("handleLang "+e.target.value);var t=e.target.value;M(t)}},i.a.createElement(W.a,{key:"en",value:"en"},"en"),i.a.createElement(W.a,{key:"ru",value:"ru"},"ru")),i.a.createElement(H.a,{control:i.a.createElement(K.a,{checked:q,onChange:function(e){console.log("handleCommonFilter "+e.target.value);var t=e.target.checked;X(t)},size:"small"}),label:"Dashboard common filter"}),i.a.createElement(g.a,{autoFocus:!0,margin:"dense",id:"backend-token",label:"Access token",value:T,multiline:!0,fullWidth:!0,helperText:de,onChange:function(e){console.log("handleToken "+e.target.value),B(e.target.value)}})),i.a.createElement(Y.a,null,i.a.createElement(z.a,{onClick:se,color:"primary"},"Cancel"),i.a.createElement(z.a,{onClick:se,color:"primary"},"OK"))),i.a.createElement(U.a,{fullScreen:!0,open:ie,onClose:ue,fullWidth:!0,maxWidth:"xl","aria-labelledby":"editor-dialog-title"},i.a.createElement(Nt,{dashboardId:null!==a&&void 0!==a?a:"custom",api:j,token:T,lang:V,internal:be,onLoadEventFields:Ce,onLoadPossibleValues:ke,onLoadPossiblePeriods:Oe,onChangeWidgetEditorState:function(e){console.log("handleChangeWidgetEditorState "+a+" "+JSON.stringify(e)),ve(o.a(he).push(e).toArray()),oe(!1)},onClose:ue})))}}}]);
//# sourceMappingURL=4.82f22c4b.chunk.js.map